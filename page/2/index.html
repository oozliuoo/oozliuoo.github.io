<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Eric' Notes">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Eric' Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eric' Notes">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> Eric' Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Eric' Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/19/nanodegree-ai-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/19/nanodegree-ai-2/" itemprop="url">
                  NanoDegree AI - Intro to Game Playing
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-19T19:08:45-07:00">
                2017-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Main-Topics"><a href="#Main-Topics" class="headerlink" title="Main Topics"></a>Main Topics</h1><ol>
<li>Adversarial search</li>
<li>Minimax Algorithm</li>
<li>Alpha-Beta Pruning</li>
<li>Evaluation Functions</li>
<li>Isolation Game player</li>
<li>Multi-Player, Probabilistic Games</li>
</ol>
<h1 id="MiniMax"><a href="#MiniMax" class="headerlink" title="MiniMax"></a>MiniMax</h1><h2 id="General-Ideas"><a href="#General-Ideas" class="headerlink" title="General Ideas"></a>General Ideas</h2><ul>
<li>Use Max and Min node for each layer</li>
<li>Indicating that oponents are always trying to minimize my (from computer perspective) score, and I am trying to maximize it.</li>
<li>Player representing computer will always be the top node (max node)</li>
<li>Propagate the value from bottom to top</li>
</ul>
<h2 id="Maximum-number-of-nodes-visited"><a href="#Maximum-number-of-nodes-visited" class="headerlink" title="Maximum number of nodes visited"></a>Maximum number of nodes visited</h2><ul>
<li>Could be extremely large without pruning</li>
<li>b^d: b is <strong>branch factor</strong> and d is <strong>depth</strong></li>
<li>Cannot brute-force the game!</li>
</ul>
<h2 id="Depth-Limited-search"><a href="#Depth-Limited-search" class="headerlink" title="Depth Limited search"></a>Depth Limited search</h2><ul>
<li>Calculate the maximum depth it can search, based on provided limited time</li>
<li>When reaching the limited depth, use an <strong>Evaluation Function</strong> to find the best move (node)</li>
</ul>
<h3 id="Evaluation-function"><a href="#Evaluation-function" class="headerlink" title="Evaluation function"></a>Evaluation function</h3><ul>
<li>Choose wisely</li>
<li>Need testing - When reaching different levels, the result could be different for the same evaluation function</li>
</ul>
<h2 id="Quiescent-search"><a href="#Quiescent-search" class="headerlink" title="Quiescent search"></a>Quiescent search</h2><ul>
<li>Seaching through different depth to see if the result is consistent</li>
<li>Will usually use at the beginning/end of the game</li>
</ul>
<h2 id="Iterative-Deepening"><a href="#Iterative-Deepening" class="headerlink" title="Iterative Deepening"></a>Iterative Deepening</h2><ul>
<li>Incrementally search thru different depth</li>
<li>Keep the result of each level, and try to search the next level. If time limit exceeds, return the stored result</li>
<li>Could search deeper towards the end of the game</li>
</ul>
<h3 id="Horizon-Effect"><a href="#Horizon-Effect" class="headerlink" title="Horizon Effect"></a>Horizon Effect</h3><ul>
<li>When it is obvious for human player what the next move is, but computer cannot search far enough to figure it out.</li>
</ul>
<h2 id="Alpha-beta-pruning"><a href="#Alpha-beta-pruning" class="headerlink" title="Alpha-beta pruning"></a>Alpha-beta pruning</h2><ul>
<li>Could save time by a factor of 2<pre><code class="javascript">
</code></pre>
</li>
</ul>
<h2 id="Expectimax"><a href="#Expectimax" class="headerlink" title="Expectimax"></a>Expectimax</h2><ul>
<li>Handle probablistic moves</li>
<li>Can only prune when you have known bounds for values</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/15/nanodegree-ai-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/15/nanodegree-ai-1/" itemprop="url">
                  NanoDegree AI - Intro
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-15T20:18:29-07:00">
                2017-03-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introduce-two-concepts"><a href="#Introduce-two-concepts" class="headerlink" title="Introduce two concepts"></a>Introduce two concepts</h1><ol>
<li>Constraint Propogation</li>
<li>search</li>
</ol>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a href="http://norvig.com/sudoku.html" target="_blank" rel="external">Solving Every Sudoku Puzzle</a></p>
<h1 id="Heuristic"><a href="#Heuristic" class="headerlink" title="Heuristic"></a>Heuristic</h1><p>Some additional piece of information - a rule, function, constraints - that informs an otherwice brute-force algorithm to act in a more optimal manner</p>
<h1 id="Defining-intelligence"><a href="#Defining-intelligence" class="headerlink" title="Defining intelligence"></a>Defining intelligence</h1><ul>
<li>Should no equal human as intelligence, that will rule out almost all intelligent systems</li>
<li><strong>Intelligence should be defined in the context of tasks</strong>, rather than how we percieve the world.</li>
</ul>
<h1 id="Agent-Environment-and-state"><a href="#Agent-Environment-and-state" class="headerlink" title="Agent, Environment and state"></a>Agent, Environment and state</h1><img src="/imgs/nanodegree/ai1/nd_ai1_1/ai1_1_Screenshot1.png" class="[screenshot]">
<ul>
<li>Only software is the agent</li>
<li>Hardwares such as sensors will be considered part of the environment</li>
<li>But in a higher levell, the entire robot is considered as an agent</li>
<li>State - current state, goal state, history, etc…</li>
</ul>
<h1 id="Perception-action-cognition"><a href="#Perception-action-cognition" class="headerlink" title="Perception, action, cognition"></a>Perception, action, cognition</h1><ul>
<li>Perception - Agent retrieves properties of environment and knowing the environment</li>
<li>Action - Agent performs to change the properties of environment</li>
<li>Cognition - The process of determining what actions to take</li>
</ul>
<h1 id="Types-of-AI-Problems"><a href="#Types-of-AI-Problems" class="headerlink" title="Types of AI Problems"></a>Types of AI Problems</h1><ul>
<li>Fully observable - like Tic Tac Toe, where you can see the entire board and rules</li>
<li>Partial observable - like Battleship, where you cannot see your oponent’s position</li>
<li>Deterministic - where you know the result of each action</li>
<li>Stochastic - where there is uncertainty</li>
<li>Discrete - Only finite number of states</li>
<li>Continuous - Could be infinite number of states</li>
<li>Benign - Where only one agent can take action against environment</li>
<li>Adversarial - Multiple agents involved</li>
</ul>
<h1 id="Rational-Behavior-and-Bounded-Optimality"><a href="#Rational-Behavior-and-Bounded-Optimality" class="headerlink" title="Rational Behavior and Bounded Optimality"></a>Rational Behavior and Bounded Optimality</h1><h2 id="Rational-behavior"><a href="#Rational-behavior" class="headerlink" title="Rational behavior"></a>Rational behavior</h2><p>An agent will always take action in an environment in order to maximize its utility. - This could be hard to achieve in real world because there could be many limitations</p>
<h2 id="Bounded-Optimality"><a href="#Bounded-Optimality" class="headerlink" title="Bounded Optimality"></a>Bounded Optimality</h2><p>Also consider all limitations in real world. Hence, rather than requiring agent to act optimally, will set a feasible goal for agent that counts all obstacle and limitations in the real world problem. This also provide a good way to quantify an agent.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/08/omscs-os-8-memory-management/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/08/omscs-os-8-memory-management/" itemprop="url">
                  Operating System - Memory Management
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-08T21:45:18-08:00">
                2017-03-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li><strong>Physical</strong> &amp; <strong>Virtual Memory</strong> management</li>
<li>Review of memory management mechanisms</li>
<li>Illustration of advanced services</li>
</ul>
<h1 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">OS Memory</th>
<th style="text-align:center">Toy shop Part</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Uses intelligently sized container</td>
<td style="text-align:center">Memory pages or segments</td>
<td style="text-align:center">Crates of toy parts</td>
</tr>
<tr>
<td style="text-align:center">Not all parts are needed @ once</td>
<td style="text-align:center">Tasks operate on subset of memory</td>
<td style="text-align:center">toy orders completed in shapes</td>
</tr>
<tr>
<td style="text-align:center">Optimized for performances</td>
<td style="text-align:center">Reduce time to access state in memory -&gt; better performance</td>
<td style="text-align:center">reduce wait time for parts -&gt; make more toy</td>
</tr>
</tbody>
</table>
<h1 id="Memory-Management-Goal"><a href="#Memory-Management-Goal" class="headerlink" title="Memory Management Goal"></a>Memory Management Goal</h1><h2 id="Virtual-Memory-v-s-Physical-Memory"><a href="#Virtual-Memory-v-s-Physical-Memory" class="headerlink" title="Virtual Memory v.s. Physical Memory"></a>Virtual Memory v.s. Physical Memory</h2><pre><code>* Introducing virtual memory better supports address space for each process.
* Virtual Memory could be way larger than physical memory.
* Often cooperate with swapping mechanisms
</code></pre><h2 id="Operating-System-Should"><a href="#Operating-System-Should" class="headerlink" title="Operating System Should"></a>Operating System Should</h2><h3 id="1-Allocate"><a href="#1-Allocate" class="headerlink" title="1. Allocate"></a>1. Allocate</h3><pre><code>* **allocation**: Mechanisms &amp; algorithms &amp; data structure to track usage and status of Physical memory
* **replacement**: Because VM could be way larger than PM, and part of them will be in disk (swap)
</code></pre><h3 id="2-Arbitrate"><a href="#2-Arbitrate" class="headerlink" title="2. Arbitrate"></a>2. Arbitrate</h3><pre><code>* **Address Translation**
* **Address Validation**
</code></pre><h2 id="Page-based-Management"><a href="#Page-based-Management" class="headerlink" title="Page-based Management:"></a>Page-based Management:</h2><pre><code>* **Allocate**: Pages (VM) =&gt; Page Frames (PM)
* **Arbitrate**: Page tablespoon
</code></pre><h2 id="Segment-based-Management"><a href="#Segment-based-Management" class="headerlink" title="Segment-based Management:"></a>Segment-based Management:</h2><pre><code>* **Allocate**: Segments
* **Arbitrate**: Segment registers: base + bound pair, one pair for each segment
</code></pre><h1 id="Hardware-support"><a href="#Hardware-support" class="headerlink" title="Hardware support"></a>Hardware support</h1><h2 id="Memory-Management-Unit-MMU"><a href="#Memory-Management-Unit-MMU" class="headerlink" title="Memory Management Unit (MMU)"></a>Memory Management Unit (MMU)</h2><pre><code>1. Translate VM to PM **(TLB - Translation Lookaside Buffer)**
2. Reports **Faults**
    * Illegal access
    * Permission
    * Not presented in Main Memory
3. register
    * Pointer to **page tables** (Page table - based)
    * Base and bound registers, num of segments (Segment-based)
4. Cache - Translation Lookaside Buffer
5. Translation: Actual Physical Address Generation done in hardware
</code></pre><h1 id="Segmentation"><a href="#Segmentation" class="headerlink" title="Segmentation"></a>Segmentation</h1><h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><ol>
<li>Address space could be divided into segments</li>
<li>Flexible - arbitrary sizes instead of fixed size</li>
</ol>
<h2 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h2><ul>
<li>Virtual Addresses are divided into <strong>segment number</strong> and offset</li>
<li>Keeps a pair of base and bound registers to track validity inside a segment</li>
<li>Each segment is mapped (by CPU) to a physical address, and use <strong>segment selector + offset</strong> to get the physical address</li>
</ul>
<h2 id="Pros-and-cons"><a href="#Pros-and-cons" class="headerlink" title="Pros and cons"></a>Pros and cons</h2><ul>
<li>Pros:<ol>
<li>Flexible</li>
<li>OS keeps track of a list of free memory segments to decide which one will be allocated next</li>
<li>Relatively easy implementation</li>
</ol>
</li>
<li>Cons:<ol>
<li>Could lead to <strong>external fragmentation</strong></li>
<li>OS needs well designed mechanisms/algorisms to keep track and manipulate the <strong>free memory list</strong></li>
</ol>
</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot1.png" class="[screenshot]">
<h1 id="Page-Table"><a href="#Page-Table" class="headerlink" title="Page Table"></a>Page Table</h1><h2 id="Motivation-1"><a href="#Motivation-1" class="headerlink" title="Motivation"></a>Motivation</h2><ol>
<li>Varying sized memory blocks (i.e. segments) will lead to external fragmentation, and will result in memory waste.</li>
<li>Could use multi-level page tables to manage page table sizes, and utilize memory efficiently.</li>
</ol>
<h2 id="How-it-works-1"><a href="#How-it-works-1" class="headerlink" title="How it works"></a>How it works</h2><ul>
<li>Resides in <strong>Main Memory</strong></li>
<li>Map Virtual Addresses to Physical Addresses via <strong>Page Table</strong></li>
<li>For single level paging:<ol>
<li>Number of entries in page table equals to number of virtual pages</li>
<li>Each <strong>Page Table Entry (PTE)</strong> holds the <strong>Physical Page Number</strong> pointing to a page frame with same size in <strong>physical memory</strong>, as well as useful bits.</li>
<li>Virtial Address is divided into <strong>Virtual Page Number (VPN)</strong> and Offset. Using <strong>VPN</strong> to index the <strong>Physical Page Frame</strong>, and adding offset to locate the actual <strong>Physical Address</strong></li>
<li>One Page Table per process, managed by Operating System.</li>
<li>Hardware will maintain register pointing to the active page table, and it needs to be updated during context switch</li>
</ol>
</li>
</ul>
<h2 id="Pros-and-Cons"><a href="#Pros-and-Cons" class="headerlink" title="Pros and Cons"></a>Pros and Cons</h2><pre><code>* Pros:
    1. Fixed size pages would eliminate External Fragmentation
    2. 
* Cons:
    1. Because each translation will go through two menmory index, performance will be impacted. (**TBL** is introduced to address this)
    2. Waste memory if page is not used at all (will still allocate page entry for unused page) - Multi-layer page table is introduced to address this
</code></pre><img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot2.png" class="[screenshot]">
<h2 id="Multi-Level-page"><a href="#Multi-Level-page" class="headerlink" title="Multi Level page"></a>Multi Level page</h2><h3 id="How-it-works-2"><a href="#How-it-works-2" class="headerlink" title="How it works"></a>How it works</h3><ul>
<li>Outter Page Table - Page Directory: a table that holds entry which points to the actual page table</li>
<li>Internal Page Table - only for valid virtual memory regions</li>
<li>Virtual Address is split further</li>
</ul>
<h2 id="Could-keep-adding-additional-layers-especially-useful-for-64-bits"><a href="#Could-keep-adding-additional-layers-especially-useful-for-64-bits" class="headerlink" title="Could keep adding additional layers (especially useful for 64 bits)"></a>Could keep adding additional layers (especially useful for 64 bits)</h2><ul>
<li><strong>Plus</strong>: Reduce page size - smaller internal page tables/directories</li>
<li><strong>Downside</strong>: More memory accesses are required</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot3.png" class="[screenshot]">
<h1 id="TLB-Translation-Lookaside-Buffer"><a href="#TLB-Translation-Lookaside-Buffer" class="headerlink" title="TLB - Translation Lookaside Buffer"></a>TLB - Translation Lookaside Buffer</h1><ul>
<li><strong>Memory Management Units (Hardware)</strong> managing the cache for address translation</li>
<li>Stores translations, and will be first queried whenever a memory request happens.</li>
<li>If <strong>HIT</strong>, will return immediately. If <strong>Miss</strong>, will raise a fault: then OS will look for the targeting memory by going through page table, and place the resulting translation into this cache. Finally, will redo the memory fetch operation (PC will return to the place before the last operation)</li>
</ul>
<h1 id="Inverted-Page-Table"><a href="#Inverted-Page-Table" class="headerlink" title="Inverted Page Table"></a>Inverted Page Table</h1><ul>
<li>Use <strong>pid</strong> and <strong>p</strong> to index (index will match to Physical Frame)</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot4.png" class="[screenshot]">
<ul>
<li>Linear search is required - use hash function to narrow down search space</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot5.png" class="[screenshot]">
<h1 id="Page-Size"><a href="#Page-Size" class="headerlink" title="Page Size"></a>Page Size</h1><ul>
<li>Large Page Size could result in fewer page entires and smaller page table <strong>+</strong></li>
<li>Large Page Size could lead to <strong>Internal Fragmentation</strong> <strong>-</strong></li>
</ul>
<h1 id="Memory-Allocation"><a href="#Memory-Allocation" class="headerlink" title="Memory Allocation"></a>Memory Allocation</h1><h2 id="Memory-Allocator"><a href="#Memory-Allocator" class="headerlink" title="Memory Allocator"></a>Memory Allocator</h2><ul>
<li>Determines from VA to PA</li>
<li>Address translation, page table, etc… </li>
<li>Check validity/permissions</li>
</ul>
<h2 id="Kernal-Level-Allocator"><a href="#Kernal-Level-Allocator" class="headerlink" title="Kernal Level Allocator"></a>Kernal Level Allocator</h2><ul>
<li>Allocate kernal state and <strong>static</strong> process states</li>
</ul>
<h2 id="User-Level-Allocator"><a href="#User-Level-Allocator" class="headerlink" title="User Level Allocator"></a>User Level Allocator</h2><ul>
<li>Allocate <strong>dynamic</strong> process state (heap)</li>
</ul>
<h2 id="Mechanisms"><a href="#Mechanisms" class="headerlink" title="Mechanisms"></a>Mechanisms</h2><ul>
<li>Buddy Allocator<ol>
<li>Always subdividing available memory space halfly till the smallest fit one is found, and use that one. Then whenever that piece is freed, check recursively check its buddy; if both are freed, we could merge (aggregate) them.</li>
<li>Aggregates well</li>
<li>Internal Fragmentation</li>
</ol>
</li>
<li>Slab Allocator<ol>
<li>Caches common object type/sizes, on top of continuous memory</li>
<li>Avoid Internal Fragmentation</li>
</ol>
</li>
</ul>
<h1 id="Demanding-Pages"><a href="#Demanding-Pages" class="headerlink" title="Demanding Pages"></a>Demanding Pages</h1><img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot6.png" class="[screenshot]">
<ul>
<li>We could also pin the page if we want the page to be always presented in memory - this will disable swap for that page</li>
</ul>
<h1 id="Freeing-up-Memory-Pages"><a href="#Freeing-up-Memory-Pages" class="headerlink" title="Freeing up Memory Pages"></a>Freeing up Memory Pages</h1><h2 id="When-should-we-swap"><a href="#When-should-we-swap" class="headerlink" title="When should we swap?"></a>When should we swap?</h2><ul>
<li>When memory usage is above threshold</li>
<li>When CPU usage is below some threshold</li>
</ul>
<h2 id="Which-Page-should-we-swap"><a href="#Which-Page-should-we-swap" class="headerlink" title="Which Page should we swap?"></a>Which Page should we swap?</h2><ul>
<li><strong>Least Recently Used</strong> - need <strong>Access Bit</strong> to track if a page is used recently</li>
<li>Pages that dont need to be written out. (For those needed, it will cost more cycle to access secondary storage)</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/26/vue-doc-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/26/vue-doc-notes/" itemprop="url">
                  Notes for Vue Documentation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T15:03:42-08:00">
                2017-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><h1 id="The-Vue-Instance"><a href="#The-Vue-Instance" class="headerlink" title="The Vue Instance"></a>The Vue Instance</h1><h2 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h2><ul>
<li><p>Every Vue vm is bootstrapped by creating a root Vue instance with the <strong>Vue</strong> constructor function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</div><div class="line">  <span class="comment">// options</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>Could pass in an <strong>option object</strong> to configure. <a href="https://vuejs.org/v2/api" target="_blank" rel="external">API ref</a></p>
</li>
</ul>
<h2 id="Properties-and-Methods"><a href="#Properties-and-Methods" class="headerlink" title="Properties and Methods"></a>Properties and Methods</h2><ul>
<li>Each Vue instance <strong>proxies</strong> all the properties found in its data object<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</div><div class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</div><div class="line">  <span class="attr">data</span>: data</div><div class="line">&#125;)</div><div class="line">vm.a === data.a <span class="comment">// -&gt; true</span></div><div class="line"><span class="comment">// setting the property also affects original data</span></div><div class="line">vm.a = <span class="number">2</span></div><div class="line">data.a <span class="comment">// -&gt; 2</span></div><div class="line"><span class="comment">// ... and vice-versa</span></div><div class="line">data.a = <span class="number">3</span></div><div class="line">vm.a <span class="comment">// -&gt; 3</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Life-Cycle-Hooks"><a href="#Life-Cycle-Hooks" class="headerlink" title="Life Cycle Hooks"></a>Life Cycle Hooks</h2><ul>
<li><a href="https://vuejs.org/v2/api/#created" target="_blank" rel="external">created</a></li>
<li><a href="https://vuejs.org/v2/api/#mounted" target="_blank" rel="external">mounted</a></li>
<li><a href="https://vuejs.org/v2/api/#updated" target="_blank" rel="external">updated</a></li>
<li><a href="https://vuejs.org/v2/api/#destroyed" target="_blank" rel="external">destroy</a><img src="/imgs/vue_doc/lifecycle.png" class="[screenshot]"></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/25/omscs-os-7-scheduling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/25/omscs-os-7-scheduling/" itemprop="url">
                  Operating System - Scheduling
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-25T19:20:13-08:00">
                2017-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li><strong>Scheduling</strong> Mechanisms, Algorithmn and data structures</li>
<li>Linux O(1) scheduler</li>
<li>Scheduling on **Multi-CPUs</li>
</ul>
<h1 id="Visual-Methaphor"><a href="#Visual-Methaphor" class="headerlink" title="Visual Methaphor"></a>Visual Methaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">OS Scheduler</th>
<th style="text-align:center">Toy shop manager</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Dispatch/Assign orders/tasks immediately</td>
<td style="text-align:center">Scheduling is simple (FCFS)</td>
<td style="text-align:center">Scheduling is simple (FiFO)</td>
</tr>
<tr>
<td style="text-align:center">Dispatch/Assign simpler orders/tasks first</td>
<td style="text-align:center">Maximize throughput (Shortest Job First)</td>
<td style="text-align:center">Maximize # of orders processed over time (Need more time to process time to decide and pick order)</td>
</tr>
<tr>
<td style="text-align:center">Dispatch/Assign complex orders/tasks first</td>
<td style="text-align:center">Maximize utilization of CPU, devices, memory, …</td>
<td style="text-align:center">Keep workbenches busy</td>
</tr>
</tbody>
</table>
<h1 id="CPU-Scheduling"><a href="#CPU-Scheduling" class="headerlink" title="CPU Scheduling"></a>CPU Scheduling</h1><h2 id="CPU-scheduler"><a href="#CPU-scheduler" class="headerlink" title="CPU scheduler"></a>CPU scheduler</h2><ul>
<li>Decides how and when <strong>tasks (processes and threads)</strong> access shared CPUs</li>
<li>Schedules <strong>tasks</strong> running both <strong>user-level proccesses/threads</strong> and <strong>kernel level threads</strong></li>
<li>Chooses <strong>one</strong> of ready <strong>tasks</strong> to run on CPU</li>
<li>Runs when <ol>
<li><strong>CPU</strong> becomes <strong>idle</strong></li>
<li><strong>New tasks</strong> become ready (will interupt CPU)</li>
<li><strong>Timeslice</strong> expired timeout</li>
</ol>
</li>
<li>When <strong>Tasks</strong> are <strong>dispatched</strong> on CPU -&gt; context switch, set PC, etc…</li>
<li>The purose is to choose <strong>tasks from ready queue</strong></li>
<li>Immediate Questions:<ol>
<li><strong>Which</strong> task should be selected? -&gt; Scheduling policy/Algorithmn</li>
<li><strong>How</strong> is this done? -&gt; Depends on <strong>runqueue</strong> data structure (used to implement <strong>ready queue</strong>)</li>
</ol>
</li>
</ul>
<h2 id="“Run-to-Completion”-Scheduling"><a href="#“Run-to-Completion”-Scheduling" class="headerlink" title="“Run-to-Completion” Scheduling"></a>“Run-to-Completion” Scheduling</h2><h3 id="Initial-Assumptions"><a href="#Initial-Assumptions" class="headerlink" title="Initial Assumptions"></a>Initial Assumptions</h3><ol>
<li>Group of tasks/jobs</li>
<li>Known execution times</li>
<li>No preemption</li>
<li>Single CPU</li>
</ol>
<h3 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h3><ol>
<li>Throughput</li>
<li>Avg Completion time</li>
<li>Avg Wait Time</li>
<li></li>
</ol>
<h3 id="Algorithmn"><a href="#Algorithmn" class="headerlink" title="Algorithmn"></a>Algorithmn</h3><ul>
<li>First Come First Serve (FCFS)<ul>
<li>runqueue == <strong>queue(FIFO)</strong></li>
</ul>
</li>
<li>Shortest Job First (SJF)<ul>
<li>Schedules tasks in order of their <strong>execution time</strong></li>
<li>Runqueue == <strong>queue(priority queue)</strong> || <strong>tree(also a form of order)</strong> </li>
</ul>
</li>
</ul>
<h2 id="Preemptive-Scheduling"><a href="#Preemptive-Scheduling" class="headerlink" title="Preemptive Scheduling"></a>Preemptive Scheduling</h2><h3 id="SJF-Preemption"><a href="#SJF-Preemption" class="headerlink" title="SJF + Preemption"></a>SJF + Preemption</h3><ul>
<li>T2 arrives first</li>
<li>T2 should be preempted<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot1.png" class="[screenshot]"></li>
<li>When execution time is <strong>unknown</strong>, need to use <strong>heuristics</strong> based on history:<ol>
<li>How long did a task run last time?</li>
<li>How long did a task run last n times? <strong>(Windowed Average)</strong></li>
</ol>
</li>
</ul>
<h2 id="Priority-Scheduling"><a href="#Priority-Scheduling" class="headerlink" title="Priority Scheduling"></a>Priority Scheduling</h2><ul>
<li>Task have different <strong>priority levels</strong></li>
<li>Run <strong>highest priority</strong> task next (preemption)</li>
<li>Runqueues:<ol>
<li>One queue per priority</li>
<li>Tree ordered based on priority</li>
</ol>
</li>
<li><strong>DANGEROUS: Starvation</strong>: low priority task never gets executed<ul>
<li>Fix -&gt; <strong>“priority aging”</strong>: priority = f(actual_priority, time spent in run queue)</li>
<li>The longer the task in run queue, the higher its priority is</li>
<li>Tasks will eventually run</li>
</ul>
</li>
</ul>
<h2 id="Priority-Inversion"><a href="#Priority-Inversion" class="headerlink" title="Priority Inversion"></a>Priority Inversion</h2><img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot2.png" class="[screenshot]">
<h2 id="Round-Robin-Scheduling"><a href="#Round-Robin-Scheduling" class="headerlink" title="Round Robin Scheduling"></a>Round Robin Scheduling</h2><ul>
<li>Pick up first task from queue (like FCFS)</li>
<li><strong>Task may yield, to wait on I/O (unlike FCFS)</strong></li>
<li>Round Robin with <strong>Priorities</strong>: include preemption</li>
<li>Round Robin with <strong>Interleaving</strong>: introduce <strong>timeslicing</strong></li>
</ul>
<h2 id="Timesharing-and-Timeslices"><a href="#Timesharing-and-Timeslices" class="headerlink" title="Timesharing and Timeslices"></a>Timesharing and Timeslices</h2><h3 id="Timeslice"><a href="#Timeslice" class="headerlink" title="Timeslice"></a>Timeslice</h3><ul>
<li>Maximum amount of uninterrupted time given to a task =&gt; <strong>time quantum</strong></li>
<li>Task may run <strong>less than</strong> timeslice time. Due to:<ol>
<li>Has to wait on I/O, synchronization… =&gt; will be placed on a queue</li>
<li>Higher priority task becomes runnable</li>
</ol>
</li>
<li>Using timeslices tasks are <strong>interleaved</strong>: timesharing the CPU<ul>
<li>Preempted after <strong>timeslice</strong></li>
</ul>
</li>
<li><strong>Note: FSFC == Round Robin without timeslices</strong></li>
<li>Benefits:<ol>
<li>Keeps the simplicity, just as FCFS Has</li>
<li>Achieved good metrics as SJF algorithmn, but doesn’t need to worry about the finding out the “shortest” task</li>
<li>Short tasks finish sooner</li>
<li>More responsive (User will see the task is running)</li>
<li>Lengthy I/O operations initiated sooner</li>
</ol>
</li>
<li>Downside:<ul>
<li>Overheads: interrupt, schedule, context switch =&gt; <strong>keep timeslice &gt;&gt;&gt; context_switch_time</strong></li>
</ul>
</li>
<li>Example:<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot3.png" class="[screenshot]">
</li>
</ul>
<h3 id="How-long-should-a-timeslice-be"><a href="#How-long-should-a-timeslice-be" class="headerlink" title="How long should a timeslice be?"></a>How long should a timeslice be?</h3><ul>
<li>Balance <strong>benefits</strong> and <strong>overheads</strong></li>
</ul>
<h4 id="For-IO-bound-tasks"><a href="#For-IO-bound-tasks" class="headerlink" title="For IO-bound tasks"></a>For <strong>IO-bound</strong> tasks</h4><ul>
<li>Example<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot5.png" class="[screenshot]"></li>
<li>Pick smaller timeslice, because:<ul>
<li>It will run more quickly to issue I/O requests</li>
<li>Keeps both the CPU and the I/O devices busy</li>
<li>Better user-perceived performance (i.e. Responsive)</li>
</ul>
</li>
</ul>
<h3 id="For-CPU-bound-tasks"><a href="#For-CPU-bound-tasks" class="headerlink" title="For CPU-bound tasks"></a>For <strong>CPU-bound</strong> tasks</h3><ul>
<li>Example<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot4.png" class="[screenshot]"></li>
<li>Pick larger timeslice, because:<ul>
<li>users will care more about <strong>completion time</strong> and <strong>throughput</strong> instead of <strong>wait time</strong></li>
<li>Limits context switching overheads</li>
<li>Keeps CPU utilization and throughput high</li>
</ul>
</li>
</ul>
<h2 id="Runqueue-Data-structures"><a href="#Runqueue-Data-structures" class="headerlink" title="Runqueue Data structures"></a>Runqueue Data structures</h2><ul>
<li>The philosophy is to allow scheduler easily finding the next and best task to schedule</li>
<li>If we want <strong>I/O and CPU bound tasks</strong> to have different timeslices, then<ol>
<li>Same runqueue, check type</li>
<li>Two different structures</li>
</ol>
</li>
<li>Example:<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot6.png" class="[screenshot]"></li>
<li>How do we know if a task is I/O or CPU bound? How intensive it is? -&gt; Use <strong>history heuristic</strong></li>
<li>How about new tasks and dynamically changing tasks?<ul>
<li>Multi-Level Feedback Queue (MLFQ)</li>
<li>Not Priority Queues<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot7.png" class="[screenshot]">
</li>
</ul>
</li>
</ul>
<h1 id="Linux-O-1-Scheduler"><a href="#Linux-O-1-Scheduler" class="headerlink" title="Linux O(1) Scheduler"></a>Linux O(1) Scheduler</h1><img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot8.png" class="[screenshot]">
<h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><ul>
<li>Constant time to select/add task, regardless of task count</li>
<li><strong>Preemptive, priority-based</strong><ul>
<li>real time (0-99)</li>
<li>timesharing (100-139)</li>
</ul>
</li>
<li>User processes<ul>
<li>Default 120</li>
<li>nicevalue(-20 to 19)</li>
</ul>
</li>
</ul>
<h2 id="Timeslice-Value"><a href="#Timeslice-Value" class="headerlink" title="Timeslice Value"></a>Timeslice Value</h2><ul>
<li>Depends on priority</li>
<li>Smallest for low priority</li>
<li>Highest for hight priority</li>
</ul>
<h2 id="Feedback"><a href="#Feedback" class="headerlink" title="Feedback"></a>Feedback</h2><ul>
<li>Sleep time: waiting/idling</li>
<li>Longer sleep =&gt; interactive =&gt; priority - 5 =&gt; <strong>boost</strong></li>
<li>Smaller Sleep (compute intensive) =&gt; priority + 5 =&gt; <strong>lower priority</strong></li>
</ul>
<h2 id="Runqueue"><a href="#Runqueue" class="headerlink" title="Runqueue"></a>Runqueue</h2><img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot9.png" class="[screenshot]">
<ul>
<li>2 arrays of tasks</li>
<li><strong>Active</strong><ul>
<li>Used to pick next task to run</li>
<li>Constant time to <strong>add/select</strong></li>
<li>Tasks remain in queue in active until timeslice expires</li>
</ul>
</li>
<li><strong>Expired</strong><ul>
<li>Inactive list</li>
<li>When no more tasks in active array =&gt; <strong>swap active and expired arrays</strong></li>
</ul>
</li>
</ul>
<h2 id="Pros-and-Cons"><a href="#Pros-and-Cons" class="headerlink" title="Pros and Cons"></a>Pros and Cons</h2><ul>
<li>Pros: O(1)</li>
<li>Cons:<ul>
<li>Performance of interactive tasks (tasks in expired queue is not scheduled)</li>
<li>Fairness</li>
</ul>
</li>
</ul>
<h1 id="Completely-Fair-Scheduler-CFS"><a href="#Completely-Fair-Scheduler-CFS" class="headerlink" title="Completely Fair Scheduler (CFS)"></a>Completely Fair Scheduler (CFS)</h1><h2 id="Runqueue-1"><a href="#Runqueue-1" class="headerlink" title="Runqueue"></a>Runqueue</h2><ul>
<li>Red-Black Tree</li>
<li>Ordered by “virtural runtime”</li>
<li>“Virtual time” == time spent on CPU</li>
</ul>
<h2 id="CFS-Scheduling"><a href="#CFS-Scheduling" class="headerlink" title="CFS Scheduling"></a>CFS Scheduling</h2><ul>
<li>Always pick left-most node (always schedule task with least amount of time on CPU)</li>
<li>Periodically adjust <strong>virtual runtime</strong></li>
<li>Compare to <strong>left most virtual runtime</strong><ul>
<li>If smaller, continue running</li>
<li>If larger, preempt and place appropriately in the tree</li>
</ul>
</li>
</ul>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><ul>
<li>Select task =&gt; O(1)</li>
<li>Add Task =&gt; O(logN)</li>
</ul>
<h1 id="Scheduling-on-Multi-CPU-Systems"><a href="#Scheduling-on-Multi-CPU-Systems" class="headerlink" title="Scheduling on Multi-CPU Systems"></a>Scheduling on Multi-CPU Systems</h1><h2 id="Shared-Memory-Multiprocessor-SMP-v-s-Multi-Cores"><a href="#Shared-Memory-Multiprocessor-SMP-v-s-Multi-Cores" class="headerlink" title="Shared Memory Multiprocessor (SMP) v.s. Multi-Cores"></a>Shared Memory Multiprocessor (SMP) v.s. Multi-Cores</h2><ul>
<li>SMP has multiple CPUs sharing the same memory, and each of them will have their own caches, and may or maynot share Last Level Cache (LLC)</li>
<li>Multi-Cores are CPUs that have multi cores inside it, each core has its private caches, and they share a LLC and memory</li>
<li>As far as OS concerns, both CPUs and Cores in a CPU are entities that they could schedule a thread/proccess on</li>
</ul>
<h2 id="Scheduling-on-Multi-CPU-Systems-1"><a href="#Scheduling-on-Multi-CPU-Systems-1" class="headerlink" title="Scheduling on Multi-CPU Systems"></a>Scheduling on Multi-CPU Systems</h2><ul>
<li>Cache-affinity <strong>IMPORTANT</strong><ul>
<li>Keep tasks on the same CPU as much as possible</li>
<li>Hiearchieal scheduler architecture</li>
<li><strong>Per-CPU</strong> runqueue and <strong>scheduler</strong><ol>
<li>Load balane across CPUs based on<br> a. Queue length<br> b. When CPU is idle</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="Non-Uniform-Memory-Access-Platform-NUMA-Platform"><a href="#Non-Uniform-Memory-Access-Platform-NUMA-Platform" class="headerlink" title="Non-Uniform Memory Access Platform (NUMA Platform)"></a>Non-Uniform Memory Access Platform (NUMA Platform)</h2><ul>
<li>Multiple <strong>memory nodes</strong></li>
<li><strong>Memory Node</strong> closer to a “”soket” of multiple processor<ul>
<li>Access to local main memory node is faster than access to remote main memory node</li>
</ul>
</li>
<li>Keep tasks on CPU closer to Main Memory where their state is -&gt; <strong>NUMA-aware scheduling</strong></li>
</ul>
<h1 id="Hyperthreading-SMT-Simultaneous-Multithreading"><a href="#Hyperthreading-SMT-Simultaneous-Multithreading" class="headerlink" title="Hyperthreading (SMT - Simultaneous Multithreading)"></a>Hyperthreading (SMT - Simultaneous Multithreading)</h1><ul>
<li>Multiple hardware-supported execution contexts (i.e. multiple sets of registers for different threads)</li>
<li>Still 1 CPU but with <strong>very fast</strong> context switch</li>
<li>From OS’s perspective, each set of regs will be seen as a virtual CPU</li>
<li>Can hide <strong>memory latency</strong> because now context switch is 0 cycle, but memory access is much greater</li>
<li>Reference: <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-fedorova-paper.pdf" target="_blank" rel="external">“Chip Multithreading Systems Need a New Operating System Scheduler”.</a></li>
</ul>
<h1 id="Threads-and-SMT"><a href="#Threads-and-SMT" class="headerlink" title="Threads and SMT"></a>Threads and SMT</h1><h2 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h2><ol>
<li>Thread issues instruction on each cycle, max <strong>instruction per cycle (IPC)</strong> is 1</li>
<li>Memory access = 4 cycles</li>
<li>Hardware switching instaneously</li>
<li>SMT with 2 hardware threads</li>
</ol>
<h2 id="Co-schedule-compute-bound-threads"><a href="#Co-schedule-compute-bound-threads" class="headerlink" title="Co-schedule compute-bound threads"></a>Co-schedule <strong>compute-bound</strong> threads</h2><ul>
<li>Threads <strong>“interfere”</strong></li>
<li><strong>“contend”</strong> for CPU pipline resource</li>
<li><strong>Performance degrades</strong> by 2x</li>
<li>Memory Idle</li>
</ul>
<h2 id="Co-schedule-memory-bound-threads"><a href="#Co-schedule-memory-bound-threads" class="headerlink" title="Co-schedule memory-bound threads"></a>Co-schedule <strong>memory-bound</strong> threads</h2><ul>
<li>CPU idle</li>
<li>Waste CPU cycles</li>
</ul>
<h2 id="Co-schedule-compute-and-memory-bound-threads"><a href="#Co-schedule-compute-and-memory-bound-threads" class="headerlink" title="Co-schedule compute- and memory-bound threads"></a>Co-schedule <strong>compute- and memory-bound</strong> threads</h2><ul>
<li>Mix of CPU- and Memory-intensive threads</li>
<li>BINGO!</li>
<li>Avoid/limit contention on processor pipeline</li>
<li>All components (CPU and memory) are well utilized</li>
<li>Still leads to interference and degration, but minimal</li>
</ul>
<h2 id="CPU-bound-or-Memory-Boud"><a href="#CPU-bound-or-Memory-Boud" class="headerlink" title="CPU bound or Memory Boud?"></a>CPU bound or Memory Boud?</h2><ul>
<li>Use historic information<ul>
<li>“sleep time” wont work: the thread is not sleeping when waiting on Mm</li>
<li>Software takse too much time to compute this</li>
</ul>
</li>
<li>Use Hardware Counters</li>
</ul>
<h2 id="Is-Cycle-per-Instruction-useful"><a href="#Is-Cycle-per-Instruction-useful" class="headerlink" title="Is Cycle-per-Instruction useful?"></a>Is Cycle-per-Instruction useful?</h2><ul>
<li>Simulation based evaluation</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/22/omscs-os-6-thread-performance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/22/omscs-os-6-thread-performance/" itemprop="url">
                  Operating System - Thread Performance
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-22T20:16:35-08:00">
                2017-02-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li>Performance comparison betwee <strong>multi-process</strong>, <strong>multi-thread</strong> and <strong>event-driven</strong></li>
<li>Event Driven Architecture: <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-pai-paper.pdf" target="_blank" rel="external">Flash: An Efficient and Portable Web Server</a> v.s. <strong>Apache</strong></li>
</ul>
<h1 id="Metrics-to-determine-which-model-is-better"><a href="#Metrics-to-determine-which-model-is-better" class="headerlink" title="Metrics to determine which model is better?"></a>Metrics to determine which model is better?</h1><ul>
<li>Execution time</li>
<li>Avg time to complete order</li>
</ul>
<h1 id="Are-Threads-Useful"><a href="#Are-Threads-Useful" class="headerlink" title="Are Threads Useful?"></a>Are Threads Useful?</h1><h2 id="Previously-yes"><a href="#Previously-yes" class="headerlink" title="Previously, yes:"></a>Previously, yes:</h2><ul>
<li><strong>Parallelization</strong> -&gt; Speed up!</li>
<li><strong>Specialization</strong> -&gt; Hot cache!</li>
<li><strong>Efficiency</strong> -&gt; Lower memory requirement and cheaper synchronization</li>
<li>Hide latency of I/O Operation on <strong>single CPU</strong></li>
</ul>
<h2 id="But-what-is-useful-could-be-different-from-case-to-case"><a href="#But-what-is-useful-could-be-different-from-case-to-case" class="headerlink" title="But what is useful could be different from case to case"></a>But what is useful could be different from case to case</h2><ul>
<li>For a matrix multiply app, <strong>execution time</strong> is important.</li>
<li>For a web service, <strong>avg time, min/max</strong> are important. (e.g. number of requests, response time)</li>
<li>For hardware, <strong>high utilization</strong> is important.</li>
</ul>
<h2 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h2><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">Metrics in Thread</th>
<th style="text-align:center">Metrics in toy shop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Throughput</td>
<td style="text-align:center">Process completion time</td>
<td style="text-align:center">How many toys per hour</td>
</tr>
<tr>
<td style="text-align:center">Response Time</td>
<td style="text-align:center">Average time to response to input (e.g. mouse click)</td>
<td style="text-align:center">Avg time to react to an order</td>
</tr>
<tr>
<td style="text-align:center">Utilization</td>
<td style="text-align:center">Percentage of CPU</td>
<td style="text-align:center">Percentage of workbenches in use overtime</td>
</tr>
<tr>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
</tr>
</tbody>
</table>
<h2 id="Performance-Metrics"><a href="#Performance-Metrics" class="headerlink" title="Performance Metrics"></a>Performance Metrics</h2><p>Metrics is a measurement standard that is <strong>measurable</strong> and <strong>quantifiable</strong>, and can be used to <strong>evaluate system behavior</strong>.</p>
<img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot1.png" class="[screenshot]">
<h2 id="Are-Threads-Really-Useful"><a href="#Are-Threads-Really-Useful" class="headerlink" title="Are Threads Really Useful?"></a>Are Threads Really Useful?</h2><ul>
<li><strong>(Almost)</strong> alwasy correct, but <strong>NEVER ACCEPTED</strong></li>
<li>It depends on <strong>metrics</strong> and <strong>workload</strong></li>
<li>Examples:<ol>
<li>Different number of toy orders =&gt; <strong>Different implementations of toy shop</strong></li>
<li>Different graph =&gt; <strong>Different shortest path algorithms</strong></li>
<li>Different file patterns =&gt; <strong>Different file system</strong></li>
</ol>
</li>
</ul>
<h1 id="How-to-provide-best-concurrency"><a href="#How-to-provide-best-concurrency" class="headerlink" title="How to provide best concurrency?"></a>How to provide best concurrency?</h1><h2 id="Multi-threads-v-s-Multi-processes"><a href="#Multi-threads-v-s-Multi-processes" class="headerlink" title="Multi-threads v.s. Multi-processes"></a><strong>Multi-threads</strong> v.s. <strong>Multi-processes</strong></h2><p>Imagine a <strong>simple</strong> web server like this</p>
<img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot2.png" class="[screenshot]">
<h3 id="Multi-Processes"><a href="#Multi-Processes" class="headerlink" title="Multi Processes"></a>Multi Processes</h3><img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot3.png" class="[screenshot]">
<h3 id="Multi-Threaded"><a href="#Multi-Threaded" class="headerlink" title="Multi Threaded"></a>Multi Threaded</h3><img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot4.png" class="[screenshot]">
<h2 id="Event-Driven-Model"><a href="#Event-Driven-Model" class="headerlink" title="Event Driven Model"></a>Event Driven Model</h2><ul>
<li>Single address space!</li>
<li>Single process!</li>
<li>Single thread!</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot5.png" class="[screenshot]">
<ul>
<li>The <strong>handler</strong> will <strong>run to completion</strong>. If it needs to blocking, will perform the blocking operation and hand over controls to <strong>dispatcher</strong>.</li>
</ul>
<h2 id="Concurrency-in-different-models"><a href="#Concurrency-in-different-models" class="headerlink" title="Concurrency in different models:"></a>Concurrency in different models:</h2><ul>
<li>In <strong>Multi-threaded</strong> and <strong>Multi-processes</strong>, one request per execution context(i.e. thread/process).</li>
<li>In <strong>Event Driven</strong>, many requests <strong>interleaved</strong> in an execution context.<ul>
<li>Single thread switches among processing different requests</li>
</ul>
</li>
</ul>
<h2 id="WHY-Event-Driven-Model"><a href="#WHY-Event-Driven-Model" class="headerlink" title="WHY Event Driven Model"></a><strong>WHY</strong> Event Driven Model</h2><img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot6.png" class="[screenshot]">
<h2 id="Benefits-of-Event-Driven-Model"><a href="#Benefits-of-Event-Driven-Model" class="headerlink" title="Benefits of Event Driven Model"></a>Benefits of Event Driven Model</h2><ul>
<li><strong>Single</strong> address space</li>
<li><strong>Single</strong> flow of control</li>
<li><strong>Smaller</strong> memory requirements</li>
<li><strong>NO</strong> context switch</li>
<li><strong>NO</strong> synchronization</li>
</ul>
<h2 id="Problems-with-Event-Driven-Model"><a href="#Problems-with-Event-Driven-Model" class="headerlink" title="Problems with Event Driven Model"></a>Problems with Event Driven Model</h2><p>A blocking request/handler will block the entire process</p>
<h3 id="Asynchronous-I-O-Operation-System-Calls"><a href="#Asynchronous-I-O-Operation-System-Calls" class="headerlink" title="Asynchronous I/O Operation, System Calls"></a>Asynchronous I/O Operation, System Calls</h3><ul>
<li><strong>Process/thread</strong> makes system Calls</li>
<li><strong>Operating System</strong> collect all the necessary info from stack, and either learns where to return the result or tell the caller where to collect result</li>
<li><strong>Process/thread</strong> can continue</li>
<li>Require supports from <strong>kernel</strong> or <strong>device</strong></li>
<li><strong>Fit nice</strong> in Event Driven Model</li>
</ul>
<h3 id="Introduce-Helpers-when-async-calls-are-not-available"><a href="#Introduce-Helpers-when-async-calls-are-not-available" class="headerlink" title="Introduce Helpers when async calls are not available"></a>Introduce <strong>Helpers</strong> when async calls are not available</h3><ul>
<li>Designated for <strong>blocking I/O Operations only</strong></li>
<li><strong>pipe/socket</strong> based communication with event dispatch. They also have a <strong>file descriptor</strong> interface, which means <strong>select(), poll() and epoll()</strong> all work</li>
<li>Helper blocks but main loop continues.</li>
<li>If helpers are processes, the system is called <strong>Asymmetric Multi-Processes Event Driven Model (AMPED)</strong></li>
<li>If helpers are threads, the system is called <strong>Asymmetric Multi-Threaded Event Driven Model (AMTED)</strong></li>
<li>Pros:<ol>
<li>Resolves portability limitation of basic Event Driven Model</li>
<li>Smaller footprints than regular worker threads</li>
</ol>
</li>
<li>Cons:<ol>
<li>Applicability to certain classes of applications</li>
<li>Event routing on multi CPU system could be a problem</li>
</ol>
</li>
</ul>
<h2 id="Flash-Server"><a href="#Flash-Server" class="headerlink" title="Flash Server"></a>Flash Server</h2><img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot7.png" class="[screenshot]">
<img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot8.png" class="[screenshot]">
<h2 id="Apache-Server"><a href="#Apache-Server" class="headerlink" title="Apache Server"></a>Apache Server</h2><img src="/imgs/OMSCS/OS/OS_6/OS_6_Screenshot9.png" class="[screenshot]">
<h1 id="Experimental-Methodology"><a href="#Experimental-Methodology" class="headerlink" title="Experimental Methodology"></a>Experimental Methodology</h1><h2 id="Setting-up-Performance-comparison"><a href="#Setting-up-Performance-comparison" class="headerlink" title="Setting up Performance comparison"></a>Setting up Performance comparison</h2><h3 id="Define-Comparison-Point"><a href="#Define-Comparison-Point" class="headerlink" title="Define Comparison Point"></a>Define Comparison Point</h3><ul>
<li><strong>What systems</strong> are you comparing</li>
<li>Multi-Process (each process has one thread)</li>
<li>Multi-Thread</li>
<li>Single Process Event Driven (SPED);</li>
<li>Apache</li>
<li>Flash (AMPED)</li>
</ul>
<h3 id="Define-Inputs"><a href="#Define-Inputs" class="headerlink" title="Define Inputs"></a>Define Inputs</h3><ul>
<li><strong>What workloads</strong> will be used</li>
<li>Realistic workload: Distribution of web pages request over time</li>
<li>Controlled, reproducible workload <strong>(Trace based)</strong>:<ol>
<li>CS Web Server Trace</li>
<li>Owlnet Trace</li>
<li>Synthetic workload</li>
</ol>
</li>
</ul>
<h3 id="Define-Metrics"><a href="#Define-Metrics" class="headerlink" title="Define Metrics"></a>Define Metrics</h3><ul>
<li><strong>How</strong> will you measure performance</li>
<li><strong>Bandwidth</strong>: bytes/time - <strong>total bytes transferred / transferred time</strong></li>
<li><strong>Connection Rate</strong>: Request/Time - <strong>total request connection / total time</strong></li>
<li>Evaluate <strong>both</strong> as a function of file size:<ul>
<li>Larger file: higher Bandwidth</li>
<li>Larger file: lower connection rate</li>
</ul>
</li>
</ul>
<h2 id="Summary-of-Performance-Results"><a href="#Summary-of-Performance-Results" class="headerlink" title="Summary of Performance Results"></a>Summary of Performance Results</h2><h3 id="When-Data-is-in-Cache"><a href="#When-Data-is-in-Cache" class="headerlink" title="When Data is in Cache:"></a>When Data is in Cache:</h3><ul>
<li><strong>SPED &gt;&gt; AMPED Flash</strong>, because AMPED Flash has unnecessary test for memory presence</li>
<li><strong>SPED &amp; AMPED Flash &gt;&gt; MP&amp;MT</strong>, because of synchronization and context switching overhead in MP&amp;MT</li>
</ul>
<h3 id="When-disk-bound-work-load"><a href="#When-disk-bound-work-load" class="headerlink" title="When disk-bound work load:"></a>When disk-bound work load:</h3><ul>
<li><strong>AMPED Flash &gt;&gt; SPED</strong>, because SPED will be blocked because of no async I/O</li>
<li><strong>AMPED Flash &gt;&gt; MT&amp;MP</strong>, because of more memory efficiency and less context switching</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/20/omscs-os-5-pthread-implementation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/20/omscs-os-5-pthread-implementation/" itemprop="url">
                  Operating System - Thread Design
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-20T17:43:56-08:00">
                2017-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li><strong>kernel thread</strong> v.s. <strong>user thread</strong></li>
<li>Thread and <strong>interupt</strong></li>
<li>Thread and <strong>signal</strong></li>
<li>Linux thread model</li>
</ul>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li><a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-eykholt-paper.pdf" target="_blank" rel="external">Beyond Multiprocessing…Multithreading the SunOS Kernel</a></li>
<li><a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-stein-shah-paper.pdf" target="_blank" rel="external">Implementing Lightweight Thread</a></li>
</ol>
<h1 id="Kernel-Level-Threads-v-s-Usere-Level-Thread"><a href="#Kernel-Level-Threads-v-s-Usere-Level-Thread" class="headerlink" title="Kernel Level Threads v.s. Usere Level Thread"></a>Kernel Level Threads v.s. Usere Level Thread</h1><h2 id="Kernel-Level-Threads"><a href="#Kernel-Level-Threads" class="headerlink" title="Kernel Level Threads"></a>Kernel Level Threads</h2><ul>
<li>OS kernel maintains<ol>
<li>thread abstraction</li>
<li>scheduling, sync, etc…</li>
</ol>
</li>
<li>Data Structures<ul>
<li>Split the <strong>Process Control Block</strong>:<ol>
<li><strong>PCB:</strong> Virtual Addresses mappings and other additional information used by all threads</li>
<li><strong>Kernel Level Thread (KLT):</strong> stack, registers, etc…</li>
</ol>
</li>
</ul>
</li>
<li>When context switching KLT, a portion of information in PCB will be only linked to a specific thread, so we need to respect that. Hence, split PCB infor into:<ol>
<li><strong>“Hard” process state:</strong> relevant for all of the <strong>user level threads</strong> that execute within the process<ul>
<li>Virtual Addresses</li>
</ul>
</li>
<li><strong>“Light” process state:</strong> <strong>a subset of the user level threads</strong> that are currently associated with a particular KLT<ul>
<li>Signal</li>
<li>Systemcall</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="User-Level-Threads"><a href="#User-Level-Threads" class="headerlink" title="User Level Threads"></a>User Level Threads</h2><ul>
<li>User level uses library to provide<ol>
<li>thread abstraction</li>
<li>scheduling, sync, etc…</li>
</ol>
</li>
<li>Libraries could vary in different applications/processes</li>
<li>Data Structures <strong>(User Level Thread (ULT))</strong> - Managed by the thread library<ul>
<li>UL thread ID</li>
<li>UL regs</li>
<li>Thread stack</li>
</ul>
</li>
<li>From User Level Threads’ perspective, Kernel Level Thread will be like a virtual CPU.</li>
</ul>
<h2 id="Rationale-for-Multiple-Data-Structures"><a href="#Rationale-for-Multiple-Data-Structures" class="headerlink" title="Rationale for Multiple Data Structures"></a>Rationale for Multiple Data Structures</h2><table>
<thead>
<tr>
<th style="text-align:center">Single PCB</th>
<th style="text-align:center">Multiple Data Structure</th>
<th style="text-align:center">Benefit of multiple data structure</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Large continuous data structure</td>
<td style="text-align:center">Smaller data structure</td>
<td style="text-align:center">Scalability</td>
</tr>
<tr>
<td style="text-align:center">Private for each entity</td>
<td style="text-align:center">Easier to share</td>
<td style="text-align:center">Overheads</td>
</tr>
<tr>
<td style="text-align:center">Saved and restored on each context switch</td>
<td style="text-align:center">On context switch only save and restore what needs to change</td>
<td style="text-align:center">Performance</td>
</tr>
<tr>
<td style="text-align:center">Update for any changes</td>
<td style="text-align:center">User Level library needs only update portion of the state</td>
<td style="text-align:center">Flexibility</td>
</tr>
</tbody>
</table>
<h2 id="User-Level-Thread-Data-Structure-in-Implementing-Lightweight-Thread"><a href="#User-Level-Thread-Data-Structure-in-Implementing-Lightweight-Thread" class="headerlink" title="User Level Thread Data Structure in Implementing Lightweight Thread"></a>User Level Thread Data Structure in <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-stein-shah-paper.pdf" target="_blank" rel="external">Implementing Lightweight Thread</a></h2><ul>
<li><strong>NOT</strong> PThread, but similar</li>
<li>Thread creation =&gt; thread ID (tid)<ul>
<li><strong>tid</strong> is and index into table of pointers, not directly pointing the thread structure</li>
<li>Table pointers point to per thread data structure. The nice thing of this is: when there is error in the thread, the tid is still a valid pointer, and the table content could be encoded to imply errors/feedbacks</li>
<li>Stack growth can be <strong>dangerous</strong>, as one thread could overwrite other threads’ information<ul>
<li>Solution: Red zone. When a thread is trying to access/writing into the red zone, it will raise up a fault, so that OS could aware of what is happening and which thread is causing this problem</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Kernel-Level-Thread-Data-Structure-in-Implementing-Lightweight-Thread"><a href="#Kernel-Level-Thread-Data-Structure-in-Implementing-Lightweight-Thread" class="headerlink" title="Kernel Level Thread Data Structure in Implementing Lightweight Thread"></a>Kernel Level Thread Data Structure in <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-stein-shah-paper.pdf" target="_blank" rel="external">Implementing Lightweight Thread</a></h2><h3 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h3><ul>
<li>List of <strong>kernel level threads</strong></li>
<li>Virtual Address Space</li>
<li>User Credentials</li>
<li>Signal handlers</li>
</ul>
<h3 id="Light-weight-Process-LWP"><a href="#Light-weight-Process-LWP" class="headerlink" title="Light-weight Process (LWP)"></a>Light-weight Process (LWP)</h3><ul>
<li>User level registers</li>
<li>System call args</li>
<li>Resource usage info</li>
<li>Signal Mask</li>
<li>It is similar to ULT, but visible to kernel. </li>
<li><strong>Not needed when process is not running</strong> (Swappable)</li>
</ul>
<h3 id="Kernel-Level-Threads-1"><a href="#Kernel-Level-Threads-1" class="headerlink" title="Kernel Level Threads"></a>Kernel Level Threads</h3><ul>
<li>Kernel Level registers</li>
<li>Stack pointer</li>
<li>Scheduling info (class, …)</li>
<li>Pointers to associated <strong>LWP, process, CPU Structures</strong></li>
<li>Information needed even when process is not running =&gt; <strong>NOT Swappable</strong></li>
</ul>
<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><ul>
<li>Current thread</li>
<li>List of <strong>kernel-level thread</strong></li>
<li>Dispatching&amp;interrupt handling information</li>
</ul>
<h2 id="Kernel-Level-Thread-Data-Structure-in-Beyond-Multiprocessing…Multithreading-the-SunOS-Kernel"><a href="#Kernel-Level-Thread-Data-Structure-in-Beyond-Multiprocessing…Multithreading-the-SunOS-Kernel" class="headerlink" title="Kernel Level Thread Data Structure in Beyond Multiprocessing…Multithreading the SunOS Kernel"></a>Kernel Level Thread Data Structure in <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-eykholt-paper.pdf" target="_blank" rel="external">Beyond Multiprocessing…Multithreading the SunOS Kernel</a></h2><img src="/imgs/OMSCS/OS/OS_5/OS_5_Screenshot1.png" class="[screenshot]">
<h2 id="Problem-in-Basic-Thread-Management-Interations"><a href="#Problem-in-Basic-Thread-Management-Interations" class="headerlink" title="Problem in Basic Thread Management Interations"></a>Problem in Basic Thread Management Interations</h2><ul>
<li>User Level Library doesnot know what is happening in the kernel</li>
<li>Kernel does not know what is happening in User Level Library<br>Therefore, need <strong>system calls</strong> and <strong>special signals</strong> allow kernel and ULT library to interact and coordinate.</li>
</ul>
<h1 id="Lack-of-Thread-Management-Visibility"><a href="#Lack-of-Thread-Management-Visibility" class="headerlink" title="Lack of Thread Management Visibility"></a>Lack of Thread Management Visibility</h1><ul>
<li><strong>UL Library</strong> sees<ul>
<li>ULTs</li>
<li>Available KLTs</li>
</ul>
</li>
<li><strong>Kernel</strong> sees<ul>
<li>KLTs</li>
<li>CPUs</li>
<li>Kernel Level Scheduler</li>
</ul>
</li>
<li>Problem: <strong>visibility</strong> of <strong>state</strong> and <strong>decisions</strong> between kernel and UL library<ul>
<li><strong>1-1 model</strong> helps address some of these issues</li>
</ul>
</li>
</ul>
<h2 id="How-When-does-the-UL-Library-run"><a href="#How-When-does-the-UL-Library-run" class="headerlink" title="How/When does the UL Library run?"></a>How/When does the UL Library run?</h2><ul>
<li><strong>ULTs</strong> explicitly yield</li>
<li>Timer set by <strong>UL Library</strong> expires</li>
<li><strong>ULTs</strong> call library functions like lock/unlock</li>
<li>Blocked threads become runnable</li>
<li>Runs on <strong>signals</strong> from <strong>timer</strong> or <strong>kernel</strong></li>
</ul>
<h2 id="Issues-on-Multiple-CPUs"><a href="#Issues-on-Multiple-CPUs" class="headerlink" title="Issues on Multiple CPUs"></a>Issues on Multiple CPUs</h2><ul>
<li>KLT could be run in different CPUs, and they need to impact with others.</li>
<li>Need to send signal to other threads, on other CPUs to run library code locally to do some schedulings and decisions.</li>
</ul>
<h2 id="Synchronization-Related-Issues"><a href="#Synchronization-Related-Issues" class="headerlink" title="Synchronization Related Issues"></a>Synchronization Related Issues</h2><ul>
<li>When the thread that currently holds mutex is running on one CPU, while the thread requesting mutex is running on the other CPU. <ul>
<li><strong>If critical section is short</strong>, DONT BLOCK, SPIN! Because if we do context switch and place that thread into the <strong>mutex queue</strong>. In this period, the critical section could be completed.</li>
<li><strong>If critical section is long</strong>, default blocking behavior</li>
<li>This is called <strong>Adaptive Mutexes</strong> (only for this special scenario in multi-CPUs)</li>
</ul>
</li>
</ul>
<h2 id="Destroying-Threads"><a href="#Destroying-Threads" class="headerlink" title="Destroying Threads"></a>Destroying Threads</h2><ul>
<li>Because thread creation could be expensive, nstead of destroying, <strong>reuse threads</strong></li>
<li>When a thread exits…<ul>
<li>Put on a <strong>“death row”</strong></li>
<li>Periodically destroyed by <strong>reaper thread</strong></li>
<li>Otherwise thread structures/stacks are <strong>reused</strong> =&gt; Performance gains!</li>
</ul>
</li>
</ul>
<h1 id="Interrupts-v-s-signals"><a href="#Interrupts-v-s-signals" class="headerlink" title="Interrupts v.s. signals"></a>Interrupts v.s. signals</h1><h2 id="Interrupts"><a href="#Interrupts" class="headerlink" title="Interrupts"></a>Interrupts</h2><ul>
<li>Events <strong>generated externally by components</strong> other than the CPU. (I/O devices, timers, other CPUs)</li>
<li>Determined <strong>based on the physical platform</strong></li>
<li>Appear <strong>asynchronously</strong></li>
</ul>
<h2 id="Signals"><a href="#Signals" class="headerlink" title="Signals"></a>Signals</h2><ul>
<li>Events <strong>triggered by the CPU&amp;software</strong> running on it.</li>
<li>Determined <strong>based on the operating system</strong></li>
<li>Appear <strong>synchronously or asynchronously</strong> (in response to a specific action took place in the CPU)</li>
</ul>
<h2 id="Similarities-Between-Interrupt-and-Signal"><a href="#Similarities-Between-Interrupt-and-Signal" class="headerlink" title="Similarities Between Interrupt and Signal"></a>Similarities Between Interrupt and Signal</h2><ul>
<li>Have a <strong>unique Id</strong> depending on the hardware or OS</li>
<li>Can be <strong>masked</strong> and <strong>disabled/suspended</strong> via corresponding mask<ul>
<li><strong>per-CPU</strong> interrupt mask</li>
<li><strong>per-process</strong> signal mask</li>
</ul>
</li>
<li>If enabled, trigger corresponding <strong>handler</strong><ul>
<li>Interrupt handler set <strong>for entire system</strong> by <strong>OS</strong></li>
<li>Signal handlers set <strong>on per process basis</strong> by <strong>process</strong></li>
</ul>
</li>
</ul>
<h2 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h2><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">Interrupt/Signal</th>
<th style="text-align:center">Snowstorm warning/“Battery is low” warning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Handled in specific ways</td>
<td style="text-align:center">Interrupt and signal handlers</td>
<td style="text-align:center">safety protocols, hazard plans</td>
</tr>
<tr>
<td style="text-align:center">Can be ignored</td>
<td style="text-align:center">Interrupt/signal mask</td>
<td style="text-align:center">continue working</td>
</tr>
<tr>
<td style="text-align:center">Expected or unexpected</td>
<td style="text-align:center">Appear synchronously or asynchronously</td>
<td style="text-align:center">Happen regularly or irregularly</td>
</tr>
</tbody>
</table>
<h2 id="Interrupt-Handlings"><a href="#Interrupt-Handlings" class="headerlink" title="Interrupt Handlings"></a>Interrupt Handlings</h2><ul>
<li>Device sends notification to CPU, interrupts the thread currently run on CPU</li>
<li>Based on the interrupt, look for <strong>handler</strong> in <strong>interrupt handler table</strong> based on the <strong>interrupt #</strong></li>
<li>Interrupt number is defined by <strong>hardware</strong></li>
<li>Interrupt handlers are defined by <strong>Operating System</strong></li>
</ul>
<h2 id="Signal-Handlings"><a href="#Signal-Handlings" class="headerlink" title="Signal Handlings"></a>Signal Handlings</h2><ul>
<li>CPU/Software triggers events to OS, and OS generates a <strong>signal</strong>.</li>
<li>OS maintains a <strong>signal handler table</strong>, and will use that to look for <strong>handler</strong> based on <strong>signal number</strong>.</li>
<li>Signal number is defined by <strong>Operating System</strong></li>
<li>Signal handlers <strong>could be</strong> defined by <strong>Process</strong><ul>
<li>A process could skip handlers, because OS provides <strong>default actions/handlers</strong><ol>
<li>Terminate, Ignore</li>
<li>Terminate and Core Dump</li>
<li>Stop or continue</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="Why-Disable-Interrupts-or-Signals"><a href="#Why-Disable-Interrupts-or-Signals" class="headerlink" title="Why Disable Interrupts or Signals"></a>Why Disable Interrupts or Signals</h2><ul>
<li>There could be <strong>Dead Lock</strong> scenario: The interrupt/signal handler is requesting a mutex that is held by the process caused this intterupt/signal<ul>
<li>Solutions:<ol>
<li>Keep handler code simple (no mutex) =&gt; too restrictive</li>
<li>Control interruptions by handler code =&gt; use <strong>interrupt/signal masks</strong></li>
</ol>
</li>
</ul>
</li>
<li>Example Routine:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">    clear_field_in_mask(mask)</div><div class="line">               |</div><div class="line">               |</div><div class="line">          lock(mutex)</div><div class="line">               |</div><div class="line">               |</div><div class="line">    disabled =&gt; remain pending</div><div class="line">               |</div><div class="line">               |</div><div class="line">         unlock(mutex)</div><div class="line">               |</div><div class="line">               |</div><div class="line">    reset_field_in_mask(mask)</div><div class="line">               |</div><div class="line">               |</div><div class="line">enabled =&gt; execute handler code</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="More-on-masks"><a href="#More-on-masks" class="headerlink" title="More on masks"></a>More on masks</h2><ul>
<li><strong>Interrupt masks</strong> are per CPU<ul>
<li>If mask <strong>disabled</strong> interrupt, hardware interrupt routing mechanism will not deliver interrupt to CPU</li>
</ul>
</li>
<li><strong>Signal masks</strong> are per execution context (ULT on top of KLT)<ul>
<li>If mask <strong>disabled</strong> signal =&gt; kernel sees mask and will not interrupt corresponding thread</li>
</ul>
</li>
</ul>
<h2 id="Interrupts-on-Multicore-Systems"><a href="#Interrupts-on-Multicore-Systems" class="headerlink" title="Interrupts on Multicore Systems"></a>Interrupts on Multicore Systems</h2><ul>
<li>Interrupts can be directed to any CPU that has them enabled</li>
<li>May set interrupt on just a single core =&gt; avoids overheads on all other cores</li>
</ul>
<h2 id="Types-of-Signals"><a href="#Types-of-Signals" class="headerlink" title="Types of Signals"></a>Types of Signals</h2><ol>
<li>One-shot signals<ul>
<li>“n signals pending == 1 signal pending”” - <strong>overwrite Behavior</strong></li>
<li>Must be explicitly re-enabled. (When the handler is executed, any future same signals will use default actions unless re-enabling)</li>
</ul>
</li>
<li>Real Time Signals<ul>
<li>If n signals raised, then handler is called n times. - <strong>Queuing Behavior</strong></li>
</ul>
</li>
</ol>
<h2 id="Handling-Interrupts-as-Threads"><a href="#Handling-Interrupts-as-Threads" class="headerlink" title="Handling Interrupts as Threads"></a>Handling Interrupts as Threads</h2><ul>
<li><p>Mechanism to avoid dead lock in interupt handling.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">    lock(mutex)</div><div class="line">        |</div><div class="line">        |</div><div class="line">interrupt (or signal)</div><div class="line">        |</div><div class="line">        |  -------------&gt;  handler code</div><div class="line">        |                       |</div><div class="line">        |                       |</div><div class="line">        |                  lock(mutex)</div><div class="line">        |                       |</div><div class="line">        ------------------------------- blocked</div><div class="line">        |</div><div class="line">        |</div><div class="line">unlock(mutex) ------------------------- unblocked</div><div class="line">        |                       |</div></pre></td></tr></table></figure>
</li>
<li><p>Dynamic thread creation is <strong>expensive</strong></p>
</li>
<li>Dynamic Decision:<ul>
<li>If handler doesn’t lock =&gt; execute on interrupted thread’s stack</li>
<li>If handler can block =&gt; turn into real thread</li>
</ul>
</li>
<li>Optimization<ul>
<li>Precreate &amp; preinitialize thread structures for interrupt routines</li>
</ul>
</li>
</ul>
<h2 id="Top-v-s-Bottom-Half-Philosophy"><a href="#Top-v-s-Bottom-Half-Philosophy" class="headerlink" title="Top v.s. Bottom Half Philosophy"></a>Top v.s. Bottom Half Philosophy</h2><ul>
<li>Top Half: Fast, non-blocking, minimum amount of processing</li>
<li>Bottom Half: Arbitrary, complexity work. can be blocked</li>
</ul>
<h2 id="Threads-and-Signal-Handling"><a href="#Threads-and-Signal-Handling" class="headerlink" title="Threads and Signal Handling"></a>Threads and Signal Handling</h2><ul>
<li><p>Case 1: </p>
<ul>
<li>No problem because both user and kernel are synced<img src="/imgs/OMSCS/OS/OS_5/OS_5_Screenshot2.png" class="[screenshot]">
</li>
</ul>
</li>
<li><p>Case 2:</p>
<ul>
<li>The user library should wrap the signal hanlder so that it could put the thread with mask enabled on the kernel level thread and handles the signal<img src="/imgs/OMSCS/OS/OS_5/OS_5_Screenshot3.png" class="[screenshot]">
</li>
</ul>
</li>
<li><p>Case 3:</p>
<ul>
<li>The user library will redirect the signal to the kernel level thread, where there is a user kernel thread with signal enabled running on.<img src="/imgs/OMSCS/OS/OS_5/OS_5_Screenshot4.png" class="[screenshot]">
</li>
</ul>
</li>
<li><p>Case 4:</p>
<ul>
<li>User library will make a system call to the kernel level thread and update its mask to 0. Then it will reissue the signal for the entire process to update all kernel level signal masks.</li>
<li>When the user level mask is re-enabled, the user library should make another system call to update one of the kernel level signal mask<img src="/imgs/OMSCS/OS/OS_5/OS_5_Screenshot5.png" class="[screenshot]">
</li>
</ul>
</li>
</ul>
<h1 id="Task-struct-in-Linux"><a href="#Task-struct-in-Linux" class="headerlink" title="Task struct in Linux"></a>Task struct in Linux</h1><ul>
<li>Main execution abstraction: <strong>task</strong><ul>
<li>Kernel Level Thread</li>
</ul>
</li>
<li>Single-threaded process =&gt; 1 task</li>
<li>Multi-threaded process =&gt; many tasks</li>
<li><strong>pid</strong> is the id of task, and also procees id. When multi tasks in a process, the first task id will be the process id</li>
</ul>
<h2 id="Task-creation"><a href="#Task-creation" class="headerlink" title="Task creation"></a>Task creation</h2><img src="/imgs/OMSCS/OS/OS_5/OS_5_Screenshot6.png" class="[screenshot]">

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/20/omscs-os-4-pthread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/20/omscs-os-4-pthread/" itemprop="url">
                  Operating System - PThread Intro
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-20T15:36:41-08:00">
                2017-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="PThread-Mutexes"><a href="#PThread-Mutexes" class="headerlink" title="PThread Mutexes"></a>PThread Mutexes</h1><table>
<thead>
<tr>
<th style="text-align:center"><a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-birrell-paper.pdf" target="_blank" rel="external">Birrell’s Mechanisms</a></th>
<th style="text-align:center">PThread</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Mutex</td>
<td style="text-align:center">pthread_mutex_t mutex;</td>
</tr>
<tr>
<td style="text-align:center">Lock(mutex)</td>
<td style="text-align:center">int pthread_mutex_lock(pthread_mutex_t * mutex)</td>
</tr>
<tr>
<td style="text-align:center">Unlock(mutex)</td>
<td style="text-align:center">int pthread_mutex_unlock(pthread_mutex_t * mutex)</td>
</tr>
</tbody>
</table>
<h2 id="Other-operations"><a href="#Other-operations" class="headerlink" title="Other operations"></a>Other operations</h2><ul>
<li>pthread_mutex_init</li>
<li>pthread_mutex_trylock</li>
<li>pthread_mutex_destroys</li>
</ul>
<h2 id="Safety-Tips"><a href="#Safety-Tips" class="headerlink" title="Safety Tips:"></a>Safety Tips:</h2><ol>
<li>Shared data should <strong>always</strong> be accessed through a <strong>single</strong> mutex</li>
<li>Mutex scope must be visible to all. (Globally accessible)</li>
<li>Globally order locks: for all threads, lock/unlock mutexes in order</li>
<li><strong>Always unlock</strong> a correct mutex</li>
</ol>
<h1 id="PThread-Condition-Variable"><a href="#PThread-Condition-Variable" class="headerlink" title="PThread Condition Variable"></a>PThread Condition Variable</h1><table>
<thead>
<tr>
<th style="text-align:center"><a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-birrell-paper.pdf" target="_blank" rel="external">Birrell’s Mechanisms</a></th>
<th style="text-align:center">PThread</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Condition</td>
<td style="text-align:center">pthread_cond_t mutex;</td>
</tr>
<tr>
<td style="text-align:center">Wait</td>
<td style="text-align:center">int pthread_cond_signal</td>
</tr>
<tr>
<td style="text-align:center">Signal</td>
<td style="text-align:center">int pthread_cond_broadcast</td>
</tr>
</tbody>
</table>
<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><ul>
<li>pthread_cond_init</li>
<li>pthread_cond_destroy</li>
</ul>
<h2 id="Safety-Tips-1"><a href="#Safety-Tips-1" class="headerlink" title="Safety Tips:"></a>Safety Tips:</h2><ol>
<li>Don’t forget to notify waiting threads.<ul>
<li><strong>Predicate change </strong> =&gt; signal/broadcast <strong>correct</strong> cond var</li>
</ul>
</li>
<li>Don’t need a mutex to signal/broadcast.</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/20/omscs-os-3-thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/20/omscs-os-3-thread/" itemprop="url">
                  Operating System - Thread
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-20T12:28:30-08:00">
                2017-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Visual-Metaphors"><a href="#Visual-Metaphors" class="headerlink" title="Visual Metaphors"></a>Visual Metaphors</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">Thread</th>
<th style="text-align:center">Work in toy shop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Is an <strong>active</strong> entity</td>
<td style="text-align:center">Executing unit of a process</td>
<td style="text-align:center">Executing unit of toy order</td>
</tr>
<tr>
<td style="text-align:center">Works simultaneously with others</td>
<td style="text-align:center">Many threads executing concurrently</td>
<td style="text-align:center">Many works completing toy orders</td>
</tr>
<tr>
<td style="text-align:center">Requires corrdination</td>
<td style="text-align:center">Sharing I/O, CPU, memory, etc.</td>
<td style="text-align:center">Sharing of tools, ports, work stations</td>
</tr>
</tbody>
</table>
<h1 id="Process-v-s-Thread"><a href="#Process-v-s-Thread" class="headerlink" title="Process v.s. Thread"></a>Process v.s. Thread</h1><ul>
<li><p>Single Threaded Process - only one context</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Address Space:</div><div class="line"> ------------------</div><div class="line">| Code, data, file |</div><div class="line"> ------------------</div><div class="line">|      regs        |</div><div class="line">|      stack       |</div><div class="line">|       ...        |</div><div class="line"> -------------------</div></pre></td></tr></table></figure>
</li>
<li><p>Multiple Threaded Process - multiple context </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Address Space:</div><div class="line"> ---------------------------------------</div><div class="line">|           Code, data, file            |</div><div class="line"> ---------------------------------------</div><div class="line">|    regs    |    regs    |    regs     |</div><div class="line">|    stack   |    stack   |    stack    |</div><div class="line">|    ...     |    ...     |    ...      |</div><div class="line"> ---------------------------------------</div><div class="line"></div><div class="line">PCB:</div><div class="line"> ---------------------------------------</div><div class="line">|         Shared among threads          |</div><div class="line"> ---------------------------------------</div><div class="line">|      ----       ----       ----       |</div><div class="line">|     |    |     |    |     |    |      |</div><div class="line">|      ----       ----       ----       |</div><div class="line">|                                       |</div><div class="line">|        Per thread exec context        |</div><div class="line"> ---------------------------------------</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Benefits-of-threads"><a href="#Benefits-of-threads" class="headerlink" title="Benefits of threads"></a>Benefits of threads</h1><ul>
<li>Parallelization -&gt; speed up</li>
<li>Specializing different threads to run different tasks -&gt; better management (prioritizing) -&gt; Hot cache</li>
<li>More efficient memory &amp; less memory requirement (only one shared address space)</li>
</ul>
<h2 id="Are-threads-useful-when-of-threads-gt-of-CPU"><a href="#Are-threads-useful-when-of-threads-gt-of-CPU" class="headerlink" title="Are threads useful when # of threads &gt; # of CPU?"></a>Are threads useful when # of threads &gt; # of CPU?</h2><ul>
<li>If <strong>t_idle &gt; 2 * t_context_switch</strong>, then CPU could switch to other threads to <strong>hide idling time</strong></li>
<li>Note that: because Address Space is shared, <strong>t_context_switch for threads &lt; t_context_switch for proccesses</strong></li>
<li>Hide latency</li>
</ul>
<h1 id="What-do-we-need-to-support-threads"><a href="#What-do-we-need-to-support-threads" class="headerlink" title="What do we need to support threads?"></a>What do we need to support threads?</h1><ol>
<li><strong>Thread Data Structure</strong>: identify threads, keep track of resource usage</li>
<li><strong>Mechanism</strong> to <strong>create</strong> &amp; <strong>manage</strong> threads.</li>
<li><strong>Mechanism</strong> to safely <strong>coordinate</strong> among threads running <strong>concurrently</strong> in the same address space</li>
</ol>
<h1 id="Threads-and-Concurrency"><a href="#Threads-and-Concurrency" class="headerlink" title="Threads and Concurrency"></a>Threads and Concurrency</h1><ul>
<li>Because threads are sharing a common Address Space, meaning they could access a shared memory space simultaneously, and that could lead to issues.</li>
<li><strong>Concurrency Control &amp; Coordination:</strong><ol>
<li><strong>Mutual Exclusion</strong><ul>
<li>Exclusive access to only one thread @ a time</li>
<li><strong>mutex</strong></li>
</ul>
</li>
<li><strong>Waiting</strong> on other threads<ul>
<li>Specific condition before proceeding</li>
<li>Condition variable (threads are listening to)</li>
</ul>
</li>
</ol>
</li>
</ul>
<h1 id="Thread-Creation"><a href="#Thread-Creation" class="headerlink" title="Thread Creation"></a>Thread Creation</h1><ul>
<li><strong>Thread type</strong> - Thread data structure<ul>
<li>Thread ID</li>
<li>Program Counter</li>
<li>Stack Pointer</li>
<li>Registers</li>
<li>Stack</li>
<li>Attributes</li>
</ul>
</li>
<li><p><strong>Fork(proc, args)</strong></p>
<ul>
<li>Creates a thread</li>
<li><strong>NOT</strong> Linux fork</li>
</ul>
</li>
<li><p><strong>Join(thread)</strong></p>
<ul>
<li>Wait and terminate a thread</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">        T0  |</div><div class="line">            |</div><div class="line">            |</div><div class="line">         t1 = fork(proc, args) -&gt;  T1 |                 -------------------</div><div class="line">            |                         |                | T1 Data Structure |</div><div class="line">            |                         |                |     PC = proc     |</div><div class="line">            |                         |                |    stack = args   |</div><div class="line">    child.result=join(t1)    return result OR end      |        ...        |</div><div class="line">(will block till t1 completes)                          -------------------</div></pre></td></tr></table></figure>
<h1 id="Mutual-Exclusion"><a href="#Mutual-Exclusion" class="headerlink" title="Mutual Exclusion"></a>Mutual Exclusion</h1><ul>
<li><p><strong>Mutex</strong> - like a lock</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Lock(mutex) &#123;</div><div class="line">    critical section</div><div class="line">&#125;</div><div class="line"></div><div class="line">OR</div><div class="line"></div><div class="line">lock(m)</div><div class="line">    critical section</div><div class="line">unlock(m)</div></pre></td></tr></table></figure>
</li>
<li><p>Mutext type (data structure):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> --------------------------</div><div class="line">|          locked?         |</div><div class="line">|          owner           |</div><div class="line">|      blocked_threads     |</div><div class="line"> --------------------------</div></pre></td></tr></table></figure>
</li>
<li><p>Example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">                    T1 |</div><div class="line">                       |</div><div class="line">                       |        T2 |</div><div class="line">                       |           | </div><div class="line">                    lock(m)        |          T3 |</div><div class="line">                       |           |             |</div><div class="line">                       |       lock(m) **X**     |</div><div class="line">                       |                         |</div><div class="line">                       |                      lock(m) **X**</div><div class="line">                       |</div><div class="line">T1 frees lock    --------------------------------------------</div><div class="line">                       |           |</div><div class="line">                       |           |</div><div class="line">                       |           |</div><div class="line">T2 frees lock    --------------------------------------------</div><div class="line">                       |           |             |</div><div class="line">                       |           |             |</div><div class="line">                       |           |             |</div><div class="line">T3 frees lock    --------------------------------------------</div><div class="line">                       |           |             |</div><div class="line">                       |           |             |</div><div class="line">                      ...         ...           ...</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Producer-Consumer-Example"><a href="#Producer-Consumer-Example" class="headerlink" title="Producer/Consumer Example"></a>Producer/Consumer Example</h1><ul>
<li>Many <strong>producer</strong> generating an array</li>
<li>Only one <strong>consumer</strong> printing the full array</li>
<li>Need to perform <strong>Mutual Exclusion</strong> under certain conditions</li>
<li><p>Psuedo code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Consumer:</div><div class="line">    Lock(m) &#123;</div><div class="line">        while (my_list.notfull())&#123;</div><div class="line">            // wait should frees m automatically upon invoking</div><div class="line">            // and lock m automatically upon returning </div><div class="line">            wait(m, list_full);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">Producer:</div><div class="line">    Lock(m)&#123;</div><div class="line">        my_list.insert(...);</div><div class="line">        if (my_list.full()) &#123;</div><div class="line">            signal(list_full);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><strong>list_full</strong> is the condition variable for this Example</p>
</li>
</ul>
<h1 id="Condition-Variable-API"><a href="#Condition-Variable-API" class="headerlink" title="Condition Variable API"></a>Condition Variable API</h1><ul>
<li><p><strong>Condition Type</strong> (data structure)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    Cond Variable</div><div class="line"> -------------------</div><div class="line">|     mutex ref     |</div><div class="line">|  waiting threads  |</div><div class="line">|       ...         |</div><div class="line"> -------------------</div></pre></td></tr></table></figure>
</li>
<li><p><strong>wait(mutex, cond)</strong>: mutex is automatically released &amp; re-acquired on wait</p>
</li>
<li><strong>signal(cond)</strong>: notify <strong>only one</strong> thread waiting on the cond</li>
<li><strong>boardcast(cond)</strong>: notify <strong>all</strong> waiting threads</li>
</ul>
<h1 id="Reader-Writer-Problem"><a href="#Reader-Writer-Problem" class="headerlink" title="Reader/Writer Problem"></a>Reader/Writer Problem</h1><ul>
<li>Could have 0 or many readers, but could only have 0 or 1 Writer</li>
<li>Define state of resources:<ol>
<li><strong>free</strong>: resource.counter = 0</li>
<li><strong>reading</strong>: resource.counter &gt; 0</li>
<li><strong>writing</strong>: resource.counter = -1</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">// Mutex</div><div class="line">var counter_mutex;</div><div class="line">// Condition var</div><div class="line">var read_phase, write_phase;</div><div class="line">var resource_counter = 0;</div><div class="line"></div><div class="line">Readers:</div><div class="line">    // Entering Critical Section</div><div class="line">    Lock(counter_mutex) &#123;</div><div class="line">        while(resource_counter == -1) &#123;</div><div class="line">            wait(counter_mutex, read_phase);</div><div class="line">        &#125;</div><div class="line">        resource_counter ++;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // real critical section</div><div class="line">    read data...</div><div class="line"></div><div class="line">    // Exiting Critical Section</div><div class="line">    Lock(counter_mutex) &#123;</div><div class="line">        resource_counter --;</div><div class="line">        if (readers == 0) &#123;</div><div class="line">            signal(write_phase);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">Writers:</div><div class="line">    // Entering Critical Section</div><div class="line">    Lock(counter_mutex) &#123;</div><div class="line">        while(resource_counter != 0) &#123;</div><div class="line">            wait(counter_mutex, write_phase);</div><div class="line">        &#125;</div><div class="line">        resource_counter = -1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // real critical section</div><div class="line">    write data...</div><div class="line"></div><div class="line">    // Exiting Critical Section</div><div class="line">    Lock(counter_mutex) &#123;</div><div class="line">        resource_counter = 0;</div><div class="line">        boardcast(read_phase);</div><div class="line">        signal(write_phase);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h1 id="Typical-Critical-Section-Structure"><a href="#Typical-Critical-Section-Structure" class="headerlink" title="Typical Critical Section Structure"></a>Typical Critical Section Structure</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Lock(mutex) &#123;</div><div class="line">    while (!predicate_indicating_access_ok) &#123;</div><div class="line">        wait(mutex, cond_var);</div><div class="line">    &#125;</div><div class="line">    update state -&gt; update predicate</div><div class="line">    signal/boardcast(cond_var_with_correct_waiting_threads);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Critical-Section-Structure-with-Proxy-Variable"><a href="#Critical-Section-Structure-with-Proxy-Variable" class="headerlink" title="Critical Section Structure with Proxy Variable"></a>Critical Section Structure with Proxy Variable</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// Enter Critical Section</div><div class="line">Lock(mutex) &#123;</div><div class="line">    while (!predicate_for_access) &#123;</div><div class="line">        wait(mutex, cond_var);</div><div class="line">    &#125;</div><div class="line">    update predicate</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Critical Section</div><div class="line">...</div><div class="line"></div><div class="line">// Exit Critical Section</div><div class="line">Lock(mutex) &#123;</div><div class="line">    update predicate;</div><div class="line">    boardcast/signal if it meets certain conditions</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Avoid-Common-Mistakes"><a href="#Avoid-Common-Mistakes" class="headerlink" title="Avoid Common Mistakes"></a>Avoid Common Mistakes</h1><ul>
<li>Keep track of <strong>mutex/cond var</strong> used with a resource</li>
<li>Check that you are always correctly using <strong>lock&amp;unlock</strong></li>
<li>Use a <strong>single mutex</strong> to access a <strong>single resource</strong></li>
<li>Check that you are signaling correct conditions</li>
<li>Check that you are <strong>NOT</strong> using signal when boardcast is needed</li>
</ul>
<h2 id="Pitfall-Spurious-wake-ups"><a href="#Pitfall-Spurious-wake-ups" class="headerlink" title="Pitfall - Spurious wake-ups"></a>Pitfall - Spurious wake-ups</h2><ul>
<li>Woke up but still waiting for mutex</li>
<li>When we wake threads up knowing that thay may not be able to proceed.</li>
<li>Solution: usually we could put the wakeup statement(boardcast/signal) outside the unlock section, but need to be very careful when doing this</li>
</ul>
<h2 id="Pitfall-Dead-Lock"><a href="#Pitfall-Dead-Lock" class="headerlink" title="Pitfall - Dead Lock"></a>Pitfall - Dead Lock</h2><ul>
<li>Two or more competing threads are waiting on each other to complete, but none of them ever do.</li>
<li>How to avoid?<ol>
<li><strong>Fine-grained locking</strong>: Lock and unlock in certain order</li>
<li>Get all lock up front and then release them @ the end</li>
<li>Use <strong>mega lock</strong></li>
<li><strong>Maintain lock order</strong><br>NOTE: 2&amp;3 will limit parallelism</li>
</ol>
</li>
</ul>
<h1 id="Kernel-Level-Thread-v-s-User-Level-Thread"><a href="#Kernel-Level-Thread-v-s-User-Level-Thread" class="headerlink" title="Kernel Level Thread v.s. User Level Thread"></a>Kernel Level Thread v.s. User Level Thread</h1><h2 id="Kernel-Level-Thread"><a href="#Kernel-Level-Thread" class="headerlink" title="Kernel Level Thread:"></a>Kernel Level Thread:</h2><p>OS is multi-threads</p>
<h2 id="User-Level-Thread"><a href="#User-Level-Thread" class="headerlink" title="User Level Thread:"></a>User Level Thread:</h2><p>Must be linked to a kernel thread</p>
<h2 id="Relationship"><a href="#Relationship" class="headerlink" title="Relationship:"></a>Relationship:</h2><ol>
<li><p>One-to-one Model</p>
<ul>
<li>Each <strong>user level thread</strong> is associated with a <strong>kernel-level thread</strong></li>
<li>Pros:<ol>
<li>OS sees/understands threads, synchronizations, blockings, etc…</li>
</ol>
</li>
<li>Cons:<ol>
<li>Must go to OS for all operations</li>
<li>OS might have limits in terms of <strong>policies</strong>, <strong>thread #</strong>, etc…</li>
<li>Portability is bad</li>
</ol>
</li>
</ul>
</li>
<li><p>Many-to-one Model</p>
<ul>
<li>Pros:<ol>
<li>Totally portable.</li>
<li>Doesn’t depend on OS limits.</li>
</ol>
</li>
<li>Cons:<ol>
<li>OS has no insights into applications.</li>
<li>OS may block entire process if one user-level thread blocks I/O.</li>
</ol>
</li>
</ul>
</li>
<li><p>Many-to-many Model</p>
<ul>
<li>Pros:<ol>
<li>Can be best for both worlds.</li>
<li>Can have bound or unbound threads</li>
</ol>
</li>
<li>Cons:<ol>
<li>Requires coordination in between</li>
</ol>
</li>
</ul>
</li>
</ol>
<h1 id="Multi-Threading-Patterns"><a href="#Multi-Threading-Patterns" class="headerlink" title="Multi-Threading Patterns"></a>Multi-Threading Patterns</h1><h2 id="Boss-Worker-Pattern"><a href="#Boss-Worker-Pattern" class="headerlink" title="Boss/Worker Pattern"></a>Boss/Worker Pattern</h2><ul>
<li><strong>Boss</strong>: assigns work to workers</li>
<li><strong>Worker</strong>: perform entire work</li>
<li>Throughput is limited by boss thread: <strong>1/boss_time_per_order</strong></li>
<li>Boss can assign work by:<ol>
<li><strong>directly signaling specific worker</strong><ul>
<li>Pros: workers dont need to synchronize</li>
<li>Cons: Boss must keep track of what each worker is doing (Throughput is <strong>down</strong>)</li>
</ul>
</li>
<li><strong>Placing work in Producer/Consumer Queue</strong><ul>
<li>Pros: Boss doesn’t need to know details about workers</li>
<li>Cons: Queue Synchronization</li>
</ul>
</li>
</ol>
</li>
<li><strong>Pros&amp;Cons:</strong><br>  +: Simplicity<br>  -: Thread pool management, locality</li>
<li><p>How many workers?</p>
<ol>
<li>On demand -&gt; waste time in waiting/hiring workers</li>
<li>Pool of workers (good)</li>
<li>Static v.s. Dynamic (good)</li>
</ol>
</li>
<li><p>Variant:</p>
<ul>
<li>Instead of equal workers, use <strong>workers specialized for certain tasks</strong></li>
<li>This requires the boss to do a bit more for each order</li>
<li>Pros:<ol>
<li>Better locality</li>
<li>Quality of Service (QoS) management</li>
</ol>
</li>
<li>Cons: Load balancing</li>
</ul>
</li>
</ul>
<h2 id="Pipeline-Pattern"><a href="#Pipeline-Pattern" class="headerlink" title="Pipeline Pattern"></a>Pipeline Pattern</h2><ul>
<li>Threads assigned one subtask in the system.</li>
<li>Entire tasks = piplines of threads</li>
<li>Multiple tasks concurrently in the system, but in <strong>different pipeline stage</strong><ul>
<li><strong>Throughput:</strong> Weakest link</li>
<li><strong>Pipeline stage == Thread Pool</strong></li>
</ul>
</li>
<li>Shared-buffer based communication between stages<ul>
<li>Pros: Specialization &amp; locality</li>
<li>Cons: Balancing &amp; Synchronization overheads</li>
</ul>
</li>
</ul>
<h2 id="Layered-Pattern"><a href="#Layered-Pattern" class="headerlink" title="Layered Pattern"></a>Layered Pattern</h2><ul>
<li>Each layer group of related subtasks</li>
<li>End-to-end task must pass up &amp; down through all layers</li>
<li>Pros:<ol>
<li>Specialization &amp; locality</li>
<li>Less fine-grained than pipeline</li>
</ol>
</li>
<li>Cons:<ol>
<li>Not suitable for all applications</li>
<li>Synchronization</li>
</ol>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/20/omscs-os-2-process/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/20/omscs-os-2-process/" itemprop="url">
                  Operating System - Process
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-20T01:18:57-08:00">
                2017-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Simple-Process-Definition"><a href="#Simple-Process-Definition" class="headerlink" title="Simple Process Definition"></a>Simple Process Definition</h1><ul>
<li>A pocess is an instance of an executing program.</li>
<li>“task” or “job”</li>
</ul>
<h1 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">Process</th>
<th style="text-align:center">An order of toys</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">State of execution</td>
<td style="text-align:center">Program Counter, stack</td>
<td style="text-align:center">Completed toy, waiting to be built</td>
</tr>
<tr>
<td style="text-align:center">Parts &amp; temporary holding data</td>
<td style="text-align:center">data, register state, states in memory</td>
<td style="text-align:center">plastic pieces, containers</td>
</tr>
<tr>
<td style="text-align:center">May require special hardwares</td>
<td style="text-align:center">I/O devices, Network, etc.</td>
<td style="text-align:center">Sewing machines, glue guns, etc.</td>
</tr>
</tbody>
</table>
<h1 id="What-is-a-Process"><a href="#What-is-a-Process" class="headerlink" title="What is a Process"></a>What is a Process</h1><ul>
<li>Process = state of a program when executing and loaded in memory (<strong>active</strong> state)<ul>
<li>OS manages hardware on behalf of <strong>applications</strong></li>
<li>Applications = Programs on disk, flash memory, cloud, etc.. (<strong>static</strong> state)</li>
</ul>
</li>
</ul>
<h1 id="What-does-a-process-look-like"><a href="#What-does-a-process-look-like" class="headerlink" title="What does a process look like"></a>What does a process look like</h1><ol>
<li>Address Space (V0 - Vmax): “in memory” representation of a process<ul>
<li>Using <strong>Virtual Address</strong> and map it to <strong>Physical Address</strong> by <strong>Page Table</strong></li>
<li>Type of state:<ol>
<li><strong>Text &amp; data</strong> - static state when processes first loads</li>
<li><strong>Heap</strong> - Dynamically created during execution</li>
<li><strong>Stack</strong> - Grows &amp; shrinks ~ LIFO Queue</li>
</ol>
</li>
</ul>
</li>
<li>Portions of the Address Space could be stored in disk. When needed, they will be swapped into memory</li>
</ol>
<h1 id="How-does-OS-know-what-a-process-is-doing"><a href="#How-does-OS-know-what-a-process-is-doing" class="headerlink" title="How does OS know what a process is doing"></a>How does OS know what a process is doing</h1><p>Typically an OS maintains several elements to recognize this:</p>
<ol>
<li>Program Counter -&gt; maintained in CPU</li>
<li>CPU registers</li>
<li>Stack Pointer</li>
<li>OS maintains a <strong>Process Control Block (PCB)</strong> </li>
</ol>
<h1 id="PCB"><a href="#PCB" class="headerlink" title="PCB"></a>PCB</h1><ul>
<li>A data structure that the OS maintains for every process it manages</li>
<li>Created &amp; initialized when process is created</li>
<li>Certain fields are updated when proess state changes (i.e. memory limits)</li>
<li>Other fields change too frequently (e.g. <strong>PC</strong>). In this case, CPU will maintain them, and OS only collect&amp;store them in PCB</li>
</ul>
<h1 id="How-is-PCB-used"><a href="#How-is-PCB-used" class="headerlink" title="How is PCB used"></a>How is PCB used</h1><p>When context switch happens, for example, from P1 to P2, OS will save <strong>PCB_P1</strong> and restore <strong>PCB_P2</strong> by assigning <strong>PCB_P2</strong> to the related CPU register</p>
<h1 id="Context-Switch-Mechanism"><a href="#Context-Switch-Mechanism" class="headerlink" title="Context Switch - Mechanism"></a>Context Switch - Mechanism</h1><ul>
<li>Switching the CPU from the content of one process to the content of the other</li>
<li><strong>EXPENSIVE:</strong><ol>
<li>Direct costs: number of cycles to load/store data</li>
<li>Indirect costs: Cold Cache - Cache miss</li>
</ol>
</li>
</ul>
<h1 id="Process-Life-cycles"><a href="#Process-Life-cycles" class="headerlink" title="Process Life cycles"></a>Process Life cycles</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    admitted        interupt           exit</div><div class="line">new --------&gt; ready &lt;-------- running -----&gt; terminated</div><div class="line">              ^  |                    ^ |</div><div class="line">          I/O |  | scheduler dispatch | | I/O</div><div class="line">        event |   --------------------- | event wait</div><div class="line">   completion |                         |</div><div class="line">               --------- waiting &lt;-------</div></pre></td></tr></table></figure>
<h1 id="Process-Creation"><a href="#Process-Creation" class="headerlink" title="Process Creation"></a>Process Creation</h1><ul>
<li>Tree structure: A root process is created first</li>
<li>Mechanisms:<ol>
<li><strong>fork:</strong> <ul>
<li>Copy the parent PCB into child PCB</li>
<li>Child continues execution @ instruction after <strong>fork</strong></li>
</ul>
</li>
<li><strong>exec:</strong><ul>
<li>Replace child image</li>
<li>Load new program &amp; start from the first instruction</li>
</ul>
</li>
</ol>
</li>
</ul>
<h1 id="Role-of-the-CPU-scheduler"><a href="#Role-of-the-CPU-scheduler" class="headerlink" title="Role of the CPU scheduler"></a>Role of the CPU scheduler</h1><ul>
<li>Determines <strong>which</strong> ready process will be run</li>
<li>Determines <strong>how long</strong> it should run</li>
<li>In order to manage CPU, OS must: (Need to be efficient!!)<ol>
<li><strong>preempt</strong>: interrupt &amp; save current context</li>
<li><strong>schedule</strong>: run scheduler to choose the next process</li>
<li><strong>dispatch</strong>: dispatch process &amp; switch to its context</li>
</ol>
</li>
</ul>
<h1 id="Length-of-Process"><a href="#Length-of-Process" class="headerlink" title="Length of Process"></a>Length of Process</h1><ul>
<li>Define some <strong>timeslice</strong>:<ul>
<li>Tp - Allocated to a proccess on CPU</li>
<li>Tsche - Scheduling time</li>
</ul>
</li>
<li>Useful CPU work = total processing time / total time = Tp / (Tp + Tsche)</li>
<li>If Tp == Tsche: only 50% of CPU time spent on useful work</li>
<li>If Tp == 10 * Tsche: 91% of CPU time spent on useful work</li>
</ul>
<h1 id="Scheduling-I-O-amp-how-could-a-process-go-back-to-ready-queue"><a href="#Scheduling-I-O-amp-how-could-a-process-go-back-to-ready-queue" class="headerlink" title="Scheduling I/O &amp; how could a process go back to ready queue"></a>Scheduling I/O &amp; how could a process go back to ready queue</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-----&gt; ready queue ----------------------------------------&gt; CPU -----&gt;</div><div class="line">        ^                                                     |</div><div class="line">        |                                                     |</div><div class="line">         ----- I/O &lt;---- I/O queue &lt;---- I/O request &lt;---------</div><div class="line">        |                                                     |</div><div class="line">         ------------------------ time slice expired &lt;---------</div><div class="line">        |                                                     |</div><div class="line">         -------- child executes ------ fork a child &lt;---------</div><div class="line">        |                                                     |</div><div class="line">         --- interupt occurs --- wait for an interupt &lt;--------</div></pre></td></tr></table></figure>
<h1 id="Inter-Process-Communication-IPC"><a href="#Inter-Process-Communication-IPC" class="headerlink" title="Inter Process Communication (IPC)"></a>Inter Process Communication (IPC)</h1><ul>
<li>IPC Mechanisms:</li>
</ul>
<ol>
<li>Transfer data/info between address spaces</li>
<li>Maintain protection &amp; isolation</li>
<li>Provide flexibility &amp; performance</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Zhexuan Liu" />
          <p class="site-author-name" itemprop="name">Zhexuan Liu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhexuan Liu</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
