<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Eric' Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Eric' Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eric' Notes">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Eric' Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Eric' Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/07/omscs-os-13-remote-procedure-calls/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/07/omscs-os-13-remote-procedure-calls/" itemprop="url">
                  Operating System - Remote Procedure Calls
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-07T19:16:57-07:00">
                2017-04-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li>Remote Procedure Calls</li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-birrell-nelson-paper.pdf" target="_blank" rel="external">Implementing Remote Procedure Calls</a></p>
<h1 id="Why-RPC"><a href="#Why-RPC" class="headerlink" title="Why RPC"></a>Why RPC</h1><ul>
<li>Common steps related to remote Inter Process Communication -&gt; <strong>Remote Procedure Calls</strong></li>
<li>Simplify the development of cross-address space &amp; cross-machine interactions</li>
<li>Benefits<ul>
<li>Higher-level interface for data movement and communication</li>
<li>Error handling</li>
<li>Hiding complexities of cross-machine interactions</li>
</ul>
</li>
</ul>
<h1 id="RPC-Requirements"><a href="#RPC-Requirements" class="headerlink" title="RPC Requirements"></a>RPC Requirements</h1><ol>
<li>Client/Server Interactions</li>
<li>Procedure Call Interface =&gt; sync call semantics</li>
<li>Type Checking<ul>
<li>Error handling</li>
<li>Packet bytes interpretation</li>
</ul>
</li>
<li>Cross-machine conversion. Should hide the differences from programmers<ul>
<li>e.g. big/little endian; negative numbers</li>
<li>One way to solve is to agree with a format, such as nnetwork format</li>
</ul>
</li>
<li>Higher-level Protocol<ul>
<li>Access control, fault tolerance…</li>
<li>Different transport protocols</li>
</ul>
</li>
</ol>
<h1 id="RPC-Structure"><a href="#RPC-Structure" class="headerlink" title="RPC Structure"></a>RPC Structure</h1><img src="/imgs/OMSCS/OS/OS_13/OS_13_Screenshot1.png" class="[screenshot]">
<h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><ol>
<li><strong>register</strong>: server <strong>registers</strong> procedure, args types, locations, etc…</li>
<li><strong>bind</strong>: client finds and <strong>bind</strong> to desired server<br><strong>Client</strong></li>
<li><strong>call</strong>: client makes <strong>RPC call</strong>; control passed to stub, client code <strong>blocks</strong></li>
<li><strong>marshal</strong>: client stub <strong>marshals</strong> arguments (serialize args into buffer)</li>
<li><strong>send</strong>: client <strong>sends</strong> message to server<br><strong>Server</strong></li>
<li><strong>receive</strong>: server <strong>receives</strong> message; pass msg to server-stub; access control</li>
<li><strong>unmarshal</strong>: server stub <strong>unmarshals</strong> args (extracts args &amp; creates data structures)</li>
<li><strong>actual call</strong>: server stub <strong>calls</strong> local procedure implementation</li>
<li><strong>result</strong>: server performs operation and computes <strong>result</strong> of RPC operation</li>
</ol>
<h2 id="Interface-Definition-Language"><a href="#Interface-Definition-Language" class="headerlink" title="Interface Definition Language"></a>Interface Definition Language</h2><h3 id="Reasoning"><a href="#Reasoning" class="headerlink" title="Reasoning"></a>Reasoning</h3><ul>
<li>Server and Client can be developed separately</li>
<li>But do need <strong>an agreement</strong> to support<ul>
<li>client side <strong>bind</strong> decision. (i.e. which server to bind to, and what operations to perform)</li>
<li>runtime to <strong>automate stub generation</strong></li>
</ul>
</li>
<li>IDL is basically a protocol of how these agreements are expressed</li>
</ul>
<h3 id="Interface-Specification"><a href="#Interface-Specification" class="headerlink" title="Interface Specification"></a>Interface Specification</h3><ul>
<li>Used to describe the interface the server exports:<ul>
<li>Procedure name, arg &amp; result types -&gt; pretty much like a function definition</li>
<li>version #: helps client identify which server has latest implementation, and is useful when performing upgrades</li>
</ul>
</li>
<li>RPC can use <strong>IDL</strong> that is<ul>
<li>language-agnostic: <strong>XDR in SunRPC</strong></li>
<li>language-specific: <strong>Java in Java RMI</strong></li>
</ul>
</li>
<li>Only for specification, not for implementation</li>
</ul>
<h2 id="Binding"><a href="#Binding" class="headerlink" title="Binding"></a>Binding</h2><ul>
<li><strong>Client</strong> determines<ul>
<li>which <strong>server</strong> to bind to: service name, version number, etc.</li>
<li>how to connect to that <strong>server</strong>: IP Address, network protocol</li>
</ul>
</li>
<li>It will use a <strong>Registry</strong>, which is pretty much a <strong>database of available services</strong><ul>
<li>Search for <strong>service name</strong> to find <strong>service (which)</strong> and <strong>contact details (now)</strong></li>
<li>Could be <strong>distributed</strong>: any RPC service can register</li>
<li>OR could be <strong>machine-specific</strong>: only for services running on same machine, and requires client to know machine address</li>
</ul>
</li>
<li>Needs <strong>naming protocol</strong></li>
</ul>
<h2 id="Marshalling-add-program-as-an-example"><a href="#Marshalling-add-program-as-an-example" class="headerlink" title="Marshalling - add program as an example"></a>Marshalling - add program as an example</h2><img src="/imgs/OMSCS/OS/OS_13/OS_13_Screenshot2.png" class="[screenshot]">
<ul>
<li>Provided by <strong>RPC System Compiler</strong></li>
<li>Encode data and argument in a readable and understandable way</li>
</ul>
<h2 id="Un-marshalling"><a href="#Un-marshalling" class="headerlink" title="Un-marshalling"></a>Un-marshalling</h2><img src="/imgs/OMSCS/OS/OS_13/OS_13_Screenshot3.png" class="[screenshot]">
<ul>
<li>Provided by <strong>RPC System Compiler</strong></li>
<li>Interpret the address space and decode data</li>
</ul>
<h1 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">Applications using binding &amp; registries</th>
<th style="text-align:center">Toy shops use directories of outsourcing services</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Who can provide a service?</td>
<td style="text-align:center">look up registry for image processing</td>
<td style="text-align:center">shops to outsource assembly</td>
</tr>
<tr>
<td style="text-align:center">What services do they provide</td>
<td style="text-align:center">compress, filter, version # -&gt; IDL</td>
<td style="text-align:center">that will create train carts</td>
</tr>
<tr>
<td style="text-align:center">How will they ship/package?</td>
<td style="text-align:center">TCP/UDP -&gt; registry</td>
<td style="text-align:center">that will ship via UPS</td>
</tr>
</tbody>
</table>
<h1 id="What-about-pointers"><a href="#What-about-pointers" class="headerlink" title="What about pointers?"></a>What about pointers?</h1><p>Pointers are pointing to loction in caller address space</p>
<h2 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions"></a>Solutions</h2><ol>
<li>No pointers!</li>
<li>Serialize pointers; copy referenced (“pointed to”) data structure to send buffer</li>
</ol>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><ul>
<li><strong>Binding</strong>: How to find the server. (Distributed or machine specific)</li>
<li><strong>IDL</strong>: How to talk to the server; how to package data. (Language agnostic or language specific)</li>
<li><strong>Pointers as arguments</strong>: disallow or serialize pointed data</li>
<li><strong>Partial failures</strong>: Special error notifications</li>
</ul>
<h1 id="Sun-RPC"><a href="#Sun-RPC" class="headerlink" title="Sun RPC"></a>Sun RPC</h1><h2 id="Design-Choices"><a href="#Design-Choices" class="headerlink" title="Design Choices"></a>Design Choices</h2><ul>
<li><strong>Binding</strong>: Assumes server machine is know upfront -&gt; per-machine registry daemon</li>
<li><strong>IDL</strong>: Language agnostic: XDR (for interface specification and for encoding)</li>
<li><strong>Pointers</strong>: allowed and serialized</li>
<li><strong>Failure</strong>: retries; return as much information as possible</li>
</ul>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p><a href="https://docs.oracle.com/cd/E19683-01/816-1435/index.html" target="_blank" rel="external">SunRPC Overview</a></p>
<ul>
<li><strong>client-server</strong> via <strong>procedure calls</strong></li>
<li>Interface specified via <strong>XDR (.x file)</strong></li>
<li><strong>rpcgen compiler</strong>: converts <strong>.x</strong> to <strong>language-specific stubs</strong></li>
<li>Server registers with local registry daemon</li>
<li>Registry (per-machine): name of service, version, protocol(s), port number…</li>
<li>Binding creates handle<ul>
<li>client uses handle in calls</li>
<li>RPC runtime uses handle to track per-client RPC state</li>
</ul>
</li>
<li>Coule be on the same or different machines</li>
</ul>
<h2 id="XDR-Example"><a href="#XDR-Example" class="headerlink" title="XDR Example"></a>XDR Example</h2><ul>
<li>XDR (.x file) describes:<ul>
<li>datatypes</li>
<li>procedures (name, version)</li>
<li>service ID</li>
</ul>
</li>
<li>Client uses: <strong>service name</strong>, <strong>proc name</strong> and <strong>version number</strong></li>
<li>RPC runtime refers to <strong>service id</strong> and <strong>proc id</strong> and <strong>version number</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> square_in &#123;</div><div class="line">    <span class="keyword">int</span> arg1;</div><div class="line">&#125;</div><div class="line"><span class="keyword">struct</span> square_out &#123;</div><div class="line">    <span class="keyword">int</span> res1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">program SQUARE_PROG &#123; <span class="comment">/* RPC service name */</span></div><div class="line">    version SQUARE_VERS &#123;</div><div class="line">        <span class="function">square_out <span class="title">SQUARE_PROC</span><span class="params">(square_in)</span> </span>= <span class="number">1</span>; <span class="comment">/* proc1 */</span></div><div class="line">    &#125; = <span class="number">1</span>; <span class="comment">/* version1 */</span></div><div class="line">&#125; = <span class="number">0x31230000</span>; <span class="comment">/* service id */</span></div></pre></td></tr></table></figure>
<h2 id="Compiling-XDR"><a href="#Compiling-XDR" class="headerlink" title="Compiling XDR"></a>Compiling XDR</h2><ul>
<li>rpcgen compiler: <strong>rpcgen -c square.x</strong> for C</li>
<li>Generates:<ol>
<li>square.h: <strong>data types</strong> and <strong>function definitions</strong></li>
<li>square_svc.c: <strong>server stub</strong> and skeleton (main) - no implementations<ul>
<li><strong>main</strong>: registration/housekeeping</li>
<li><strong>square_prog_1</strong>: internal code, request parsing, arg marshalling</li>
<li><strong>square_proc_1_svc</strong>: prototype of actual procedure; must be implemented by developers</li>
</ul>
</li>
<li>square_clnt.c: <strong>client stub</strong><ul>
<li><strong>squareproc_1</strong>: wrapper of RPC call to <strong>square_proc_1_svc</strong> </li>
<li>Developers can then do <strong>y = squareproc_1(&amp;x, …)</strong></li>
</ul>
</li>
<li>square_xdr.c: common marshalling routines</li>
</ol>
</li>
</ul>
<h2 id="XDR-Compilation-Summary"><a href="#XDR-Compilation-Summary" class="headerlink" title="XDR Compilation Summary"></a>XDR Compilation Summary</h2><img src="/imgs/OMSCS/OS/OS_13/OS_13_Screenshot4.png" class="[screenshot]">
<ul>
<li>rpcgen <strong>-c</strong> square.x: not thread safe</li>
<li>rpcgen <strong>-c -M</strong> square.x: multithreading safe!</li>
</ul>
<h2 id="RPC-Binding"><a href="#RPC-Binding" class="headerlink" title="RPC Binding"></a>RPC Binding</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// client</span></div><div class="line"><span class="function">CLIENT* <span class="title">clnt_create</span><span class="params">(<span class="keyword">char</span>* host, <span class="keyword">unsigned</span> <span class="keyword">long</span> prog, <span class="keyword">unsigned</span> <span class="keyword">long</span> vers, <span class="keyword">char</span>* proto)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// for square example</span></div><div class="line">CLIENT * clnt_handle;</div><div class="line">clnt_handle = clnt_create(rpc_host_name, SQUARE_PROG, SQUARE_VERS, <span class="string">"tcp"</span>);</div></pre></td></tr></table></figure>
<h2 id="XDR-Data-Types"><a href="#XDR-Data-Types" class="headerlink" title="XDR Data Types"></a>XDR Data Types</h2><ul>
<li>Default types: char, byte, int, float, etc.</li>
<li>Additional XDR types<ul>
<li>const (#define)</li>
<li>hyper (64-bit integer)</li>
<li>quadruple (128-bit float)</li>
<li>opaque (~C byte): uninterpreted binary data</li>
</ul>
</li>
<li>Fixed-length array: e.g. int data[80]</li>
<li>Variable-length array: e.g. int data<80> <ul>
<li>translates to data structure with “len” and “val” fields. “len” is the actual length of the array and “val” points to the base memory</li>
<li>Except for string</li>
</ul>
</80></li>
</ul>
<h2 id="XDR-Routines"><a href="#XDR-Routines" class="headerlink" title="XDR Routines"></a>XDR Routines</h2><ul>
<li>marshalling/unmarshalling: found in <strong>square_xdr.c</strong></li>
<li>Cleanup<ul>
<li>xdr_free()</li>
<li>User defined <strong>_freeresult procedure</strong>, e.g. square_prog_q_freeresult</li>
<li>Called after result is returneds</li>
</ul>
</li>
</ul>
<h2 id="Encoding"><a href="#Encoding" class="headerlink" title="Encoding"></a>Encoding</h2><ul>
<li>Need to encode arguments or results into a bytestream depending on data type</li>
<li>Need agreement on this</li>
</ul>
<h3 id="XDR-Encoding"><a href="#XDR-Encoding" class="headerlink" title="XDR Encoding"></a>XDR Encoding</h3><ul>
<li>XDR == IDL + encoding</li>
<li>XDR Encoding Rules<ul>
<li>all data types are encoded in multiples of 4 bytes</li>
<li>big endian is the transmission standard`</li>
<li>two’s complement is used for integers</li>
<li>IEEE format is used for floating nmber</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/06/omscs-os-12-system-virtualization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/06/omscs-os-12-system-virtualization/" itemprop="url">
                  Operating System - System Virtualization
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-06T20:38:09-07:00">
                2017-04-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li>Overview of <strong>virtualization</strong></li>
<li>Main technical approaches in popular <strong>virtualization solutions</strong></li>
<li><strong>Virtualization-related hardware</strong> advances</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-rosenblum-garfinkel-paper.pdf" target="_blank" rel="external">Virtual Machine Monitors: Current Technologies and Future Trends</a></p>
<h1 id="What-is-virtualization"><a href="#What-is-virtualization" class="headerlink" title="What is virtualization"></a>What is virtualization</h1><p><strong>Virtualization</strong> allows concurrent execution of multiple OSs (and their applications) on the same physical machine</p>
<ul>
<li><strong>Virtual resources</strong> == each OS thinks that it “owns” hardware resources</li>
<li><strong>Virtual Machine (VM)</strong> ==  OS + applications + virtual resources <strong>(guest domain)</strong></li>
<li><strong>Virtualization layer</strong> == management of physical hardware <strong>(Vitual machine monitor, hypervisor)</strong></li>
</ul>
<img src="/imgs/OMSCS/OS/OS_12/OS_12_Screenshot1.png" class="[screenshot]">
<h2 id="Defining-Virtualization"><a href="#Defining-Virtualization" class="headerlink" title="Defining Virtualization"></a>Defining Virtualization</h2><p>A <strong>Virtual machine</strong> is an efficient, isolated duplicate of the real machine</p>
<ul>
<li>Supported by a <strong>Virtual Machine Monitor (VMM)</strong><ol>
<li>Provides environment <strong>essentially identical with the original machine</strong> - <strong>fidelity</strong></li>
<li>Programs show <strong>at worst only minor decrease in speed</strong> - <strong>performance</strong></li>
<li>VMM is in <strong>complete control of system resources</strong> － <strong>safety &amp; isolation</strong></li>
</ol>
</li>
</ul>
<h2 id="Benefits"><a href="#Benefits" class="headerlink" title="Benefits"></a>Benefits</h2><h3 id="Consolidation"><a href="#Consolidation" class="headerlink" title="Consolidation"></a>Consolidation</h3><pre><code>* Run multiple OS on a single machine
* Decrease cost, improve manageability
</code></pre><h3 id="Migration"><a href="#Migration" class="headerlink" title="Migration"></a>Migration</h3><pre><code>* Availability, reliability
</code></pre><h3 id="Security-debugging-support-for-legacy-OSs"><a href="#Security-debugging-support-for-legacy-OSs" class="headerlink" title="Security, debugging, support for legacy OSs"></a>Security, debugging, support for legacy OSs</h3><h1 id="Virtualization-Models"><a href="#Virtualization-Models" class="headerlink" title="Virtualization Models"></a>Virtualization Models</h1><h2 id="Bare-metal-or-Hypervisor-based-type1"><a href="#Bare-metal-or-Hypervisor-based-type1" class="headerlink" title="Bare-metal or Hypervisor-based (type1)"></a>Bare-metal or Hypervisor-based (type1)</h2><ul>
<li><strong>VMM*hypervisor)</strong> manages all hardware resources and supports execution of VMs</li>
<li><strong>Privileged, service VM</strong> to deal with devices (and other configuration and management task), and runs all drivers</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_12/OS_12_Screenshot2.png" class="[screenshot]">
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><h4 id="Xen"><a href="#Xen" class="headerlink" title="Xen"></a>Xen</h4><ul>
<li>Opern source or Citrix XenServer</li>
<li><strong>domain0</strong> - Privileged VM and <strong>domUs</strong>- Guest VM</li>
<li>Drivers in <strong>domain0</strong></li>
</ul>
<h4 id="ESX-VMware"><a href="#ESX-VMware" class="headerlink" title="ESX (VMware)"></a>ESX (VMware)</h4><ul>
<li>Many open APIs</li>
<li>Drivers in VMM</li>
<li>Used to have Linux control core, now remote APIs</li>
</ul>
<h2 id="Hosted-type2"><a href="#Hosted-type2" class="headerlink" title="Hosted (type2)"></a>Hosted (type2)</h2><ul>
<li><strong>Host OS</strong> owns all hardware</li>
<li>Special <strong>VMM Module</strong> provides <strong>hardware interfaces</strong> to VMs and deals with VM context switching</li>
<li>Can leverage all existing features in Host OS</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_12/OS_12_Screenshot3.png" class="[screenshot]">
<h3 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples"></a>Examples</h3><h4 id="KVM-Kernel-basedVM"><a href="#KVM-Kernel-basedVM" class="headerlink" title="KVM (Kernel-basedVM)"></a>KVM (Kernel-basedVM)</h4><ul>
<li>Based on Linux</li>
<li>KVM kernel module + QEMU for hardware virtualization</li>
<li>Leverages Linux open-source community</li>
</ul>
<h1 id="Hardware-Protection-Levels"><a href="#Hardware-Protection-Levels" class="headerlink" title="Hardware Protection Levels"></a>Hardware Protection Levels</h1><p>Commodity hardware has more than 2 <strong>protection levels</strong></p>
<p>e.g. x86 has </p>
<ul>
<li><strong>4 protection levels</strong> (rings)<br>  ring3: apps<br>  ring1: OS<br>  ring0: hypervisor</li>
<li>and <strong>2 protection modes</strong> (root &amp; non-root)<ul>
<li>non-root: VMs<br>  ring3: apps<br>  ring0: OS</li>
<li>root: ring0: hypervisor</li>
</ul>
</li>
</ul>
<h1 id="Processor-Virtualization-Trap-and-Emulate"><a href="#Processor-Virtualization-Trap-and-Emulate" class="headerlink" title="Processor Virtualization (Trap and Emulate)"></a>Processor Virtualization (Trap and Emulate)</h1><p>Guest instructions…</p>
<pre><code>- Executed **directly by hardware**, VMM not involved
- For **non-privileged operations**: hardware speeds -&gt; efficiency
- For **privileged operations**: __TRAP__ to hypervisor
- Hypervisor determines what needs to be done:
    a. if **illegal op**: terminate VM
    b. if **legal op**: __emulate__ the behavior the guest OS was expecting from the hardware
</code></pre><h2 id="Problems-with-Trap-and-Emulate"><a href="#Problems-with-Trap-and-Emulate" class="headerlink" title="Problems with Trap-and-Emulate"></a>Problems with Trap-and-Emulate</h2><p>When privileged operations fail silently, the hyperevisor doesn’t know and hence would try to do anything; and the OS doesn’t know that hypervisor didn’t do anything, and would assume any operation it requested as successful operations. In <strong>Pre 2005 x86 machines</strong>, there are <strong>17</strong> such operations</p>
<h2 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions"></a>Solutions</h2><h3 id="Binary-Translation"><a href="#Binary-Translation" class="headerlink" title="Binary Translation"></a>Binary Translation</h3><ul>
<li>Main Idea: rewrite the VM binary to never issue those 17 instructions</li>
<li>Commercialized by VMWare</li>
<li>Goal: <strong>full virtualization</strong> == guest OS not modified</li>
<li>Approach: <strong>Dynamic binary translation</strong><ol>
<li>Inspect code blocks to be executed</li>
<li>If needed, translate to alternate instruction sequence<ul>
<li>e.g., to emulate desired behavior, possibly even avoiding trap</li>
</ul>
</li>
<li>Otherwise, run at hardware speeds<ul>
<li>Cache translations</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="Paravirtualization"><a href="#Paravirtualization" class="headerlink" title="Paravirtualization"></a>Paravirtualization</h2><ul>
<li>Goal: <strong>Performance</strong> - give up on unmodified guests</li>
<li>Approach: <strong>paravirtualization</strong> == modify guest so that<ul>
<li>its knows it’s running virtualized</li>
<li>it makes explicit calls to the hypervisor <strong>(hypercalls)</strong>, for those 17 instructions</li>
<li>hypercall (~system calls)<ol>
<li>Package context info</li>
<li>Specify desired hypercall</li>
<li>Trap to VMM</li>
</ol>
</li>
</ul>
</li>
<li>e.g., Xen</li>
</ul>
<h1 id="Memory-Virtualization"><a href="#Memory-Virtualization" class="headerlink" title="Memory Virtualization"></a>Memory Virtualization</h1><h2 id="Full"><a href="#Full" class="headerlink" title="Full"></a>Full</h2><ul>
<li>All guests expect contiguous physical memory, starting at 0</li>
<li>Need to distinguish between<br>  a. Virtual Addresses<br>  b. Physical Addresses<br>  c. Machine Addresses<br>  d. Page frame bumbers</li>
<li>Still leverages hardware <strong>MMU</strong>, <strong>TLB</strong>, …</li>
<li>Option 1:<ul>
<li>Guest page table: <strong>VA -&gt; PA</strong></li>
<li>Hypervisor: <strong>PA -&gt; MA</strong></li>
<li><strong>TOO EXPENSIVE</strong></li>
</ul>
</li>
<li>Option 2:<ul>
<li>Guest Page Tables: <strong>VA =&gt; PA</strong></li>
<li>Hypervisor <strong>shadow PT</strong>: <strong>VA =&gt; MA</strong></li>
<li>Hypervisor maintains consistence</li>
</ul>
</li>
</ul>
<h2 id="Paravirtualized"><a href="#Paravirtualized" class="headerlink" title="Paravirtualized"></a>Paravirtualized</h2><ul>
<li>Guest aware of virtualization</li>
<li>No longer strict requirement on contiguous physical memory starting @ 0</li>
<li>Explicitly registers page tables with hypervisor</li>
</ul>
<h1 id="Device-Virtualization"><a href="#Device-Virtualization" class="headerlink" title="Device Virtualization"></a>Device Virtualization</h1><ul>
<li>For <strong>CPUs and memory</strong> - <strong>less diversity</strong>, because ISA (Instruction Set Architecture) has standardization of interface, and it’s up to the hardware manufacturer to implement them</li>
<li>For <strong>devices</strong> - <strong>high diversity</strong>, and lack of standard specification of device interface and behavior</li>
</ul>
<h2 id="3-Key-Models-for-Device-Virtualization"><a href="#3-Key-Models-for-Device-Virtualization" class="headerlink" title="3 Key Models for Device Virtualization"></a>3 Key Models for Device Virtualization</h2><h3 id="Passthrough-Model"><a href="#Passthrough-Model" class="headerlink" title="Passthrough Model"></a>Passthrough Model</h3><img src="/imgs/OMSCS/OS/OS_12/OS_12_Screenshot4.png" class="[screenshot]">
<ul>
<li>Approach: VMM-level driver configures device access permissions</li>
<li>Benefits:<ul>
<li>VM provided with exclusive access to the device</li>
<li>VM can directly access the device (VMM - bypass)</li>
</ul>
</li>
<li>Downside:<ul>
<li>Device sharing difficult</li>
<li>VMM must have exact type of device as what VM expects</li>
<li>Because VM is tied to the device, it breaks the decouple rule and makes migration tricky</li>
</ul>
</li>
</ul>
<h3 id="Hypervisor-Direct-model"><a href="#Hypervisor-Direct-model" class="headerlink" title="Hypervisor-Direct model"></a>Hypervisor-Direct model</h3><img src="/imgs/OMSCS/OS/OS_12/OS_12_Screenshot5.png" class="[screenshot]">
<ul>
<li>Approach:<ul>
<li>VMM interrupts all device accesses</li>
<li>Emulate device operations:<br>  a. Translate to generic I/O Operations<br>  b. Tranverse VMM-resident I/O stack<br>  c. Invoke VMM-resident driver</li>
</ul>
</li>
<li>Benefits<ul>
<li>VM decoupled from physical device</li>
<li>Sharing, migration beceom easier</li>
</ul>
</li>
<li>Downside:<ul>
<li>Latency of device operations</li>
<li>Device driver ecosystem complexityin hypervisor</li>
</ul>
</li>
</ul>
<h3 id="Split-Device-Driver-Model"><a href="#Split-Device-Driver-Model" class="headerlink" title="Split-Device Driver Model"></a>Split-Device Driver Model</h3><img src="/imgs/OMSCS/OS/OS_12/OS_12_Screenshot6.png" class="[screenshot]">
<ul>
<li>Approach: Device access control <strong>split</strong> between<ul>
<li><strong>front end driver</strong> in guest VM (device API)</li>
<li><strong>back end driver</strong> in service VM (or host): just regular device driver</li>
<li>Modified guest drivers =&gt; <strong>limited to paravirtualized guests</strong></li>
</ul>
</li>
<li>Benefits:<ul>
<li>Eliminate emulation overhead</li>
<li>Allow for better management of shared devices, because we have a back-end device driver centralized across all guest VMs</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/05/omscs-os-11-io-management/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/05/omscs-os-11-io-management/" itemprop="url">
                  Operating System - I/O Management
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-05T22:39:05-07:00">
                2017-04-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li>OS support for <strong>I/O devices</strong></li>
<li><strong>Block device</strong> stack</li>
<li><strong>File system</strong> architecture</li>
</ul>
<h1 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">I/O</th>
<th style="text-align:center">Shipping department in toy shop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Have protocols</td>
<td style="text-align:center">How/what comes in/goes out</td>
<td style="text-align:center">Interfaces for device I/O</td>
</tr>
<tr>
<td style="text-align:center">Have dedicated handlers</td>
<td style="text-align:center">Dedicated staff</td>
<td style="text-align:center">Device drivers, interrupt handlers</td>
</tr>
<tr>
<td style="text-align:center">Decouple I/O details from core processing</td>
<td style="text-align:center">Abstracts shipping details from making toys</td>
<td style="text-align:center">Abstract I/O device dtail from applications</td>
</tr>
</tbody>
</table>
<h1 id="Basic-I-O-Device-Features"><a href="#Basic-I-O-Device-Features" class="headerlink" title="Basic I/O Device Features"></a>Basic I/O Device Features</h1><h2 id="Control-registers-that-CPU-can-access"><a href="#Control-registers-that-CPU-can-access" class="headerlink" title="Control registers that CPU can access"></a>Control registers that CPU can access</h2><ul>
<li>command: control what the device is doing</li>
<li>status: what is happening</li>
<li>data: used for data transfer in/out</li>
</ul>
<h2 id="Micro-Controller"><a href="#Micro-Controller" class="headerlink" title="Micro Controller"></a>Micro Controller</h2><p>Device’s CPU</p>
<h2 id="On-Device-memory"><a href="#On-Device-memory" class="headerlink" title="On Device memory"></a>On Device memory</h2><h2 id="Other-logic"><a href="#Other-logic" class="headerlink" title="Other logic"></a>Other logic</h2><ul>
<li>Analog to digital convert</li>
</ul>
<h1 id="CPU-Device-Interconnect"><a href="#CPU-Device-Interconnect" class="headerlink" title="CPU Device Interconnect"></a>CPU Device Interconnect</h1><img src="/imgs/OMSCS/OS/OS_11/OS_11_Screenshot1.png" class="[screenshot]">
<h2 id="Peripheral-Component-Interconnect-PCI-bus"><a href="#Peripheral-Component-Interconnect-PCI-bus" class="headerlink" title="Peripheral Component Interconnect (PCI) bus"></a>Peripheral Component Interconnect (PCI) bus</h2><ul>
<li>Used to connect devices via CPU</li>
<li>Now mostlly use PCIe (PCI Express) &gt; PCI-X</li>
</ul>
<h2 id="Other-types-of-interconnects"><a href="#Other-types-of-interconnects" class="headerlink" title="Other types of interconnects"></a>Other types of interconnects</h2><ul>
<li>SCSI bus</li>
<li>Peripheral bus</li>
<li>Bridges handle differences</li>
</ul>
<h1 id="Device-Drivers"><a href="#Device-Drivers" class="headerlink" title="Device Drivers"></a>Device Drivers</h1><ul>
<li>Per <strong>each device type</strong></li>
<li>Responsible for <strong>device access</strong>, <strong>management</strong> and <strong>control</strong></li>
<li>Provied by device manufacturers per OS/version</li>
<li>Each OS standardizes interfaces: device <strong>independence &amp; diversity</strong></li>
</ul>
<h1 id="Types-of-Devices"><a href="#Types-of-Devices" class="headerlink" title="Types of Devices"></a>Types of Devices</h1><p>Operating representation of a device == <strong>special device file (file descriptor)</strong></p>
<h2 id="Block-disk"><a href="#Block-disk" class="headerlink" title="Block: disk"></a>Block: disk</h2><ul>
<li>Read/write blocks of data</li>
<li>Direct access to arbitrary block</li>
</ul>
<h2 id="Character-keyboard"><a href="#Character-keyboard" class="headerlink" title="Character: keyboard"></a>Character: keyboard</h2><ul>
<li>Get/put character</li>
</ul>
<h2 id="Network-devices"><a href="#Network-devices" class="headerlink" title="Network devices"></a>Network devices</h2><h1 id="CPU-Device-Interactions"><a href="#CPU-Device-Interactions" class="headerlink" title="CPU Device Interactions"></a>CPU Device Interactions</h1><h2 id="CPU-to-Devices"><a href="#CPU-to-Devices" class="headerlink" title="CPU to Devices"></a>CPU to Devices</h2><ul>
<li>Device access is pretty much accessing memory, and then the PCI bus will route the memory access to related devices. This needs part of the physical memory be mapped for I/O -&gt; use some <strong>Base Address Register</strong></li>
<li>I/O port: dedicated in/out instructions for device accesses</li>
</ul>
<h2 id="Devices-to-CPU"><a href="#Devices-to-CPU" class="headerlink" title="Devices to CPU"></a>Devices to CPU</h2><h3 id="Interrupt"><a href="#Interrupt" class="headerlink" title="Interrupt"></a>Interrupt</h3><p>Devices generate interrupts to CPU, and gets handled by oppose</p>
<p>+: Can response as soon as possible<br>-: Interrupt handling could be expensive</p>
<h3 id="Polling"><a href="#Polling" class="headerlink" title="Polling"></a>Polling</h3><p>CPU keeps polling devices by reading their status registers to see if there are actions/data available</p>
<p>+: Convenient time for Operating Systems<br>-: Delay or CPU overhead</p>
<h1 id="Device-access"><a href="#Device-access" class="headerlink" title="Device access"></a>Device access</h1><h2 id="Programmed-I-O-PIO"><a href="#Programmed-I-O-PIO" class="headerlink" title="Programmed I/O (PIO)"></a>Programmed I/O (PIO)</h2><ul>
<li>No additional hardware support. CPU directly issues instructions by writing to the <strong>command register</strong> of a device, and controls data movement by accessing the <strong>data register</strong> of a device</li>
</ul>
<h2 id="Direct-Memory-Acceess-DMA"><a href="#Direct-Memory-Acceess-DMA" class="headerlink" title="Direct Memory Acceess (DMA)"></a>Direct Memory Acceess (DMA)</h2><ul>
<li>Relies on DMA controller</li>
<li>CPU still issues instructions directly to <strong>command registers</strong></li>
<li>CPU interacts with <strong>data register</strong> via <strong>DMA Controller</strong></li>
<li>This will result in <strong>less</strong> steps, but the DMA step is complexed</li>
<li>Data buffer used by DMA must be in physical memory untill transfer completes =&gt; <strong>pinned region (not swappable)</strong></li>
</ul>
<h2 id="Typical-Device-Accesses"><a href="#Typical-Device-Accesses" class="headerlink" title="Typical Device Accesses"></a>Typical Device Accesses</h2><img src="/imgs/OMSCS/OS/OS_11/OS_11_Screenshot2.png" class="[screenshot]">
<h2 id="Operating-System-Bypass"><a href="#Operating-System-Bypass" class="headerlink" title="Operating System Bypass"></a>Operating System Bypass</h2><ul>
<li>User process can directly access <strong>device regs/data</strong></li>
<li>Operating System involves in configuration, but then out-of-the-way</li>
<li>Needs <strong>user-level driver (~library)</strong> to connect user process and drivers, usually provide by manufacturer</li>
<li>Relies on <strong>device features</strong>, e.x. sufficient registers so that OS can map some to user processes</li>
<li>Operating System retains <strong>coarse-grain</strong> control</li>
</ul>
<h2 id="What-happens-to-a-thread-calling-devices"><a href="#What-happens-to-a-thread-calling-devices" class="headerlink" title="What happens to a thread calling devices?"></a>What happens to a thread calling devices?</h2><img src="/imgs/OMSCS/OS/OS_11/OS_11_Screenshot2.png" class="[screenshot]">
<h3 id="Synchronous-I-O-Operations"><a href="#Synchronous-I-O-Operations" class="headerlink" title="Synchronous I/O Operations"></a>Synchronous I/O Operations</h3><ul>
<li>Process is blocked</li>
</ul>
<h3 id="Asynchronous-I-O-Operations"><a href="#Asynchronous-I-O-Operations" class="headerlink" title="Asynchronous I/O Operations"></a>Asynchronous I/O Operations</h3><ul>
<li>Process continues</li>
<li>Later, either<br>  a. Process checks and retrieves result (polling based)<br>  b. Process is notified that the operation is completed and results are ready (interupt based)</li>
</ul>
<h2 id="Block-Device-Stack"><a href="#Block-Device-Stack" class="headerlink" title="Block Device Stack"></a>Block Device Stack</h2><p>Typical storage for files</p>
<h3 id="User-Process-file"><a href="#User-Process-file" class="headerlink" title="User Process (file)"></a>User Process (file)</h3><ul>
<li>Processes use files: a logical unit</li>
</ul>
<h3 id="Kernel"><a href="#Kernel" class="headerlink" title="Kernel"></a>Kernel</h3><ul>
<li>Uses <strong>File System</strong></li>
<li>Where, how to find and access file</li>
<li>Operating specifies interface such as <strong>POSIX API</strong> for read/write operations</li>
</ul>
<h3 id="Generic-Block-layer"><a href="#Generic-Block-layer" class="headerlink" title="Generic Block layer"></a>Generic Block layer</h3><ul>
<li>OS standardized block interface</li>
<li>Passes operations to driver, and interpret errors/notifications from driver</li>
</ul>
<h3 id="Device-Driver"><a href="#Device-Driver" class="headerlink" title="Device Driver"></a>Device Driver</h3><ul>
<li>Uses protocol specific APIs to interact with devices</li>
</ul>
<h2 id="Virtual-File-system"><a href="#Virtual-File-system" class="headerlink" title="Virtual File system"></a>Virtual File system</h2><h3 id="Abstractions"><a href="#Abstractions" class="headerlink" title="Abstractions"></a>Abstractions</h3><ul>
<li><strong>File</strong> == elements on which the VFS operates</li>
<li><strong>file descriptor</strong> == Operating System representation of file; support different actions (e.x. open, read, write)</li>
<li><strong>inode</strong> persistent representation of file “index”<ol>
<li>list of all data blocks</li>
<li>device, permissions, size, …</li>
</ol>
</li>
<li><strong>dentry</strong> == directory entry, corresponds to single path component, only in memory maintained by OS</li>
<li><strong>dentry cache</strong></li>
<li><strong>superblock</strong>: file system - specific information regarding the FS layout</li>
</ul>
<h3 id="VFS-on-Disk-other-than-the-dentry"><a href="#VFS-on-Disk-other-than-the-dentry" class="headerlink" title="VFS on Disk (other than the dentry)"></a>VFS on Disk (other than the dentry)</h3><ul>
<li><strong>file</strong> == data blocks on disk</li>
<li><strong>inode</strong> == track files’ blocks, also resides on disk in some blocks</li>
<li><strong>superblock</strong> == overall map of disk blocks<ol>
<li>inode blocks</li>
<li>data blocks</li>
<li>free blocks</li>
</ol>
</li>
</ul>
<h3 id="Example-ext2-Second-Extended-Filesystem"><a href="#Example-ext2-Second-Extended-Filesystem" class="headerlink" title="Example - ext2: Second Extended Filesystem"></a>Example - ext2: Second Extended Filesystem</h3><img src="/imgs/OMSCS/OS/OS_11/OS_11_Screenshot4.png" class="[screenshot]">
<h3 id="inodes"><a href="#inodes" class="headerlink" title="inodes"></a>inodes</h3><img src="/imgs/OMSCS/OS/OS_11/OS_11_Screenshot5.png" class="[screenshot]">
<ul>
<li>Limits file size</li>
</ul>
<h3 id="inodes-with-indirect-pointers"><a href="#inodes-with-indirect-pointers" class="headerlink" title="inodes with indirect pointers"></a>inodes with indirect pointers</h3><img src="/imgs/OMSCS/OS/OS_11/OS_11_Screenshot6.png" class="[screenshot]">
<ul>
<li>Benefits: small inode could map to large file size</li>
<li>Downside: slow down file access<ul>
<li>e.g. direct ptr =&gt; <strong>2 disk access</strong>, while double indirect ptr =&gt; <strong>up to 4 disk accesses</strong></li>
</ul>
</li>
</ul>
<h2 id="Disk-Access-Optimizations"><a href="#Disk-Access-Optimizations" class="headerlink" title="Disk Access Optimizations"></a>Disk Access Optimizations</h2><h3 id="Caching-buffering"><a href="#Caching-buffering" class="headerlink" title="Caching/buffering"></a>Caching/buffering</h3><ul>
<li>Reduce # disk accesses</li>
<li>In main memory</li>
<li>Read/write from cache</li>
<li>Periodically flush to disk</li>
</ul>
<h3 id="I-O-Scheduling"><a href="#I-O-Scheduling" class="headerlink" title="I/O Scheduling"></a>I/O Scheduling</h3><ul>
<li>Reduce disk head movement</li>
<li>Maximize <strong>sequential</strong> v.s. <strong>random</strong> access</li>
<li>e.g., write block 25, write block 17; if head is at 15 =&gt; write 17, 25; they are still in memory (i.e. will be lost if crashes)</li>
</ul>
<h3 id="Prefetching"><a href="#Prefetching" class="headerlink" title="Prefetching"></a>Prefetching</h3><ul>
<li>Increases cache hits</li>
<li>Leverages locality</li>
<li>e.g., read block 17 =&gt; also read 18, 19</li>
</ul>
<h3 id="Journaling-logging"><a href="#Journaling-logging" class="headerlink" title="Journaling/logging"></a>Journaling/logging</h3><ul>
<li>Reduce random access</li>
<li>“describe” write in <strong>log</strong>: block, offset, value…</li>
<li>Periodically apply updates to proper disk locations</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/22/omscs-os-10-sync-construct/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/omscs-os-10-sync-construct/" itemprop="url">
                  Operating System - Synchronization Construct
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-22T10:25:14-07:00">
                2017-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li>More <strong>synchornization</strong> constructs</li>
<li>Hardware supported <strong>synchronization</strong></li>
<li>References: <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-anderson-paper.pdf" target="_blank" rel="external">“The Performance of Spin Lock Alternatives for Shared-Memory Multiprocessors”</a></li>
</ul>
<h1 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">Synchronization</th>
<th style="text-align:center">Waiting for a coworker to finish so that you can continue working</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">May repeatedly check to continue</td>
<td style="text-align:center">Sync using <strong>spinlocks</strong></td>
<td style="text-align:center">Are you done?</td>
</tr>
<tr>
<td style="text-align:center">May wait for a signal to continue</td>
<td style="text-align:center">Sync using <strong>mutexes</strong> and <strong>conditional var</strong></td>
<td style="text-align:center">Hey I’m done</td>
</tr>
<tr>
<td style="text-align:center">Waiting hurts performance</td>
<td style="text-align:center">Waste CPU cycles</td>
<td style="text-align:center">Waste productive time while waiting</td>
</tr>
</tbody>
</table>
<h1 id="Why-more-about-synchronization"><a href="#Why-more-about-synchronization" class="headerlink" title="Why more about synchronization?"></a>Why more about synchronization?</h1><h2 id="Limitation-of-mutexes-and-condition-var"><a href="#Limitation-of-mutexes-and-condition-var" class="headerlink" title="Limitation of mutexes and condition var"></a>Limitation of mutexes and condition var</h2><ul>
<li>Error prone/correctness/ease-of-use: unlock wrong mutex, signal wrong condition variables</li>
<li>Lack of expressive power: helper variables for access or priority controls</li>
</ul>
<h2 id="Requires-lower-lever-support"><a href="#Requires-lower-lever-support" class="headerlink" title="Requires lower lever support"></a>Requires lower lever support</h2><ul>
<li>Hardware <strong>atomic instructions</strong></li>
</ul>
<h2 id="Spinlocks-basic-sync-construct"><a href="#Spinlocks-basic-sync-construct" class="headerlink" title="Spinlocks (basic sync construct)"></a>Spinlocks (basic sync construct)</h2><ul>
<li>Spinlock is like a mutex:<ul>
<li>mutual exclusion</li>
<li>lock and unlock (free): spinlock_lock(s); spinlock_unlock(s);</li>
</ul>
</li>
<li>Different: lock == busy -&gt; will keep spinning and cost cpu cycles (i.e. the locked process will not be blocked but spinning)</li>
</ul>
<h2 id="Semaphores"><a href="#Semaphores" class="headerlink" title="Semaphores"></a>Semaphores</h2><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><ul>
<li>Common sync construct in OS kernels</li>
<li>Like a traffic light <strong>STOP</strong> and <strong>GO</strong></li>
<li>Similar to a mutex, but more general</li>
</ul>
<h3 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h3><ul>
<li>Semaphore == integer values =&gt; <strong>count-based sync</strong></li>
<li>on init: <ul>
<li>assigned a max value(positive int) =&gt; <strong>maximum count</strong></li>
</ul>
</li>
<li>on try (wait) - P(Proberen):<ul>
<li>if none-zero =&gt; decrement and proceed =&gt; <strong>counting semaphores</strong></li>
</ul>
</li>
<li>if initialized with 1:<ul>
<li>equivalent to  mutex (binary semaphore)</li>
</ul>
</li>
<li>on exit (post) - V(verhogen): increment</li>
</ul>
<h3 id="POSIX-Semaphore-APIs"><a href="#POSIX-Semaphore-APIs" class="headerlink" title="POSIX Semaphore APIs"></a>POSIX Semaphore APIs</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">sem_t</span> sem;</div><div class="line">sem_init(<span class="keyword">sem_t</span> *sem, <span class="keyword">int</span> pshared, <span class="keyword">int</span> count);</div><div class="line">sem_wait(<span class="keyword">sem_t</span> *sem);</div><div class="line">sem_post(<span class="keyword">sem_t</span> *sem);</div></pre></td></tr></table></figure>
<h2 id="Reader-Writer-Locks"><a href="#Reader-Writer-Locks" class="headerlink" title="Reader/Writer Locks"></a>Reader/Writer Locks</h2><h3 id="Syncing-different-types-of-accesses"><a href="#Syncing-different-types-of-accesses" class="headerlink" title="Syncing different types of accesses"></a>Syncing different types of accesses</h3><ul>
<li>Read (never modify): shared access</li>
<li>Write (always modify): exclusive access</li>
</ul>
<h3 id="How-it-works-1"><a href="#How-it-works-1" class="headerlink" title="How it works"></a>How it works</h3><ul>
<li>Specify the type of access</li>
<li>Then lock behaves accordingly</li>
</ul>
<h3 id="Using-RW-Locks-in-Linux"><a href="#Using-RW-Locks-in-Linux" class="headerlink" title="Using RW Locks in Linux"></a>Using RW Locks in Linux</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/spinlock.h&gt;</span></span></div><div class="line"><span class="keyword">rwlock_t</span> m;</div><div class="line">read_lock(m);</div><div class="line">    <span class="comment">// critical section</span></div><div class="line">read_unlock(m);</div><div class="line"></div><div class="line">write_lock(m);</div><div class="line">    <span class="comment">// critical section</span></div><div class="line">write_unlock(m);</div></pre></td></tr></table></figure>
<h3 id="Semeantic-differences"><a href="#Semeantic-differences" class="headerlink" title="Semeantic differences"></a>Semeantic differences</h3><ul>
<li>Recursive read lock</li>
<li>Upgrade/downgrade <strong>priority</strong></li>
<li>Interaction with scheduling policy - block if higher <strong>priority writers</strong> waiting</li>
</ul>
<h2 id="Monitors"><a href="#Monitors" class="headerlink" title="Monitors"></a>Monitors</h2><ul>
<li>Higher level sync process</li>
<li>OR a programming style</li>
<li>It specifies:<ul>
<li>Shared resource</li>
<li>Entry procedure</li>
<li>Possible condition variables</li>
</ul>
</li>
<li>On entry: lock, check, etc…</li>
<li>On exit: unlock, check, signal, etc…</li>
</ul>
<h2 id="More-other-structs"><a href="#More-other-structs" class="headerlink" title="More other structs"></a>More other structs</h2><ul>
<li>serializers</li>
<li>path expressions</li>
<li>barriers</li>
<li>rendezvous points</li>
<li>optimistic wait-free sync (RCU)</li>
<li><strong>All of them need hardware support</strong></li>
</ul>
<h1 id="Spinlock"><a href="#Spinlock" class="headerlink" title="Spinlock"></a>Spinlock</h1><h2 id="Overview-1"><a href="#Overview-1" class="headerlink" title="Overview"></a>Overview</h2><ul>
<li>References: <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-anderson-paper.pdf" target="_blank" rel="external">“The Performance of Spin Lock Alternatives for Shared-Memory Multiprocessors”</a></li>
<li>Alternative <strong>implementations</strong> of spinlocks</li>
<li>Generalize techiques to other constructs</li>
</ul>
<h2 id="Some-INCORRECT-IMPLEMENTATION"><a href="#Some-INCORRECT-IMPLEMENTATION" class="headerlink" title="Some INCORRECT IMPLEMENTATION"></a>Some INCORRECT IMPLEMENTATION</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">spinlock_init(lock):</div><div class="line">    lock = <span class="built_in">free</span>;    <span class="comment">// 0 = free; 1 = busy</span></div><div class="line"></div><div class="line">spinlock_lock(lock):</div><div class="line">    spin:</div><div class="line">        <span class="keyword">if</span>(lock == <span class="built_in">free</span>) &#123; lock = busy; &#125;</div><div class="line">        <span class="keyword">else</span> &#123; <span class="keyword">goto</span> spin &#125;</div><div class="line"></div><div class="line">spinlock_unlock(lock):</div><div class="line">    lock = <span class="built_in">free</span></div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">spinlock_init(lock):</div><div class="line">    lock = <span class="built_in">free</span>;    <span class="comment">// 0 = free; 1 = busy</span></div><div class="line"></div><div class="line">spinlock_lock(lock):</div><div class="line">    <span class="keyword">while</span> (lock == busy)</div><div class="line">    lock = busy;</div><div class="line"></div><div class="line">spinlock_unlock(lock):</div><div class="line">    lock = <span class="built_in">free</span></div></pre></td></tr></table></figure>
<ul>
<li>Both implementations are <strong>Inefficient</strong> and <strong>Incorrect</strong> because of the loop, and the fact that the condition could be met concurrently</li>
</ul>
<h2 id="Need-Hardware-Support"><a href="#Need-Hardware-Support" class="headerlink" title="Need Hardware Support"></a>Need Hardware Support</h2><ul>
<li>The checking of the lock and setting of the lock need to be <strong>atomic</strong></li>
<li>Need hardware to support <strong>atomic instructions</strong></li>
</ul>
<h3 id="Atomic-Instructions"><a href="#Atomic-Instructions" class="headerlink" title="Atomic Instructions"></a>Atomic Instructions</h3><ul>
<li>Popular instructions<ol>
<li>test_and_set</li>
<li>read_and_increment</li>
<li>compare_and_swap</li>
</ol>
</li>
<li>Would be different from hardwares to hardwares</li>
<li>Guarantees:<ul>
<li>Atomicity</li>
<li>Mutual exclusion</li>
<li>Queue all concurrent instructions but one</li>
</ul>
</li>
<li>Atomic instructions == critical section with hardware-supported synchronization</li>
<li><p>Example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">spinlock_lock(lock):</div><div class="line">    <span class="keyword">while</span>(test_and_set(lock) == busy)</div></pre></td></tr></table></figure>
</li>
<li><p><strong>test_and_set(lock)</strong></p>
<ul>
<li><strong>Atomically</strong> returns original value and <strong>sets</strong> new value</li>
<li>First thread: test_and_set(lock) =&gt; free</li>
<li>Next ones: test_and_set(lock) =&gt; busy</li>
<li>Next ones all reset lock to 1, but thats ok</li>
</ul>
</li>
</ul>
<h2 id="Shared-Memory-Multiprocessors-Recap"><a href="#Shared-Memory-Multiprocessors-Recap" class="headerlink" title="Shared Memory Multiprocessors - Recap"></a>Shared Memory Multiprocessors - Recap</h2><h3 id="Caches"><a href="#Caches" class="headerlink" title="Caches"></a>Caches</h3><ul>
<li>Hide memory latency, but also memory will be <strong>further away</strong> due to this contention</li>
<li>Certain mechanisms for writing:<ol>
<li>no-write: CPU cannot write in cache, and will write in physical memory, and the corresponding entry in cache will become <strong>invalid</strong></li>
<li>write-through: CPU will update both cache and physical memory</li>
<li>write-back: CPU will update cache, and then delay the update to physical memory till sometime later</li>
</ol>
</li>
</ul>
<h3 id="Cache-Coherence"><a href="#Cache-Coherence" class="headerlink" title="Cache Coherence"></a>Cache Coherence</h3><ul>
<li>What if a CPU is accessing some data that existing in memory, and also in caches of other CPUs?</li>
<li><strong>Non-Cache-Coherent (NCC)</strong> - Fix in software</li>
<li><strong>Cache-Coherent (CC)</strong> - Hardware will handle and make sure that caches are coherent</li>
<li>Methods:<ol>
<li>Write-invalidate (WI): whenever one CPU updates some data, same memory locations in caches of other CPUs will be invalid, and hence next access to it from other CPU will be a <strong>miss</strong></li>
<li>Write-update (WR): whenever one CPU updates some data, hardware will try to also update the same memory location in caches of other CPUs</li>
</ol>
</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_10/OS_10_Screenshot1.png" class="[screenshot]">
<h3 id="Cache-Coherence-and-Atomics"><a href="#Cache-Coherence-and-Atomics" class="headerlink" title="Cache Coherence and Atomics"></a>Cache Coherence and Atomics</h3><p>Problems arise because when a CPU is trying to update some memory with <strong>atomic instructions</strong>, it does not know/guarantee that other CPUs cannot perform the same <strong>atomic instructions</strong> against the same shared memory location (in its own cache)</p>
<h4 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions"></a>Solutions</h4><ul>
<li>Atomics always issue to the memory controller<ul>
<li>Pros: can be ordered and synchronizaed</li>
<li>Cons: take <strong>TOO MUCH TIME</strong> and generates conherence traffic</li>
</ul>
</li>
</ul>
<h3 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h3><p>Atomics is expensive because of </p>
<ul>
<li>bus or I/C contention</li>
<li>cache bypass &amp; coherence traffic</li>
</ul>
<h2 id="Spinlock-Performance-Metrics"><a href="#Spinlock-Performance-Metrics" class="headerlink" title="Spinlock Performance Metrics"></a>Spinlock Performance Metrics</h2><h2 id="Objectives"><a href="#Objectives" class="headerlink" title="Objectives"></a>Objectives</h2><ul>
<li>Reduce <strong>latency</strong><ul>
<li>“time to acquire a free lock”</li>
<li>Ideally immediately execute atomic</li>
</ul>
</li>
<li>Reduce <strong>waiting time (deley)</strong><ul>
<li>“time to stop spinning and acquire a lock that has been freed”</li>
<li>Ideally immediately</li>
</ul>
</li>
<li>Reduce <strong>contention</strong><ul>
<li>“bus/network I/C traffic”</li>
<li>Ideally zero</li>
</ul>
</li>
</ul>
<h2 id="Test-and-Set-Spinlock"><a href="#Test-and-Set-Spinlock" class="headerlink" title="Test-and-Set-Spinlock"></a>Test-and-Set-Spinlock</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">spinlock_init(lock):</div><div class="line">    lock = <span class="built_in">free</span>;</div><div class="line"></div><div class="line">spinlock_lock(lock):</div><div class="line">    <span class="keyword">while</span>(test_and_set(lock) == busy)</div><div class="line"></div><div class="line">spinlock_unlock(lock):</div><div class="line">    lock = <span class="built_in">free</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>Latency</strong> is minimal (just atomic)</li>
<li><strong>Delay</strong> is potentially min</li>
<li><strong>Contention</strong> processors go to memory on each spin</li>
</ul>
<p>One improvement is to perform the <strong>test</strong> in <strong>cache</strong>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">spinlock_lock(lock):</div><div class="line">    <span class="keyword">while</span>((lock == busy <span class="comment">/* perform in cache */</span>) OR test_and_set(lock) == busy)</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>Latency</strong> ok</li>
<li><strong>Delay</strong> ok</li>
<li><strong>Contention</strong><ul>
<li>NCC - no difference</li>
<li>CC - WU - ok</li>
<li>CC - WI - <strong>horrible!</strong> (it will invalidate a busy lock in cache, and result in extra memory access)</li>
</ul>
</li>
</ul>
<h2 id="Spinlock-“Delay”-Alternatives"><a href="#Spinlock-“Delay”-Alternatives" class="headerlink" title="Spinlock “Delay” Alternatives"></a>Spinlock “Delay” Alternatives</h2><h3 id="Delay-after-each-release"><a href="#Delay-after-each-release" class="headerlink" title="Delay after each release"></a>Delay after each release</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">spinlock_lock(lock):</div><div class="line">    <span class="keyword">while</span>((lock == busy) OR (test_and_set(lock) == busy)) &#123;</div><div class="line">        <span class="keyword">while</span>(lock == busy);</div><div class="line">        delay();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>Everyone sees lock is free</li>
<li>Not everyone attempts to acquire it</li>
<li><strong>Latency</strong> ok</li>
<li><strong>Delay</strong> worse</li>
<li><strong>Contention</strong> improved</li>
</ul>
<h3 id="Delay-after-each-lock-ref"><a href="#Delay-after-each-lock-ref" class="headerlink" title="Delay after each lock ref"></a>Delay after each lock ref</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spinlock_lock(lock):</div><div class="line">    <span class="keyword">while</span>((lock == busy) OR (test_and_set(lock) == busy)) &#123;</div><div class="line">        delay();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>Doesn’t spin constantly</li>
<li>Works in NCC</li>
<li><strong>Latency</strong> ok</li>
<li><strong>Delay</strong> much worse</li>
<li><strong>Contention</strong> improved</li>
</ul>
<h4 id="Picking-a-Delay"><a href="#Picking-a-Delay" class="headerlink" title="Picking a Delay"></a>Picking a Delay</h4><h5 id="Static-Delay-based-on-fixed-value-e-g-CPU-ID"><a href="#Static-Delay-based-on-fixed-value-e-g-CPU-ID" class="headerlink" title="Static Delay (based on fixed value, e.g. CPU ID)"></a>Static Delay (based on fixed value, e.g. CPU ID)</h5><ul>
<li>Pros: simple approach</li>
<li>Cons: unecessary delay under low contention</li>
</ul>
<h5 id="Dynamic-Delay-backoff-based"><a href="#Dynamic-Delay-backoff-based" class="headerlink" title="Dynamic Delay (backoff-based)"></a>Dynamic Delay (backoff-based)</h5><ul>
<li>Random delay in a range that increases with “perceived” contentions</li>
<li><strong>perceived == failed test_and_set()</strong></li>
<li>Delay after each ref will keep growing</li>
</ul>
<h1 id="Queuing-Lock"><a href="#Queuing-Lock" class="headerlink" title="Queuing Lock"></a>Queuing Lock</h1><h2 id="Overview-2"><a href="#Overview-2" class="headerlink" title="Overview"></a>Overview</h2><img src="/imgs/OMSCS/OS/OS_10/OS_10_Screenshot2.png" class="[screenshot]">
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">init:</div><div class="line">    flags[<span class="number">0</span>] = has-lock;</div><div class="line">    flags[<span class="number">1.</span>.p<span class="number">-1</span>] = must-wait;</div><div class="line">    queuelast = <span class="number">0</span>; <span class="comment">// global variable</span></div><div class="line"></div><div class="line">lock:</div><div class="line">    <span class="comment">//get ticket</span></div><div class="line">    myplace = read_and_increment(queuelast);</div><div class="line">    <span class="comment">// spin</span></div><div class="line">    <span class="keyword">while</span> (flags[myplace mod p] == must-wait)</div><div class="line">    <span class="comment">// now in C.S</span></div><div class="line">    flags[myplace mod p] == must-wait</div><div class="line"></div><div class="line">unlock:</div><div class="line">    flags[myplace+<span class="number">1</span> mod p] = has-lock;</div></pre></td></tr></table></figure>
<ul>
<li><strong>Latency</strong> more costly with read_and_increment</li>
<li><strong>Delay</strong> good, everyone sees immediately</li>
<li><strong>Contention</strong> better!</li>
</ul>
<h1 id="Spinlock-Performance-Comparison"><a href="#Spinlock-Performance-Comparison" class="headerlink" title="Spinlock Performance Comparison"></a>Spinlock Performance Comparison</h1><ul>
<li>Under high loads<ul>
<li>Queue best (most scalable), test_and_test_and_set worst</li>
<li>Static better than dynamic, ref. better than release (avoids extra invalidations)</li>
</ul>
</li>
<li>Under light loads<ul>
<li>test_and_test_and_set good (low latency)</li>
<li>Dynamic better than static (low delay)</li>
<li>Queueing lock worst (high latency due to read_and_increment)</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/22/omscs-os-9-inner-process-communication/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/22/omscs-os-9-inner-process-communication/" itemprop="url">
                  Operating System - Inner Process Communication
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-22T00:27:27-07:00">
                2017-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li>Shared Memory IPC</li>
</ul>
<h1 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">Working together in toy shop</th>
<th style="text-align:center">IPC</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Sharing space</td>
<td style="text-align:center">Workers share work area</td>
<td style="text-align:center">Process share memory</td>
</tr>
<tr>
<td style="text-align:center">Communication</td>
<td style="text-align:center">Workers call each other</td>
<td style="text-align:center">Process exchanges Memory</td>
</tr>
<tr>
<td style="text-align:center">Requires Synchronization</td>
<td style="text-align:center">I’ll start when you finish</td>
<td style="text-align:center">Mutexes, waiting</td>
</tr>
</tbody>
</table>
<h1 id="Inter-Process-Communication-IPC"><a href="#Inter-Process-Communication-IPC" class="headerlink" title="Inter Process Communication (IPC)"></a>Inter Process Communication (IPC)</h1><ul>
<li>OS Supported mechanisms for interactions among processes (corrdination and communication)</li>
<li>Key Concepts:<ol>
<li>Message-based: socket, pipes, message queues</li>
<li>Memory-based: shared memory</li>
<li>Higher Level Semantic: files, Remote Process Call (RPC)</li>
<li>Synchronization Primitives</li>
</ol>
</li>
</ul>
<h2 id="Message-Based-IPC"><a href="#Message-Based-IPC" class="headerlink" title="Message Based IPC"></a>Message Based IPC</h2><h3 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h3><ul>
<li>OS maintains a channel (i.e. shared buffer), and processes basically read/recv and write/send from/to that channel</li>
<li>OS provides interfaces to processes - <strong>a port</strong>, processes access channel via the port</li>
<li><strong>Kernal</strong> is required to:<ol>
<li>Establisht communication</li>
<li>Perform IPC actions:<br> a. send: system call + copy <strong>from address space to channel</strong><br> b. recv: system call + copy <strong>from channel to address space</strong></li>
</ol>
</li>
<li>Cons: Each request-response will result in <strong>4 user-kernal crossing</strong> and <strong>4 data copies</strong></li>
<li>Pros: Simple, and kernal handles most of the content</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_9/OS_9_Screenshot1.png" class="[screenshot]">
<h3 id="Forms-of-Message-Based-IPC"><a href="#Forms-of-Message-Based-IPC" class="headerlink" title="Forms of Message Based IPC"></a>Forms of Message Based IPC</h3><h4 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h4><ul>
<li>Carry byte stream between <strong>2 processes</strong> (e.g. connect one process’s output to the other’s input)</li>
</ul>
<h4 id="Message-Queue"><a href="#Message-Queue" class="headerlink" title="Message Queue"></a>Message Queue</h4><ul>
<li>Carry “messages” among processes</li>
<li>OS should manage priority, scheduling, etc.</li>
<li>API: <strong>SysV</strong> and <strong>POSIX</strong></li>
</ul>
<h4 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h4><ul>
<li><strong>send() and recv()</strong> calls allow processes place messages in and out the kernal level buffer</li>
<li><strong>socket()</strong> creates kernal level buffer, and associate necessary kernal level processing (TCP/IP, etc.)</li>
<li>Could also communicate between different machines via network</li>
<li>If same machine, will just bypass protocal stack.</li>
</ul>
<h2 id="Shared-Memory-IPC"><a href="#Shared-Memory-IPC" class="headerlink" title="Shared Memory IPC"></a>Shared Memory IPC</h2><ul>
<li>Proccess <strong>read</strong> and <strong>write</strong> to some shared memory region</li>
<li>OS will establish that region<ol>
<li>Creates VA - PA Map</li>
<li>VA(P1) and VA(P2) point to the same PA</li>
<li>VA(P1) != VA(P2)</li>
<li>PA could be incontinuous</li>
</ol>
</li>
<li>Pros: system calls are only used to <strong>setup</strong>, data copies are avoided</li>
<li>Cons:<ol>
<li>Need explict synchronization</li>
<li>Programmer’s responsibility for shared buffer management and communication protocal - complex</li>
</ol>
</li>
<li>APIs<ol>
<li>SysV API</li>
<li>POSIX API</li>
<li>Memory Wrapped Files</li>
<li>Android ashmem</li>
</ol>
</li>
</ul>
<h1 id="Copy-Message-v-s-Map-Shared-Memory"><a href="#Copy-Message-v-s-Map-Shared-Memory" class="headerlink" title="Copy (Message) v.s. Map (Shared Memory)"></a>Copy (Message) v.s. Map (Shared Memory)</h1><p>Goal: Transfer data from one address space to target address space</p>
<h2 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h2><ul>
<li>Cost CPU cycles to copy data to/from port</li>
<li>Context switch</li>
</ul>
<h2 id="Shared-Memory"><a href="#Shared-Memory" class="headerlink" title="Shared Memory"></a>Shared Memory</h2><ul>
<li>CPU to map physical memory to address space</li>
<li>CPU to copy data (no context switch)</li>
<li>Setup time will be longer, but good tradeoff for many times or 1-time usage</li>
<li>For large data <strong>t(copy) &gt;&gt; t(map)</strong></li>
</ul>
<h1 id="SysV-Shared-Memory"><a href="#SysV-Shared-Memory" class="headerlink" title="SysV Shared Memory"></a>SysV Shared Memory</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><ul>
<li>Segmented shared memory - not necessarily continuous</li>
<li>System wide - system limits number of segments and sizes</li>
</ul>
<h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><ol>
<li><strong>Create</strong>: OS assigns key to segment of shared memory</li>
<li><strong>Attach</strong>: Map <strong>VA</strong> to <strong>PA</strong> (PA of the segment)</li>
<li><strong>Dettach</strong>: Invalidate the mapping (not destroyed)</li>
<li><strong>Destroy</strong>: Only when explicitly call or reboot</li>
</ol>
<img src="/imgs/OMSCS/OS/OS_9/OS_9_Screenshot2.png" class="[screenshot]">
<h2 id="APIs-SysV"><a href="#APIs-SysV" class="headerlink" title="APIs - SysV"></a>APIs - SysV</h2><ol>
<li><strong>Create</strong>: shmget(shmid, sizes, flags)<ul>
<li>flag - options</li>
<li>shmid - generated by ftok(pathname, proj_id)</li>
</ul>
</li>
<li><strong>Attach</strong>: shmat(shmid, address, flags)<ul>
<li>if addr == NULL, will assign arbitrarily</li>
<li>programmer need to cast the returned address properly</li>
</ul>
</li>
<li><strong>Dettach</strong>: shmdt(shmid)</li>
<li><strong>Destroy</strong>: shmctl(shmid, cmd, buf) - use IPC_RHID</li>
</ol>
<h2 id="APIs-POSIX"><a href="#APIs-POSIX" class="headerlink" title="APIs - POSIX"></a>APIs - POSIX</h2><ul>
<li>Use files instead of segments (but not real files), essentially still memory manipulations</li>
<li>key = file descriptor</li>
</ul>
<ol>
<li><strong>Create</strong>: shm_open() - return file descriptor</li>
<li><strong>Attach</strong> and <strong>Dettach</strong>: mmap() and unmmap() - map VA to PA</li>
<li><strong>Destroy</strong>:<ul>
<li>shm_close(): remove the file descriptor from address space</li>
<li>shm_unlink(): delete all related data structures and free the segment</li>
</ul>
</li>
</ol>
<h1 id="Shared-Memory-and-Synchronization"><a href="#Shared-Memory-and-Synchronization" class="headerlink" title="Shared Memory and Synchronization"></a>Shared Memory and Synchronization</h1><ul>
<li>Much like threads accessing shared resources in the same address space</li>
</ul>
<h2 id="Methods"><a href="#Methods" class="headerlink" title="Methods:"></a>Methods:</h2><ol>
<li>Mechanisms supported by process threading library (PThread)</li>
<li>OS supported IPC for synchronization</li>
</ol>
<ul>
<li>Either method should coordinate:<ol>
<li>Number of concurrent accesses (mutex)</li>
<li>When is data available (signal, conditional var)</li>
</ol>
</li>
<li>Synchronization data structures must be shared!</li>
</ul>
<h2 id="OS-Supported-IPC-for-synchronization"><a href="#OS-Supported-IPC-for-synchronization" class="headerlink" title="OS Supported IPC for synchronization:"></a>OS Supported IPC for synchronization:</h2><ul>
<li>Message queue: implement mutual exclusion via send/recv</li>
<li>Semaphores: Binary semaphore = mutex</li>
</ul>
<h1 id="Design-Consideration"><a href="#Design-Consideration" class="headerlink" title="Design Consideration"></a>Design Consideration</h1><p>Shared memory is out there, but need to consider and design protocal/sync properly</p>
<h2 id="How-many-segments"><a href="#How-many-segments" class="headerlink" title="How many segments?"></a>How many segments?</h2><ul>
<li>1 large segment: might then need a manager to free/allocate memory for the shared segment</li>
<li>many segments: might then need a segment queue, and certain mechanisms to allow communications between processes</li>
</ul>
<h2 id="How-large-should-the-segment-be"><a href="#How-large-should-the-segment-be" class="headerlink" title="How large should the segment be?"></a>How large should the segment be?</h2><ul>
<li>segment data == data size - works well for static sizes, but limits data size</li>
<li>segment data &lt; message size - transfer data in round, and need protocal to track the progress</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/19/nanodegree-ai-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/19/nanodegree-ai-2/" itemprop="url">
                  NanoDegree AI - Intro to Game Playing
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-19T19:08:45-07:00">
                2017-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Main-Topics"><a href="#Main-Topics" class="headerlink" title="Main Topics"></a>Main Topics</h1><ol>
<li>Adversarial search</li>
<li>Minimax Algorithm</li>
<li>Alpha-Beta Pruning</li>
<li>Evaluation Functions</li>
<li>Isolation Game player</li>
<li>Multi-Player, Probabilistic Games</li>
</ol>
<h1 id="MiniMax"><a href="#MiniMax" class="headerlink" title="MiniMax"></a>MiniMax</h1><h2 id="General-Ideas"><a href="#General-Ideas" class="headerlink" title="General Ideas"></a>General Ideas</h2><ul>
<li>Use Max and Min node for each layer</li>
<li>Indicating that oponents are always trying to minimize my (from computer perspective) score, and I am trying to maximize it.</li>
<li>Player representing computer will always be the top node (max node)</li>
<li>Propagate the value from bottom to top</li>
</ul>
<h2 id="Maximum-number-of-nodes-visited"><a href="#Maximum-number-of-nodes-visited" class="headerlink" title="Maximum number of nodes visited"></a>Maximum number of nodes visited</h2><ul>
<li>Could be extremely large without pruning</li>
<li>b^d: b is <strong>branch factor</strong> and d is <strong>depth</strong></li>
<li>Cannot brute-force the game!</li>
</ul>
<h2 id="Depth-Limited-search"><a href="#Depth-Limited-search" class="headerlink" title="Depth Limited search"></a>Depth Limited search</h2><ul>
<li>Calculate the maximum depth it can search, based on provided limited time</li>
<li>When reaching the limited depth, use an <strong>Evaluation Function</strong> to find the best move (node)</li>
</ul>
<h3 id="Evaluation-function"><a href="#Evaluation-function" class="headerlink" title="Evaluation function"></a>Evaluation function</h3><ul>
<li>Choose wisely</li>
<li>Need testing - When reaching different levels, the result could be different for the same evaluation function</li>
</ul>
<h2 id="Quiescent-search"><a href="#Quiescent-search" class="headerlink" title="Quiescent search"></a>Quiescent search</h2><ul>
<li>Seaching through different depth to see if the result is consistent</li>
<li>Will usually use at the beginning/end of the game</li>
</ul>
<h2 id="Iterative-Deepening"><a href="#Iterative-Deepening" class="headerlink" title="Iterative Deepening"></a>Iterative Deepening</h2><ul>
<li>Incrementally search thru different depth</li>
<li>Keep the result of each level, and try to search the next level. If time limit exceeds, return the stored result</li>
<li>Could search deeper towards the end of the game</li>
</ul>
<h3 id="Horizon-Effect"><a href="#Horizon-Effect" class="headerlink" title="Horizon Effect"></a>Horizon Effect</h3><ul>
<li>When it is obvious for human player what the next move is, but computer cannot search far enough to figure it out.</li>
</ul>
<h2 id="Alpha-beta-pruning"><a href="#Alpha-beta-pruning" class="headerlink" title="Alpha-beta pruning"></a>Alpha-beta pruning</h2><ul>
<li>Could save time by a factor of 2<pre><code class="javascript">
</code></pre>
</li>
</ul>
<h2 id="Expectimax"><a href="#Expectimax" class="headerlink" title="Expectimax"></a>Expectimax</h2><ul>
<li>Handle probablistic moves</li>
<li>Can only prune when you have known bounds for values</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/15/nanodegree-ai-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/15/nanodegree-ai-1/" itemprop="url">
                  NanoDegree AI - Intro
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-15T20:18:29-07:00">
                2017-03-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introduce-two-concepts"><a href="#Introduce-two-concepts" class="headerlink" title="Introduce two concepts"></a>Introduce two concepts</h1><ol>
<li>Constraint Propogation</li>
<li>search</li>
</ol>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a href="http://norvig.com/sudoku.html" target="_blank" rel="external">Solving Every Sudoku Puzzle</a></p>
<h1 id="Heuristic"><a href="#Heuristic" class="headerlink" title="Heuristic"></a>Heuristic</h1><p>Some additional piece of information - a rule, function, constraints - that informs an otherwice brute-force algorithm to act in a more optimal manner</p>
<h1 id="Defining-intelligence"><a href="#Defining-intelligence" class="headerlink" title="Defining intelligence"></a>Defining intelligence</h1><ul>
<li>Should no equal human as intelligence, that will rule out almost all intelligent systems</li>
<li><strong>Intelligence should be defined in the context of tasks</strong>, rather than how we percieve the world.</li>
</ul>
<h1 id="Agent-Environment-and-state"><a href="#Agent-Environment-and-state" class="headerlink" title="Agent, Environment and state"></a>Agent, Environment and state</h1><img src="/imgs/nd_ai1_1/ai1_1_Screenshot1.png" class="[screenshot]">
<ul>
<li>Only software is the agent</li>
<li>Hardwares such as sensors will be considered part of the environment</li>
<li>But in a higher levell, the entire robot is considered as an agent</li>
<li>State - current state, goal state, history, etc…</li>
</ul>
<h1 id="Perception-action-cognition"><a href="#Perception-action-cognition" class="headerlink" title="Perception, action, cognition"></a>Perception, action, cognition</h1><ul>
<li>Perception - Agent retrieves properties of environment and knowing the environment</li>
<li>Action - Agent performs to change the properties of environment</li>
<li>Cognition - The process of determining what actions to take</li>
</ul>
<h1 id="Types-of-AI-Problems"><a href="#Types-of-AI-Problems" class="headerlink" title="Types of AI Problems"></a>Types of AI Problems</h1><ul>
<li>Fully observable - like Tic Tac Toe, where you can see the entire board and rules</li>
<li>Partial observable - like Battleship, where you cannot see your oponent’s position</li>
<li>Deterministic - where you know the result of each action</li>
<li>Stochastic - where there is uncertainty</li>
<li>Discrete - Only finite number of states</li>
<li>Continuous - Could be infinite number of states</li>
<li>Benign - Where only one agent can take action against environment</li>
<li>Adversarial - Multiple agents involved</li>
</ul>
<h1 id="Rational-Behavior-and-Bounded-Optimality"><a href="#Rational-Behavior-and-Bounded-Optimality" class="headerlink" title="Rational Behavior and Bounded Optimality"></a>Rational Behavior and Bounded Optimality</h1><h2 id="Rational-behavior"><a href="#Rational-behavior" class="headerlink" title="Rational behavior"></a>Rational behavior</h2><p>An agent will always take action in an environment in order to maximize its utility. - This could be hard to achieve in real world because there could be many limitations</p>
<h2 id="Bounded-Optimality"><a href="#Bounded-Optimality" class="headerlink" title="Bounded Optimality"></a>Bounded Optimality</h2><p>Also consider all limitations in real world. Hence, rather than requiring agent to act optimally, will set a feasible goal for agent that counts all obstacle and limitations in the real world problem. This also provide a good way to quantify an agent.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/08/omscs-os-8-memory-management/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/08/omscs-os-8-memory-management/" itemprop="url">
                  Operating System - Memory Management
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-08T21:45:18-08:00">
                2017-03-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li><strong>Physical</strong> &amp; <strong>Virtual Memory</strong> management</li>
<li>Review of memory management mechanisms</li>
<li>Illustration of advanced services</li>
</ul>
<h1 id="Visual-Metaphor"><a href="#Visual-Metaphor" class="headerlink" title="Visual Metaphor"></a>Visual Metaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">OS Memory</th>
<th style="text-align:center">Toy shop Part</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Uses intelligently sized container</td>
<td style="text-align:center">Memory pages or segments</td>
<td style="text-align:center">Crates of toy parts</td>
</tr>
<tr>
<td style="text-align:center">Not all parts are needed @ once</td>
<td style="text-align:center">Tasks operate on subset of memory</td>
<td style="text-align:center">toy orders completed in shapes</td>
</tr>
<tr>
<td style="text-align:center">Optimized for performances</td>
<td style="text-align:center">Reduce time to access state in memory -&gt; better performance</td>
<td style="text-align:center">reduce wait time for parts -&gt; make more toy</td>
</tr>
</tbody>
</table>
<h1 id="Memory-Management-Goal"><a href="#Memory-Management-Goal" class="headerlink" title="Memory Management Goal"></a>Memory Management Goal</h1><h2 id="Virtual-Memory-v-s-Physical-Memory"><a href="#Virtual-Memory-v-s-Physical-Memory" class="headerlink" title="Virtual Memory v.s. Physical Memory"></a>Virtual Memory v.s. Physical Memory</h2><pre><code>* Introducing virtual memory better supports address space for each process.
* Virtual Memory could be way larger than physical memory.
* Often cooperate with swapping mechanisms
</code></pre><h2 id="Operating-System-Should"><a href="#Operating-System-Should" class="headerlink" title="Operating System Should"></a>Operating System Should</h2><h3 id="1-Allocate"><a href="#1-Allocate" class="headerlink" title="1. Allocate"></a>1. Allocate</h3><pre><code>* **allocation**: Mechanisms &amp; algorithms &amp; data structure to track usage and status of Physical memory
* **replacement**: Because VM could be way larger than PM, and part of them will be in disk (swap)
</code></pre><h3 id="2-Arbitrate"><a href="#2-Arbitrate" class="headerlink" title="2. Arbitrate"></a>2. Arbitrate</h3><pre><code>* **Address Translation**
* **Address Validation**
</code></pre><h2 id="Page-based-Management"><a href="#Page-based-Management" class="headerlink" title="Page-based Management:"></a>Page-based Management:</h2><pre><code>* **Allocate**: Pages (VM) =&gt; Page Frames (PM)
* **Arbitrate**: Page tablespoon
</code></pre><h2 id="Segment-based-Management"><a href="#Segment-based-Management" class="headerlink" title="Segment-based Management:"></a>Segment-based Management:</h2><pre><code>* **Allocate**: Segments
* **Arbitrate**: Segment registers: base + bound pair, one pair for each segment
</code></pre><h1 id="Hardware-support"><a href="#Hardware-support" class="headerlink" title="Hardware support"></a>Hardware support</h1><h2 id="Memory-Management-Unit-MMU"><a href="#Memory-Management-Unit-MMU" class="headerlink" title="Memory Management Unit (MMU)"></a>Memory Management Unit (MMU)</h2><pre><code>1. Translate VM to PM **(TLB - Translation Lookaside Buffer)**
2. Reports **Faults**
    * Illegal access
    * Permission
    * Not presented in Main Memory
3. register
    * Pointer to **page tables** (Page table - based)
    * Base and bound registers, num of segments (Segment-based)
4. Cache - Translation Lookaside Buffer
5. Translation: Actual Physical Address Generation done in hardware
</code></pre><h1 id="Segmentation"><a href="#Segmentation" class="headerlink" title="Segmentation"></a>Segmentation</h1><h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><ol>
<li>Address space could be divided into segments</li>
<li>Flexible - arbitrary sizes instead of fixed size</li>
</ol>
<h2 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h2><ul>
<li>Virtual Addresses are divided into <strong>segment number</strong> and offset</li>
<li>Keeps a pair of base and bound registers to track validity inside a segment</li>
<li>Each segment is mapped (by CPU) to a physical address, and use <strong>segment selector + offset</strong> to get the physical address</li>
</ul>
<h2 id="Pros-and-cons"><a href="#Pros-and-cons" class="headerlink" title="Pros and cons"></a>Pros and cons</h2><ul>
<li>Pros:<ol>
<li>Flexible</li>
<li>OS keeps track of a list of free memory segments to decide which one will be allocated next</li>
<li>Relatively easy implementation</li>
</ol>
</li>
<li>Cons:<ol>
<li>Could lead to <strong>external fragmentation</strong></li>
<li>OS needs well designed mechanisms/algorisms to keep track and manipulate the <strong>free memory list</strong></li>
</ol>
</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot1.png" class="[screenshot]">
<h1 id="Page-Table"><a href="#Page-Table" class="headerlink" title="Page Table"></a>Page Table</h1><h2 id="Motivation-1"><a href="#Motivation-1" class="headerlink" title="Motivation"></a>Motivation</h2><ol>
<li>Varying sized memory blocks (i.e. segments) will lead to external fragmentation, and will result in memory waste.</li>
<li>Could use multi-level page tables to manage page table sizes, and utilize memory efficiently.</li>
</ol>
<h2 id="How-it-works-1"><a href="#How-it-works-1" class="headerlink" title="How it works"></a>How it works</h2><ul>
<li>Resides in <strong>Main Memory</strong></li>
<li>Map Virtual Addresses to Physical Addresses via <strong>Page Table</strong></li>
<li>For single level paging:<ol>
<li>Number of entries in page table equals to number of virtual pages</li>
<li>Each <strong>Page Table Entry (PTE)</strong> holds the <strong>Physical Page Number</strong> pointing to a page frame with same size in <strong>physical memory</strong>, as well as useful bits.</li>
<li>Virtial Address is divided into <strong>Virtual Page Number (VPN)</strong> and Offset. Using <strong>VPN</strong> to index the <strong>Physical Page Frame</strong>, and adding offset to locate the actual <strong>Physical Address</strong></li>
<li>One Page Table per process, managed by Operating System.</li>
<li>Hardware will maintain register pointing to the active page table, and it needs to be updated during context switch</li>
</ol>
</li>
</ul>
<h2 id="Pros-and-Cons"><a href="#Pros-and-Cons" class="headerlink" title="Pros and Cons"></a>Pros and Cons</h2><pre><code>* Pros:
    1. Fixed size pages would eliminate External Fragmentation
    2. 
* Cons:
    1. Because each translation will go through two menmory index, performance will be impacted. (**TBL** is introduced to address this)
    2. Waste memory if page is not used at all (will still allocate page entry for unused page) - Multi-layer page table is introduced to address this
</code></pre><img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot2.png" class="[screenshot]">
<h2 id="Multi-Level-page"><a href="#Multi-Level-page" class="headerlink" title="Multi Level page"></a>Multi Level page</h2><h3 id="How-it-works-2"><a href="#How-it-works-2" class="headerlink" title="How it works"></a>How it works</h3><ul>
<li>Outter Page Table - Page Directory: a table that holds entry which points to the actual page table</li>
<li>Internal Page Table - only for valid virtual memory regions</li>
<li>Virtual Address is split further</li>
</ul>
<h2 id="Could-keep-adding-additional-layers-especially-useful-for-64-bits"><a href="#Could-keep-adding-additional-layers-especially-useful-for-64-bits" class="headerlink" title="Could keep adding additional layers (especially useful for 64 bits)"></a>Could keep adding additional layers (especially useful for 64 bits)</h2><ul>
<li><strong>Plus</strong>: Reduce page size - smaller internal page tables/directories</li>
<li><strong>Downside</strong>: More memory accesses are required</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot3.png" class="[screenshot]">
<h1 id="TLB-Translation-Lookaside-Buffer"><a href="#TLB-Translation-Lookaside-Buffer" class="headerlink" title="TLB - Translation Lookaside Buffer"></a>TLB - Translation Lookaside Buffer</h1><ul>
<li><strong>Memory Management Units (Hardware)</strong> managing the cache for address translation</li>
<li>Stores translations, and will be first queried whenever a memory request happens.</li>
<li>If <strong>HIT</strong>, will return immediately. If <strong>Miss</strong>, will raise a fault: then OS will look for the targeting memory by going through page table, and place the resulting translation into this cache. Finally, will redo the memory fetch operation (PC will return to the place before the last operation)</li>
</ul>
<h1 id="Inverted-Page-Table"><a href="#Inverted-Page-Table" class="headerlink" title="Inverted Page Table"></a>Inverted Page Table</h1><ul>
<li>Use <strong>pid</strong> and <strong>p</strong> to index (index will match to Physical Frame)</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot4.png" class="[screenshot]">
<ul>
<li>Linear search is required - use hash function to narrow down search space</li>
</ul>
<img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot5.png" class="[screenshot]">
<h1 id="Page-Size"><a href="#Page-Size" class="headerlink" title="Page Size"></a>Page Size</h1><ul>
<li>Large Page Size could result in fewer page entires and smaller page table <strong>+</strong></li>
<li>Large Page Size could lead to <strong>Internal Fragmentation</strong> <strong>-</strong></li>
</ul>
<h1 id="Memory-Allocation"><a href="#Memory-Allocation" class="headerlink" title="Memory Allocation"></a>Memory Allocation</h1><h2 id="Memory-Allocator"><a href="#Memory-Allocator" class="headerlink" title="Memory Allocator"></a>Memory Allocator</h2><ul>
<li>Determines from VA to PA</li>
<li>Address translation, page table, etc… </li>
<li>Check validity/permissions</li>
</ul>
<h2 id="Kernal-Level-Allocator"><a href="#Kernal-Level-Allocator" class="headerlink" title="Kernal Level Allocator"></a>Kernal Level Allocator</h2><ul>
<li>Allocate kernal state and <strong>static</strong> process states</li>
</ul>
<h2 id="User-Level-Allocator"><a href="#User-Level-Allocator" class="headerlink" title="User Level Allocator"></a>User Level Allocator</h2><ul>
<li>Allocate <strong>dynamic</strong> process state (heap)</li>
</ul>
<h2 id="Mechanisms"><a href="#Mechanisms" class="headerlink" title="Mechanisms"></a>Mechanisms</h2><ul>
<li>Buddy Allocator<ol>
<li>Always subdividing available memory space halfly till the smallest fit one is found, and use that one. Then whenever that piece is freed, check recursively check its buddy; if both are freed, we could merge (aggregate) them.</li>
<li>Aggregates well</li>
<li>Internal Fragmentation</li>
</ol>
</li>
<li>Slab Allocator<ol>
<li>Caches common object type/sizes, on top of continuous memory</li>
<li>Avoid Internal Fragmentation</li>
</ol>
</li>
</ul>
<h1 id="Demanding-Pages"><a href="#Demanding-Pages" class="headerlink" title="Demanding Pages"></a>Demanding Pages</h1><img src="/imgs/OMSCS/OS/OS_8/OS_8_Screenshot6.png" class="[screenshot]">
<ul>
<li>We could also pin the page if we want the page to be always presented in memory - this will disable swap for that page</li>
</ul>
<h1 id="Freeing-up-Memory-Pages"><a href="#Freeing-up-Memory-Pages" class="headerlink" title="Freeing up Memory Pages"></a>Freeing up Memory Pages</h1><h2 id="When-should-we-swap"><a href="#When-should-we-swap" class="headerlink" title="When should we swap?"></a>When should we swap?</h2><ul>
<li>When memory usage is above threshold</li>
<li>When CPU usage is below some threshold</li>
</ul>
<h2 id="Which-Page-should-we-swap"><a href="#Which-Page-should-we-swap" class="headerlink" title="Which Page should we swap?"></a>Which Page should we swap?</h2><ul>
<li><strong>Least Recently Used</strong> - need <strong>Access Bit</strong> to track if a page is used recently</li>
<li>Pages that dont need to be written out. (For those needed, it will cost more cycle to access secondary storage)</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/26/vue-doc-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/26/vue-doc-notes/" itemprop="url">
                  Notes for Vue Documentation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T15:03:42-08:00">
                2017-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><h1 id="The-Vue-Instance"><a href="#The-Vue-Instance" class="headerlink" title="The Vue Instance"></a>The Vue Instance</h1><h2 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h2><ul>
<li><p>Every Vue vm is bootstrapped by creating a root Vue instance with the <strong>Vue</strong> constructor function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</div><div class="line">  <span class="comment">// options</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>Could pass in an <strong>option object</strong> to configure. <a href="https://vuejs.org/v2/api" target="_blank" rel="external">API ref</a></p>
</li>
</ul>
<h2 id="Properties-and-Methods"><a href="#Properties-and-Methods" class="headerlink" title="Properties and Methods"></a>Properties and Methods</h2><ul>
<li>Each Vue instance <strong>proxies</strong> all the properties found in its data object<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</div><div class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</div><div class="line">  <span class="attr">data</span>: data</div><div class="line">&#125;)</div><div class="line">vm.a === data.a <span class="comment">// -&gt; true</span></div><div class="line"><span class="comment">// setting the property also affects original data</span></div><div class="line">vm.a = <span class="number">2</span></div><div class="line">data.a <span class="comment">// -&gt; 2</span></div><div class="line"><span class="comment">// ... and vice-versa</span></div><div class="line">data.a = <span class="number">3</span></div><div class="line">vm.a <span class="comment">// -&gt; 3</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Life-Cycle-Hooks"><a href="#Life-Cycle-Hooks" class="headerlink" title="Life Cycle Hooks"></a>Life Cycle Hooks</h2><ul>
<li><a href="https://vuejs.org/v2/api/#created" target="_blank" rel="external">created</a></li>
<li><a href="https://vuejs.org/v2/api/#mounted" target="_blank" rel="external">mounted</a></li>
<li><a href="https://vuejs.org/v2/api/#updated" target="_blank" rel="external">updated</a></li>
<li><a href="https://vuejs.org/v2/api/#destroyed" target="_blank" rel="external">destroy</a><img src="/imgs/vue_doc/lifecycle.png" class="[screenshot]"></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/25/omscs-os-7-scheduling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhexuan Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eric' Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/25/omscs-os-7-scheduling/" itemprop="url">
                  Operating System - Scheduling
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-25T19:20:13-08:00">
                2017-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h1><ul>
<li><strong>Scheduling</strong> Mechanisms, Algorithmn and data structures</li>
<li>Linux O(1) scheduler</li>
<li>Scheduling on **Multi-CPUs</li>
</ul>
<h1 id="Visual-Methaphor"><a href="#Visual-Methaphor" class="headerlink" title="Visual Methaphor"></a>Visual Methaphor</h1><table>
<thead>
<tr>
<th style="text-align:center">Features/Functionalities</th>
<th style="text-align:center">OS Scheduler</th>
<th style="text-align:center">Toy shop manager</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Dispatch/Assign orders/tasks immediately</td>
<td style="text-align:center">Scheduling is simple (FCFS)</td>
<td style="text-align:center">Scheduling is simple (FiFO)</td>
</tr>
<tr>
<td style="text-align:center">Dispatch/Assign simpler orders/tasks first</td>
<td style="text-align:center">Maximize throughput (Shortest Job First)</td>
<td style="text-align:center">Maximize # of orders processed over time (Need more time to process time to decide and pick order)</td>
</tr>
<tr>
<td style="text-align:center">Dispatch/Assign complex orders/tasks first</td>
<td style="text-align:center">Maximize utilization of CPU, devices, memory, …</td>
<td style="text-align:center">Keep workbenches busy</td>
</tr>
</tbody>
</table>
<h1 id="CPU-Scheduling"><a href="#CPU-Scheduling" class="headerlink" title="CPU Scheduling"></a>CPU Scheduling</h1><h2 id="CPU-scheduler"><a href="#CPU-scheduler" class="headerlink" title="CPU scheduler"></a>CPU scheduler</h2><ul>
<li>Decides how and when <strong>tasks (processes and threads)</strong> access shared CPUs</li>
<li>Schedules <strong>tasks</strong> running both <strong>user-level proccesses/threads</strong> and <strong>kernel level threads</strong></li>
<li>Chooses <strong>one</strong> of ready <strong>tasks</strong> to run on CPU</li>
<li>Runs when <ol>
<li><strong>CPU</strong> becomes <strong>idle</strong></li>
<li><strong>New tasks</strong> become ready (will interupt CPU)</li>
<li><strong>Timeslice</strong> expired timeout</li>
</ol>
</li>
<li>When <strong>Tasks</strong> are <strong>dispatched</strong> on CPU -&gt; context switch, set PC, etc…</li>
<li>The purose is to choose <strong>tasks from ready queue</strong></li>
<li>Immediate Questions:<ol>
<li><strong>Which</strong> task should be selected? -&gt; Scheduling policy/Algorithmn</li>
<li><strong>How</strong> is this done? -&gt; Depends on <strong>runqueue</strong> data structure (used to implement <strong>ready queue</strong>)</li>
</ol>
</li>
</ul>
<h2 id="“Run-to-Completion”-Scheduling"><a href="#“Run-to-Completion”-Scheduling" class="headerlink" title="“Run-to-Completion” Scheduling"></a>“Run-to-Completion” Scheduling</h2><h3 id="Initial-Assumptions"><a href="#Initial-Assumptions" class="headerlink" title="Initial Assumptions"></a>Initial Assumptions</h3><ol>
<li>Group of tasks/jobs</li>
<li>Known execution times</li>
<li>No preemption</li>
<li>Single CPU</li>
</ol>
<h3 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h3><ol>
<li>Throughput</li>
<li>Avg Completion time</li>
<li>Avg Wait Time</li>
<li></li>
</ol>
<h3 id="Algorithmn"><a href="#Algorithmn" class="headerlink" title="Algorithmn"></a>Algorithmn</h3><ul>
<li>First Come First Serve (FCFS)<ul>
<li>runqueue == <strong>queue(FIFO)</strong></li>
</ul>
</li>
<li>Shortest Job First (SJF)<ul>
<li>Schedules tasks in order of their <strong>execution time</strong></li>
<li>Runqueue == <strong>queue(priority queue)</strong> || <strong>tree(also a form of order)</strong> </li>
</ul>
</li>
</ul>
<h2 id="Preemptive-Scheduling"><a href="#Preemptive-Scheduling" class="headerlink" title="Preemptive Scheduling"></a>Preemptive Scheduling</h2><h3 id="SJF-Preemption"><a href="#SJF-Preemption" class="headerlink" title="SJF + Preemption"></a>SJF + Preemption</h3><ul>
<li>T2 arrives first</li>
<li>T2 should be preempted<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot1.png" class="[screenshot]"></li>
<li>When execution time is <strong>unknown</strong>, need to use <strong>heuristics</strong> based on history:<ol>
<li>How long did a task run last time?</li>
<li>How long did a task run last n times? <strong>(Windowed Average)</strong></li>
</ol>
</li>
</ul>
<h2 id="Priority-Scheduling"><a href="#Priority-Scheduling" class="headerlink" title="Priority Scheduling"></a>Priority Scheduling</h2><ul>
<li>Task have different <strong>priority levels</strong></li>
<li>Run <strong>highest priority</strong> task next (preemption)</li>
<li>Runqueues:<ol>
<li>One queue per priority</li>
<li>Tree ordered based on priority</li>
</ol>
</li>
<li><strong>DANGEROUS: Starvation</strong>: low priority task never gets executed<ul>
<li>Fix -&gt; <strong>“priority aging”</strong>: priority = f(actual_priority, time spent in run queue)</li>
<li>The longer the task in run queue, the higher its priority is</li>
<li>Tasks will eventually run</li>
</ul>
</li>
</ul>
<h2 id="Priority-Inversion"><a href="#Priority-Inversion" class="headerlink" title="Priority Inversion"></a>Priority Inversion</h2><img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot2.png" class="[screenshot]">
<h2 id="Round-Robin-Scheduling"><a href="#Round-Robin-Scheduling" class="headerlink" title="Round Robin Scheduling"></a>Round Robin Scheduling</h2><ul>
<li>Pick up first task from queue (like FCFS)</li>
<li><strong>Task may yield, to wait on I/O (unlike FCFS)</strong></li>
<li>Round Robin with <strong>Priorities</strong>: include preemption</li>
<li>Round Robin with <strong>Interleaving</strong>: introduce <strong>timeslicing</strong></li>
</ul>
<h2 id="Timesharing-and-Timeslices"><a href="#Timesharing-and-Timeslices" class="headerlink" title="Timesharing and Timeslices"></a>Timesharing and Timeslices</h2><h3 id="Timeslice"><a href="#Timeslice" class="headerlink" title="Timeslice"></a>Timeslice</h3><ul>
<li>Maximum amount of uninterrupted time given to a task =&gt; <strong>time quantum</strong></li>
<li>Task may run <strong>less than</strong> timeslice time. Due to:<ol>
<li>Has to wait on I/O, synchronization… =&gt; will be placed on a queue</li>
<li>Higher priority task becomes runnable</li>
</ol>
</li>
<li>Using timeslices tasks are <strong>interleaved</strong>: timesharing the CPU<ul>
<li>Preempted after <strong>timeslice</strong></li>
</ul>
</li>
<li><strong>Note: FSFC == Round Robin without timeslices</strong></li>
<li>Benefits:<ol>
<li>Keeps the simplicity, just as FCFS Has</li>
<li>Achieved good metrics as SJF algorithmn, but doesn’t need to worry about the finding out the “shortest” task</li>
<li>Short tasks finish sooner</li>
<li>More responsive (User will see the task is running)</li>
<li>Lengthy I/O operations initiated sooner</li>
</ol>
</li>
<li>Downside:<ul>
<li>Overheads: interrupt, schedule, context switch =&gt; <strong>keep timeslice &gt;&gt;&gt; context_switch_time</strong></li>
</ul>
</li>
<li>Example:<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot3.png" class="[screenshot]">
</li>
</ul>
<h3 id="How-long-should-a-timeslice-be"><a href="#How-long-should-a-timeslice-be" class="headerlink" title="How long should a timeslice be?"></a>How long should a timeslice be?</h3><ul>
<li>Balance <strong>benefits</strong> and <strong>overheads</strong></li>
</ul>
<h4 id="For-IO-bound-tasks"><a href="#For-IO-bound-tasks" class="headerlink" title="For IO-bound tasks"></a>For <strong>IO-bound</strong> tasks</h4><ul>
<li>Example<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot5.png" class="[screenshot]"></li>
<li>Pick smaller timeslice, because:<ul>
<li>It will run more quickly to issue I/O requests</li>
<li>Keeps both the CPU and the I/O devices busy</li>
<li>Better user-perceived performance (i.e. Responsive)</li>
</ul>
</li>
</ul>
<h3 id="For-CPU-bound-tasks"><a href="#For-CPU-bound-tasks" class="headerlink" title="For CPU-bound tasks"></a>For <strong>CPU-bound</strong> tasks</h3><ul>
<li>Example<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot4.png" class="[screenshot]"></li>
<li>Pick larger timeslice, because:<ul>
<li>users will care more about <strong>completion time</strong> and <strong>throughput</strong> instead of <strong>wait time</strong></li>
<li>Limits context switching overheads</li>
<li>Keeps CPU utilization and throughput high</li>
</ul>
</li>
</ul>
<h2 id="Runqueue-Data-structures"><a href="#Runqueue-Data-structures" class="headerlink" title="Runqueue Data structures"></a>Runqueue Data structures</h2><ul>
<li>The philosophy is to allow scheduler easily finding the next and best task to schedule</li>
<li>If we want <strong>I/O and CPU bound tasks</strong> to have different timeslices, then<ol>
<li>Same runqueue, check type</li>
<li>Two different structures</li>
</ol>
</li>
<li>Example:<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot6.png" class="[screenshot]"></li>
<li>How do we know if a task is I/O or CPU bound? How intensive it is? -&gt; Use <strong>history heuristic</strong></li>
<li>How about new tasks and dynamically changing tasks?<ul>
<li>Multi-Level Feedback Queue (MLFQ)</li>
<li>Not Priority Queues<img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot7.png" class="[screenshot]">
</li>
</ul>
</li>
</ul>
<h1 id="Linux-O-1-Scheduler"><a href="#Linux-O-1-Scheduler" class="headerlink" title="Linux O(1) Scheduler"></a>Linux O(1) Scheduler</h1><img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot8.png" class="[screenshot]">
<h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><ul>
<li>Constant time to select/add task, regardless of task count</li>
<li><strong>Preemptive, priority-based</strong><ul>
<li>real time (0-99)</li>
<li>timesharing (100-139)</li>
</ul>
</li>
<li>User processes<ul>
<li>Default 120</li>
<li>nicevalue(-20 to 19)</li>
</ul>
</li>
</ul>
<h2 id="Timeslice-Value"><a href="#Timeslice-Value" class="headerlink" title="Timeslice Value"></a>Timeslice Value</h2><ul>
<li>Depends on priority</li>
<li>Smallest for low priority</li>
<li>Highest for hight priority</li>
</ul>
<h2 id="Feedback"><a href="#Feedback" class="headerlink" title="Feedback"></a>Feedback</h2><ul>
<li>Sleep time: waiting/idling</li>
<li>Longer sleep =&gt; interactive =&gt; priority - 5 =&gt; <strong>boost</strong></li>
<li>Smaller Sleep (compute intensive) =&gt; priority + 5 =&gt; <strong>lower priority</strong></li>
</ul>
<h2 id="Runqueue"><a href="#Runqueue" class="headerlink" title="Runqueue"></a>Runqueue</h2><img src="/imgs/OMSCS/OS/OS_7/OS_7_Screenshot9.png" class="[screenshot]">
<ul>
<li>2 arrays of tasks</li>
<li><strong>Active</strong><ul>
<li>Used to pick next task to run</li>
<li>Constant time to <strong>add/select</strong></li>
<li>Tasks remain in queue in active until timeslice expires</li>
</ul>
</li>
<li><strong>Expired</strong><ul>
<li>Inactive list</li>
<li>When no more tasks in active array =&gt; <strong>swap active and expired arrays</strong></li>
</ul>
</li>
</ul>
<h2 id="Pros-and-Cons"><a href="#Pros-and-Cons" class="headerlink" title="Pros and Cons"></a>Pros and Cons</h2><ul>
<li>Pros: O(1)</li>
<li>Cons:<ul>
<li>Performance of interactive tasks (tasks in expired queue is not scheduled)</li>
<li>Fairness</li>
</ul>
</li>
</ul>
<h1 id="Completely-Fair-Scheduler-CFS"><a href="#Completely-Fair-Scheduler-CFS" class="headerlink" title="Completely Fair Scheduler (CFS)"></a>Completely Fair Scheduler (CFS)</h1><h2 id="Runqueue-1"><a href="#Runqueue-1" class="headerlink" title="Runqueue"></a>Runqueue</h2><ul>
<li>Red-Black Tree</li>
<li>Ordered by “virtural runtime”</li>
<li>“Virtual time” == time spent on CPU</li>
</ul>
<h2 id="CFS-Scheduling"><a href="#CFS-Scheduling" class="headerlink" title="CFS Scheduling"></a>CFS Scheduling</h2><ul>
<li>Always pick left-most node (always schedule task with least amount of time on CPU)</li>
<li>Periodically adjust <strong>virtual runtime</strong></li>
<li>Compare to <strong>left most virtual runtime</strong><ul>
<li>If smaller, continue running</li>
<li>If larger, preempt and place appropriately in the tree</li>
</ul>
</li>
</ul>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><ul>
<li>Select task =&gt; O(1)</li>
<li>Add Task =&gt; O(logN)</li>
</ul>
<h1 id="Scheduling-on-Multi-CPU-Systems"><a href="#Scheduling-on-Multi-CPU-Systems" class="headerlink" title="Scheduling on Multi-CPU Systems"></a>Scheduling on Multi-CPU Systems</h1><h2 id="Shared-Memory-Multiprocessor-SMP-v-s-Multi-Cores"><a href="#Shared-Memory-Multiprocessor-SMP-v-s-Multi-Cores" class="headerlink" title="Shared Memory Multiprocessor (SMP) v.s. Multi-Cores"></a>Shared Memory Multiprocessor (SMP) v.s. Multi-Cores</h2><ul>
<li>SMP has multiple CPUs sharing the same memory, and each of them will have their own caches, and may or maynot share Last Level Cache (LLC)</li>
<li>Multi-Cores are CPUs that have multi cores inside it, each core has its private caches, and they share a LLC and memory</li>
<li>As far as OS concerns, both CPUs and Cores in a CPU are entities that they could schedule a thread/proccess on</li>
</ul>
<h2 id="Scheduling-on-Multi-CPU-Systems-1"><a href="#Scheduling-on-Multi-CPU-Systems-1" class="headerlink" title="Scheduling on Multi-CPU Systems"></a>Scheduling on Multi-CPU Systems</h2><ul>
<li>Cache-affinity <strong>IMPORTANT</strong><ul>
<li>Keep tasks on the same CPU as much as possible</li>
<li>Hiearchieal scheduler architecture</li>
<li><strong>Per-CPU</strong> runqueue and <strong>scheduler</strong><ol>
<li>Load balane across CPUs based on<br> a. Queue length<br> b. When CPU is idle</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="Non-Uniform-Memory-Access-Platform-NUMA-Platform"><a href="#Non-Uniform-Memory-Access-Platform-NUMA-Platform" class="headerlink" title="Non-Uniform Memory Access Platform (NUMA Platform)"></a>Non-Uniform Memory Access Platform (NUMA Platform)</h2><ul>
<li>Multiple <strong>memory nodes</strong></li>
<li><strong>Memory Node</strong> closer to a “”soket” of multiple processor<ul>
<li>Access to local main memory node is faster than access to remote main memory node</li>
</ul>
</li>
<li>Keep tasks on CPU closer to Main Memory where their state is -&gt; <strong>NUMA-aware scheduling</strong></li>
</ul>
<h1 id="Hyperthreading-SMT-Simultaneous-Multithreading"><a href="#Hyperthreading-SMT-Simultaneous-Multithreading" class="headerlink" title="Hyperthreading (SMT - Simultaneous Multithreading)"></a>Hyperthreading (SMT - Simultaneous Multithreading)</h1><ul>
<li>Multiple hardware-supported execution contexts (i.e. multiple sets of registers for different threads)</li>
<li>Still 1 CPU but with <strong>very fast</strong> context switch</li>
<li>From OS’s perspective, each set of regs will be seen as a virtual CPU</li>
<li>Can hide <strong>memory latency</strong> because now context switch is 0 cycle, but memory access is much greater</li>
<li>Reference: <a href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-fedorova-paper.pdf" target="_blank" rel="external">“Chip Multithreading Systems Need a New Operating System Scheduler”.</a></li>
</ul>
<h1 id="Threads-and-SMT"><a href="#Threads-and-SMT" class="headerlink" title="Threads and SMT"></a>Threads and SMT</h1><h2 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h2><ol>
<li>Thread issues instruction on each cycle, max <strong>instruction per cycle (IPC)</strong> is 1</li>
<li>Memory access = 4 cycles</li>
<li>Hardware switching instaneously</li>
<li>SMT with 2 hardware threads</li>
</ol>
<h2 id="Co-schedule-compute-bound-threads"><a href="#Co-schedule-compute-bound-threads" class="headerlink" title="Co-schedule compute-bound threads"></a>Co-schedule <strong>compute-bound</strong> threads</h2><ul>
<li>Threads <strong>“interfere”</strong></li>
<li><strong>“contend”</strong> for CPU pipline resource</li>
<li><strong>Performance degrades</strong> by 2x</li>
<li>Memory Idle</li>
</ul>
<h2 id="Co-schedule-memory-bound-threads"><a href="#Co-schedule-memory-bound-threads" class="headerlink" title="Co-schedule memory-bound threads"></a>Co-schedule <strong>memory-bound</strong> threads</h2><ul>
<li>CPU idle</li>
<li>Waste CPU cycles</li>
</ul>
<h2 id="Co-schedule-compute-and-memory-bound-threads"><a href="#Co-schedule-compute-and-memory-bound-threads" class="headerlink" title="Co-schedule compute- and memory-bound threads"></a>Co-schedule <strong>compute- and memory-bound</strong> threads</h2><ul>
<li>Mix of CPU- and Memory-intensive threads</li>
<li>BINGO!</li>
<li>Avoid/limit contention on processor pipeline</li>
<li>All components (CPU and memory) are well utilized</li>
<li>Still leads to interference and degration, but minimal</li>
</ul>
<h2 id="CPU-bound-or-Memory-Boud"><a href="#CPU-bound-or-Memory-Boud" class="headerlink" title="CPU bound or Memory Boud?"></a>CPU bound or Memory Boud?</h2><ul>
<li>Use historic information<ul>
<li>“sleep time” wont work: the thread is not sleeping when waiting on Mm</li>
<li>Software takse too much time to compute this</li>
</ul>
</li>
<li>Use Hardware Counters</li>
</ul>
<h2 id="Is-Cycle-per-Instruction-useful"><a href="#Is-Cycle-per-Instruction-useful" class="headerlink" title="Is Cycle-per-Instruction useful?"></a>Is Cycle-per-Instruction useful?</h2><ul>
<li>Simulation based evaluation</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Zhexuan Liu" />
          <p class="site-author-name" itemprop="name">Zhexuan Liu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhexuan Liu</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
